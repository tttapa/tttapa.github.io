<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="author" content="Pieter P"/>
    <link rel="stylesheet" type="text/css" href="/CSS/Pages.css"/>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- No MathJax -->
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport'/>
    <meta name="theme-color" content="#ccc"/>
    <meta name="keywords" content="Raspberry Pi, Toolchain, Compiler, crosstool-NG, GCC, C, C++, Fortran"/>
    <meta name="description" content="To compile software for the Raspberry Pi, you need a cross-compilation toolchain. This page contains instructions for how to build one."/>
    <title>Building the Cross-Compilation Toolchain</title>
</head>
<body>
    <nav>
        <div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 48 48" style="position:absolute;top:4px;right: 4px;">
                <path d="M0 0h48v48h-48z" fill="none"/>
                <path d="M6 36h36v-4h-36v4zm0-10h36v-4h-36v4zm0-14v4h36v-4h-36z"/>
            </svg>
            <h2><a href="/Pages">Pages</a></h2>
<ul>
    <li class="expanded"><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../index.html">Raspberry Pi</a>
    <ul>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../Installation+Setup/index.html">Installation and Setup</a>
        <ul>
            <li><span class="ftriangle"></span><a class="" href="../Installation+Setup/Setting-up-Ubuntu.html">Installing and Setting up Ubuntu</a></li>
            <li><span class="ftriangle"></span><a class="" href="../Installation+Setup/WiFi-Setup.html">Setting up the WiFi Connection</a></li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../Python-Development/index.html">Python Development</a>
        <ul>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../C++-Development-RPiOS/index.html">Ubuntu to Raspberry Pi OS Cross C++ Development</a>
        <ul>
            <li><span class="ftriangle"></span><a class="" href="../C++-Development-RPiOS/Installation.html">Installation and Setup</a></li>
            <li><span class="ftriangle"></span><a class="" href="../C++-Development-RPiOS/Development-setup.html">Development setup</a></li>
            <li><span class="ftriangle"></span><a class="" href="../C++-Development-RPiOS/Building-example-project.html">Building the C++ example project</a></li>
            <li><span class="ftriangle"></span><a class="" href="../C++-Development-RPiOS/Debugging.html">Remote debugging</a></li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../C++-Development-Ubuntu/index.html">Ubuntu to Ubuntu Cross C++ Development</a>
        <ul>
        </ul>
        </li>
        <li class="expanded"><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="index.html">C++ Development using Docker</a>
        <ul>
            <li><span class="ftriangle"></span><a class="" href="Installation.html">Installation and setup</a></li>
            <li><span class="ftriangle"></span><a class="openEntry " href="Building-The-Toolchain.html">Building the Cross-Compilation Toolchain</a></li>
            <li><span class="ftriangle"></span><a class="" href="Dependencies.html">Cross-Compiling the Dependencies</a></li>
            <li><span class="ftriangle"></span><a class="" href="Installing-Dependencies.html">Installing the dependencies on the Pi</a></li>
            <li><span class="ftriangle"></span><a class="" href="Cpp-Program.html">Cross-Compiling the C++ Example Project</a></li>
            <li><span class="ftriangle"></span><a class="" href="Debugging.html">Debugging</a></li>
            <li><span class="ftriangle"></span><a class="" href="Speedrun.html">Speedrun</a></li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../NEON/index.html">NEON</a>
        <ul>
            <li><span class="ftriangle"></span><a class="" href="../NEON/Division.html">Division</a></li>
        </ul>
        </li>
    </ul>
    </li>
    <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Arduino/index.html">Arduino</a>
    <ul>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Arduino/Audio-and-Signal-Processing/index.html">Audio and Signal Processing</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Arduino/Audio-and-Signal-Processing/VU-Meters/index.html">VU Meters</a>
            <ul>
                <li><span class="ftriangle"></span><a class="" href="../../Arduino/Audio-and-Signal-Processing/VU-Meters/Model.html">Model of a moving-coil galvanometer</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../Arduino/Audio-and-Signal-Processing/VU-Meters/Damped-Harmonic-Oscillator.html">The Damped Harmonic Oscillator</a></li>
            </ul>
            </li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Arduino/Control-Surface/index.html">Control Surface</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Arduino/Control-Surface/Developers/index.html">Developers</a>
            <ul>
                <li><span class="ftriangle"></span><a class="" href="../../Arduino/Control-Surface/Developers/Installation.html">Installation</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../Arduino/Control-Surface/Developers/Style.html">Style</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../Arduino/Control-Surface/Developers/Tests.html">Tests</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../Arduino/Control-Surface/Developers/Generating-Documentation.html">Generating Documentation</a></li>
            </ul>
            </li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Arduino/Control-Theory/index.html">Control Theory</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Arduino/Control-Theory/Motor-Fader/index.html">Motorized Faders</a>
            <ul>
                <li><span class="ftriangle"></span><a class="" href="../../Arduino/Control-Theory/Motor-Fader/PID-Controllers.html">PID Controllers</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../Arduino/Control-Theory/Motor-Fader/PID-Cpp-Implementation.html">C++ Implementation</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../Arduino/Control-Theory/Motor-Fader/PID-Tuning.html">PID Tuning</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../Arduino/Control-Theory/Motor-Fader/Architecture.html">Architecture and Design Decisions</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../Arduino/Control-Theory/Motor-Fader/Hardware.html">Hardware</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../Arduino/Control-Theory/Motor-Fader/Configuration.html">Configuration options and common use cases</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../Arduino/Control-Theory/Motor-Fader/ATmega328P-Code.html">ATmega328P Code</a></li>
            </ul>
            </li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Arduino/Bootloaders/index.html">Bootloaders</a>
        <ul>
            <li><span class="ftriangle"></span><a class="" href="../../Arduino/Bootloaders/ATmega328P-custom-frequency.html">Compiling Optiboot - ATmega328P at custom frequency</a></li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Arduino/ESP8266/index.html">ESP8266</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Arduino/ESP8266/Flashing/index.html">Flashing</a>
            <ul>
                <li><span class="ftriangle"></span><a class="" href="../../Arduino/ESP8266/Flashing/Flashing-With-an-Arduino.html">Flashing the ESP8266 with an Arduino UNO</a></li>
            </ul>
            </li>
        </ul>
        </li>
    </ul>
    </li>
    <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Mathematics/index.html">Mathematics &amp; Engineering</a>
    <ul>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Mathematics/Systems-and-Control-Theory/index.html">Systems and Control Theory</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Mathematics/Systems-and-Control-Theory/Analog-Filters/index.html">Analog Filters &amp; Systems</a>
            <ul>
                <li><span class="ftriangle"></span><a class="" href="../../Mathematics/Systems-and-Control-Theory/Analog-Filters/Butterworth-Filters.html">Butterworth Filters</a></li>
            </ul>
            </li>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/index.html">Digital Filters &amp; Systems</a>
            <ul>
                <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/index.html">DTLTI Systems, Transfer Functions, and the Z-transform</a>
                <ul>
                    <li><span class="ftriangle"></span><a class="" href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/DTLTI-Systems.html">DTLTI Systems</a></li>
                    <li><span class="ftriangle"></span><a class="" href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/Impulse-and-Step-Response.html">Impulse and Step Response</a></li>
                    <li><span class="ftriangle"></span><a class="" href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/Convolutions.html">Convolutions</a></li>
                    <li><span class="ftriangle"></span><a class="" href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/The-Z-transform.html">The Z-transform</a></li>
                </ul>
                </li>
                <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/index.html">Exponential Moving Average</a>
                <ul>
                    <li><span class="ftriangle"></span><a class="" href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/Exponential-Moving-Average.html">Exponential Moving Average</a></li>
                    <li><span class="ftriangle"></span><a class="" href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/Filtering-in-MATLAB.html">Filtering in MATLAB</a></li>
                    <li><span class="ftriangle"></span><a class="" href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/C++Implementation.html">C++ Implementation</a></li>
                </ul>
                </li>
                <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Simple Moving Average/index.html">Simple Moving Average</a>
                <ul>
                    <li><span class="ftriangle"></span><a class="" href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Simple Moving Average/Simple-Moving-Average.html">Simple Moving Average</a></li>
                    <li><span class="ftriangle"></span><a class="" href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Simple Moving Average/C++Implementation.html">C++ Implementation</a></li>
                </ul>
                </li>
                <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Discretization/index.html">Discretization</a>
                <ul>
                    <li><span class="ftriangle"></span><a class="" href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Discretization/Bilinear-transform.html">Bilinear Transform</a></li>
                    <li><span class="ftriangle"></span><a class="" href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Discretization/Discretization-of-a-fourth-order-Butterworth-filter.html">Discretization of a Fourth-Order Butterworth Filter</a></li>
                </ul>
                </li>
                <li><span class="ftriangle"></span><a class="" href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/FIR-Notch.html">Simple Finite Impulse Response Notch Filter</a></li>
            </ul>
            </li>
        </ul>
        </li>
    </ul>
    </li>
    <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Programming/index.html">Programming</a>
    <ul>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Programming/Cpp/index.html">C++</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Programming/Cpp/Practices/index.html">Best Practices</a>
            <ul>
                <li><span class="ftriangle"></span><a class="" href="../../Programming/Cpp/Practices/c-style-casts.html">Don't use C-style casts</a></li>
            </ul>
            </li>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Programming/Cpp/Algorithms/index.html">Algorithms</a>
            <ul>
                <li><span class="ftriangle"></span><a class="" href="../../Programming/Cpp/Algorithms/Max_n_elements.html">Maximum N elements</a></li>
            </ul>
            </li>
        </ul>
        </li>
    </ul>
    </li>
    <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Ubuntu/index.html">Ubuntu</a>
    <ul>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Ubuntu/Software-Installation/index.html">Software Installation</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Ubuntu/Software-Installation/Arduino/index.html">Arduino</a>
            <ul>
                <li><span class="ftriangle"></span><a class="" href="../../Ubuntu/Software-Installation/Arduino/Arduino-IDE.html">Arduino IDE</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../Ubuntu/Software-Installation/Arduino/Hairless-MIDI.html">The Hairless MIDI to Serial Bridge</a></li>
            </ul>
            </li>
            <li><span class="ftriangle"></span><a class="" href="../../Ubuntu/Software-Installation/Installing-Locally.html">Installing Locally</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../Ubuntu/Software-Installation/BlueZ.html">BlueZ with MIDI over BLE Support</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../Ubuntu/Software-Installation/Doxygen.html">Doxygen</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../Ubuntu/Software-Installation/Eclipse.html">Eclipse</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../Ubuntu/Software-Installation/Eigen3.html">Eigen</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../Ubuntu/Software-Installation/GoogleTest.html">GoogleTest</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../Ubuntu/Software-Installation/Java.html">Java</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../Ubuntu/Software-Installation/Python.html">Python</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../Ubuntu/Software-Installation/VirtualBox.html">VirtualBox</a></li>
        </ul>
        </li>
    </ul>
    </li>
</ul>

            <i class="material-icons">
                <a href="/" title="Home">home</a>
            </i>
            <i class="material-icons">
                <a href="Building-The-Toolchain.pdf" title="Download as PDF">get_app</a>
            </i>
            <!-- <i class="material-icons">
                <a href="javascript:window.print()" title="Print this article" onclick="window.print(); return false;">print</a>
            </i> -->
            <i class="material-icons">
                <a href="https://github.com/tttapa/tttapa.github.io/issues/new" target="_blank" title="Comment or open an issue">feedback</a>
            </i>
        </div>
    </nav>
    <article>
        <h1 class="title">Building the Cross-Compilation Toolchain</h1>
        <i class="author">Pieter P</i>
        <div class="main-content">
<div class="toc" id="toc">
  <script>
  function updateTocSize() {
    let toc = document.getElementById("toc");
    toc.style.maxHeight = toc.scrollHeight + 'px';
  }
  </script>  <h4 class="toc" onclick="if (this.parentElement.classList.toggle('expanded')) {updateTocSize();window.addEventListener('resize', updateTocSize);} else {this.parentElement.style = undefined;window.removeEventListener('resize', updateTocSize);}">Table of Contents <i class="material-icons">list</i></h4>
  <ul>
        <li><a href="#downloading-a-pre-built-toolchain">Downloading a pre-built toolchain</a></li>
        <li><a href="#building-the-toolchain-yourself">Building the toolchain yourself</a></li>
          <ul>
            <li><a href="#docker">Docker</a></li>
              <ul>
                <li><a href="#dockerfiles">Dockerfiles</a></li>
              </ul>
            <li><a href="#building-the-crosstool-ng-base-image">Building the crosstool-NG base image</a></li>
            <li><a href="#upgrading-and-customizing-the-configurations">Upgrading and customizing the configurations</a></li>
            <li><a href="#building-the-toolchain">Building the toolchain</a></li>
            <li><a href="#packaging-and-extracting-the-toolchain">Packaging and extracting the toolchain</a></li>
            <li><a href="#installing-the-toolchain">Installing the toolchain</a></li>
            </ul>
  </ul></div>


<p>
    To compile software for the Raspberry Pi, you need a cross-compilation toolchain.
    A cross-compilation toolchain is a collection of development files and
    programs that you can run on your computer or workstation, that produce binaries
    that can be executed on a different
    system with a possibly different architecture, such as a Raspberry Pi.
</p>
<!-- <p>
    If you want to do development on the Pi itself, you'll need a native toolchain as well. This is a toolchain that
    runs on the Pi, and produces binaries for the Pi.
</p> -->

<h2><a name="downloading-a-pre-built-toolchain" href="#downloading-a-pre-built-toolchain">Downloading a pre-built toolchain</a></h2>

<p>
    If you need the cross-compiled programs and libraries like Python and OpenCV,
    the toolchain will be included in the next step.
</p>

<p>
    If, on the other hand, you just want the toolchain, without any of the
    additional programs and libraries, you can install the toolchain separately.
    The easiest way is to just download and extract the pre-built toolchains
    from GitHub. Pick the one for the Raspberry Pi you need:
</p>
<pre
    class="console"><code>mkdir -p ~/opt</code>
<code>wget -qO- https://github.com/tttapa/docker-arm-cross-toolchain/releases/latest/download/x-tools-armv6-rpi-linux-gnueabihf.tar.bz2 | tar xJ -C ~/opt</code></pre>
<pre
    class="console"><code>mkdir -p ~/opt</code>
<code>wget -qO- https://github.com/tttapa/docker-arm-cross-toolchain/releases/latest/download/x-tools-armv8-rpi3-linux-gnueabihf.tar.bz2 | tar xJ -C ~/opt</code></pre>
<pre
    class="console"><code>mkdir -p ~/opt</code>
<code>wget -qO- https://github.com/tttapa/docker-arm-cross-toolchain/releases/latest/download/x-tools-aarch64-rpi3-linux-gnu.tar.bz2 | tar xJ -C ~/opt</code></pre>
<p>
    For more details on how to select the correct one, and instructions for adding
    it to your PATH, see <a
        href="https://github.com/tttapa/docker-arm-cross-toolchain">tttapa/docker-arm-cross-toolchain</a>.
</p>

<h2><a name="building-the-toolchain-yourself" href="#building-the-toolchain-yourself">Building the toolchain yourself</a></h2>

<p>
    If you want full control over the toolchain, customizing the compiler, debugger and other tools, the
    libc version, Linux version, etc., you can build the toolchain yourself, using <a
        href="https://github.com/crosstool-ng/crosstool-ng">crosstool-NG</a>
    and the config files provided by <a
        href="https://github.com/tttapa/docker-arm-cross-toolchain">tttapa/docker-arm-cross-toolchain</a>.
</p>

<h3><a name="docker" href="#docker">Docker</a></h3>

<p>
    As explained on the previous page, building the toolchain happens inside of a Docker container.
    This allows you to experiment in a sandbox-like environment. Starting from scratch is really easy, and
    you don't have to worry about messing up your main Linux installation. When you're done building, you
    can just delete the Docker containers and images.
</p>

<h4><a name="dockerfiles" href="#dockerfiles">Dockerfiles</a></h4>

<p>
    A Dockerfile describes how the Docker image is built. In this project, we'll start from a standard Ubuntu
    image, install some build tools, and then compile the toolchain and the dependencies.
    Each step of the build process creates a new layer in the image. This is handy, because it means that if a build
    fails in one of the last steps, you can just fix it in your Dockerfile, and build it again. It'll then start from
    the last layer that was successfully built before, you don't have to start from the beginning (which would take a
    while, since we'll be building many large projects.)
</p>
<p>
    The actual Dockerfiles used for the build can be found on GitHub at
    <a
        href="https://github.com/tttapa/docker-crosstool-ng-multiarch/blob/master/Dockerfile">tttapa/docker-crosstool-ng-multiarch:Dockerfile</a>
    and
    <a
        href="https://github.com/tttapa/docker-arm-cross-toolchain/tree/master/Dockerfile">tttapa/docker-arm-cross-toolchain:Dockerfile</a>,
    I'll briefly go over
    them on this page.
</p>

<p>
    The following Dockerfile downloads, builds and installs crosstool-NG.
</p>

<h4 class="snippet-name"><a name="tttapa-docker-crosstool-ng-multiarch-dockerfile" href="#tttapa-docker-crosstool-ng-multiarch-dockerfile">tttapa/docker-crosstool-ng-multiarch:Dockerfile</a></h4>
<div class="codesnippet"><style>pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.pygments98 .hll { background-color: #ffffcc }
.pygments98 { background: #ffffff; }
.pygments98 .c { color: #008000 } /* Comment */
.pygments98 .err { border: 1px solid #FF0000 } /* Error */
.pygments98 .k { color: #0000ff } /* Keyword */
.pygments98 .l { color: #0000FF } /* Literal */
.pygments98 .ch { color: #008000 } /* Comment.Hashbang */
.pygments98 .cm { color: #008000 } /* Comment.Multiline */
.pygments98 .cp { color: #af00db } /* Comment.Preproc */
.pygments98 .cpf { color: #a31515 } /* Comment.PreprocFile */
.pygments98 .c1 { color: #008000 } /* Comment.Single */
.pygments98 .cs { color: #008000 } /* Comment.Special */
.pygments98 .ge { font-style: italic } /* Generic.Emph */
.pygments98 .gh { font-weight: bold } /* Generic.Heading */
.pygments98 .gp { font-weight: bold } /* Generic.Prompt */
.pygments98 .gs { font-weight: bold } /* Generic.Strong */
.pygments98 .gu { font-weight: bold } /* Generic.Subheading */
.pygments98 .kc { color: #4e8ae9 } /* Keyword.Constant */
.pygments98 .kd { color: #0000ff } /* Keyword.Declaration */
.pygments98 .kn { color: #af00db } /* Keyword.Namespace */
.pygments98 .kp { color: #0000ff } /* Keyword.Pseudo */
.pygments98 .kr { color: #0000ff } /* Keyword.Reserved */
.pygments98 .kt { color: #2b91af } /* Keyword.Type */
.pygments98 .ld { color: #0000FF } /* Literal.Date */
.pygments98 .m { color: #0000FF } /* Literal.Number */
.pygments98 .s { color: #a31515 } /* Literal.String */
.pygments98 .na { color: #001080 } /* Name.Attribute */
.pygments98 .nb { color: #795e26 } /* Name.Builtin */
.pygments98 .nc { color: #2b91af } /* Name.Class */
.pygments98 .no { color: #0000FF } /* Name.Constant */
.pygments98 .nf { color: #795e26 } /* Name.Function */
.pygments98 .nl { color: #AF00DB } /* Name.Label */
.pygments98 .nn { color: #000000 } /* Name.Namespace */
.pygments98 .nt { color: #800000 } /* Name.Tag */
.pygments98 .nv { color: #0F1E87 } /* Name.Variable */
.pygments98 .ow { color: #0000ff } /* Operator.Word */
.pygments98 .mb { color: #09885a } /* Literal.Number.Bin */
.pygments98 .mf { color: #09885a } /* Literal.Number.Float */
.pygments98 .mh { color: #09885a } /* Literal.Number.Hex */
.pygments98 .mi { color: #09885a } /* Literal.Number.Integer */
.pygments98 .mo { color: #09885a } /* Literal.Number.Oct */
.pygments98 .sa { color: #a31515 } /* Literal.String.Affix */
.pygments98 .sb { color: #a31515 } /* Literal.String.Backtick */
.pygments98 .sc { color: #a31515 } /* Literal.String.Char */
.pygments98 .dl { color: #a31515 } /* Literal.String.Delimiter */
.pygments98 .sd { color: #a31515 } /* Literal.String.Doc */
.pygments98 .s2 { color: #a31515 } /* Literal.String.Double */
.pygments98 .se { color: #a31515 } /* Literal.String.Escape */
.pygments98 .sh { color: #a31515 } /* Literal.String.Heredoc */
.pygments98 .si { color: #a31515 } /* Literal.String.Interpol */
.pygments98 .sx { color: #a31515 } /* Literal.String.Other */
.pygments98 .sr { color: #a31515 } /* Literal.String.Regex */
.pygments98 .s1 { color: #a31515 } /* Literal.String.Single */
.pygments98 .ss { color: #a31515 } /* Literal.String.Symbol */
.pygments98 .bp { color: #795e26 } /* Name.Builtin.Pseudo */
.pygments98 .fm { color: #795e26 } /* Name.Function.Magic */
.pygments98 .vc { color: #0F1E87 } /* Name.Variable.Class */
.pygments98 .vg { color: #0F1E87 } /* Name.Variable.Global */
.pygments98 .vi { color: #0F1E87 } /* Name.Variable.Instance */
.pygments98 .vm { color: #0F1E87 } /* Name.Variable.Magic */
.pygments98 .il { color: #09885a } /* Literal.Number.Integer.Long */
.pygments98 pre.snippet98 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/docker-crosstool-ng-multiarch/blob/d12057eaead260a5ace1748cb3134e736d21d491/Dockerfile" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"/></a>
<div class="pygments98"><pre class="lineNumbers snippet98"><code><span></span><span class="k">FROM</span><span class="w"> </span><span class="s">ubuntu:focal</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s">ct-ng</span></code>
<code></code>
<code><span class="c"># Install dependencies to build toolchain</span></code>
<code><span class="k">ENV</span><span class="w"> </span><span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive</code>
<code><span class="k">RUN</span><span class="w"> </span>apt-get update <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    apt-get install -y gcc g++ gperf bison flex texinfo help2man make libncurses5-dev unzip <span class="se">\</span></code>
<code>                       python3-dev autoconf automake libtool libtool-bin gawk wget rsync git <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    apt-get clean autoclean <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    apt-get autoremove -y <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    rm -rf /var/lib/apt/lists/*</code>
<code></code>
<code><span class="c"># Add a user called `develop` and add him to the sudo group</span></code>
<code><span class="k">RUN</span><span class="w"> </span>useradd -m develop <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    <span class="nb">echo</span> <span class="s2">&quot;develop:develop&quot;</span> <span class="p">|</span> chpasswd <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    adduser develop sudo</code>
<code></code>
<code><span class="k">USER</span><span class="w"> </span><span class="s">develop</span></code>
<code><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/home/develop</span></code>
<code></code>
<code><span class="c"># https://www.raspberrypi.org/forums/viewtopic.php?f=91&amp;t=280707&amp;p=1700861#p1700861</span></code>
<code><span class="k">RUN</span><span class="w"> </span>wget https://ftp.debian.org/debian/pool/main/b/binutils/binutils-source_2.31.1-16_all.deb <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    mkdir binutils <span class="o">&amp;&amp;</span> <span class="nb">cd</span> binutils <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    ar x ../binutils-source_2.31.1-16_all.deb <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    tar xf data.tar.xz <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    cp usr/src/binutils/patches/129_multiarch_libpath.patch /home/develop</code>
<code></code>
<code><span class="c"># Download and install the latest version of crosstool-ng</span></code>
<code><span class="k">RUN</span><span class="w"> </span>git clone -b master --single-branch --depth <span class="m">1</span> <span class="se">\</span></code>
<code>        https://github.com/crosstool-ng/crosstool-ng.git</code>
<code><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/home/develop/crosstool-ng</span></code>
<code><span class="k">RUN</span><span class="w"> </span>git show --summary <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    ./bootstrap <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    ../configure --prefix<span class="o">=</span>/home/develop/.local <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    make -j<span class="k">$(($(</span>nproc<span class="k">)</span> <span class="o">*</span> <span class="m">2</span><span class="k">))</span> <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    make install <span class="o">&amp;&amp;</span>  <span class="se">\</span></code>
<code>    <span class="nb">cd</span> .. <span class="o">&amp;&amp;</span> rm -rf build</code>
<code><span class="k">ENV</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/home/develop/.local/bin:<span class="nv">$PATH</span></code>
<code><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/home/develop </span></code></pre></div>
</div>

<p>
    You'll notice that the Dockerfile downloads a patch for the binutils package.
    This is done in order to support <a href="https://wiki.debian.org/Multiarch/HOWTO">Debian Multiarch</a>.
    Raspberry Pi OS and Ubuntu are both configured for Multiarch by default, so the toolchains we build
    must support this. To this end, we need to patch binutils. For more details, see
    <a href="https://www.raspberrypi.org/forums/viewtopic.php?f=91&t=280707&p=1700861#p1700861">this forum post</a>.
</p>

<p>
    Next, we build another Docker image, which actually builds the toolchain, using the crosstool-NG
    installation from the previous step.
</p>


<h4 class="snippet-name"><a name="tttapa-docker-arm-cross-toolchain-dockerfile" href="#tttapa-docker-arm-cross-toolchain-dockerfile">tttapa/docker-arm-cross-toolchain:Dockerfile</a></h4>
<div class="codesnippet"><style>pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.pygments117 .hll { background-color: #ffffcc }
.pygments117 { background: #ffffff; }
.pygments117 .c { color: #008000 } /* Comment */
.pygments117 .err { border: 1px solid #FF0000 } /* Error */
.pygments117 .k { color: #0000ff } /* Keyword */
.pygments117 .l { color: #0000FF } /* Literal */
.pygments117 .ch { color: #008000 } /* Comment.Hashbang */
.pygments117 .cm { color: #008000 } /* Comment.Multiline */
.pygments117 .cp { color: #af00db } /* Comment.Preproc */
.pygments117 .cpf { color: #a31515 } /* Comment.PreprocFile */
.pygments117 .c1 { color: #008000 } /* Comment.Single */
.pygments117 .cs { color: #008000 } /* Comment.Special */
.pygments117 .ge { font-style: italic } /* Generic.Emph */
.pygments117 .gh { font-weight: bold } /* Generic.Heading */
.pygments117 .gp { font-weight: bold } /* Generic.Prompt */
.pygments117 .gs { font-weight: bold } /* Generic.Strong */
.pygments117 .gu { font-weight: bold } /* Generic.Subheading */
.pygments117 .kc { color: #4e8ae9 } /* Keyword.Constant */
.pygments117 .kd { color: #0000ff } /* Keyword.Declaration */
.pygments117 .kn { color: #af00db } /* Keyword.Namespace */
.pygments117 .kp { color: #0000ff } /* Keyword.Pseudo */
.pygments117 .kr { color: #0000ff } /* Keyword.Reserved */
.pygments117 .kt { color: #2b91af } /* Keyword.Type */
.pygments117 .ld { color: #0000FF } /* Literal.Date */
.pygments117 .m { color: #0000FF } /* Literal.Number */
.pygments117 .s { color: #a31515 } /* Literal.String */
.pygments117 .na { color: #001080 } /* Name.Attribute */
.pygments117 .nb { color: #795e26 } /* Name.Builtin */
.pygments117 .nc { color: #2b91af } /* Name.Class */
.pygments117 .no { color: #0000FF } /* Name.Constant */
.pygments117 .nf { color: #795e26 } /* Name.Function */
.pygments117 .nl { color: #AF00DB } /* Name.Label */
.pygments117 .nn { color: #000000 } /* Name.Namespace */
.pygments117 .nt { color: #800000 } /* Name.Tag */
.pygments117 .nv { color: #0F1E87 } /* Name.Variable */
.pygments117 .ow { color: #0000ff } /* Operator.Word */
.pygments117 .mb { color: #09885a } /* Literal.Number.Bin */
.pygments117 .mf { color: #09885a } /* Literal.Number.Float */
.pygments117 .mh { color: #09885a } /* Literal.Number.Hex */
.pygments117 .mi { color: #09885a } /* Literal.Number.Integer */
.pygments117 .mo { color: #09885a } /* Literal.Number.Oct */
.pygments117 .sa { color: #a31515 } /* Literal.String.Affix */
.pygments117 .sb { color: #a31515 } /* Literal.String.Backtick */
.pygments117 .sc { color: #a31515 } /* Literal.String.Char */
.pygments117 .dl { color: #a31515 } /* Literal.String.Delimiter */
.pygments117 .sd { color: #a31515 } /* Literal.String.Doc */
.pygments117 .s2 { color: #a31515 } /* Literal.String.Double */
.pygments117 .se { color: #a31515 } /* Literal.String.Escape */
.pygments117 .sh { color: #a31515 } /* Literal.String.Heredoc */
.pygments117 .si { color: #a31515 } /* Literal.String.Interpol */
.pygments117 .sx { color: #a31515 } /* Literal.String.Other */
.pygments117 .sr { color: #a31515 } /* Literal.String.Regex */
.pygments117 .s1 { color: #a31515 } /* Literal.String.Single */
.pygments117 .ss { color: #a31515 } /* Literal.String.Symbol */
.pygments117 .bp { color: #795e26 } /* Name.Builtin.Pseudo */
.pygments117 .fm { color: #795e26 } /* Name.Function.Magic */
.pygments117 .vc { color: #0F1E87 } /* Name.Variable.Class */
.pygments117 .vg { color: #0F1E87 } /* Name.Variable.Global */
.pygments117 .vi { color: #0F1E87 } /* Name.Variable.Instance */
.pygments117 .vm { color: #0F1E87 } /* Name.Variable.Magic */
.pygments117 .il { color: #09885a } /* Literal.Number.Integer.Long */
.pygments117 pre.snippet117 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/docker-arm-cross-toolchain/blob/6d2216bfafab5410c02014aa5b14c064e9678ca6/Dockerfile" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"/></a>
<div class="pygments117"><pre class="lineNumbers snippet117"><code><span></span><span class="k">FROM</span><span class="w"> </span><span class="s">ghcr.io/tttapa/docker-crosstool-ng-multiarch:master</span></code>
<code></code>
<code><span class="k">ARG</span><span class="w"> </span>HOST_TRIPLE</code>
<code></code>
<code><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/home/develop</span></code>
<code><span class="k">RUN</span><span class="w"> </span>mkdir /home/develop/host-config <span class="o">&amp;&amp;</span> mkdir /home/develop/src</code>
<code><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/home/develop/host-config</span></code>
<code><span class="k">COPY</span><span class="w"> </span><span class="si">${</span><span class="nv">HOST_TRIPLE</span><span class="si">}</span>.config .config</code>
<code><span class="k">COPY</span><span class="w"> </span><span class="si">${</span><span class="nv">HOST_TRIPLE</span><span class="si">}</span>.env .env</code>
<code><span class="k">RUN</span><span class="w"> </span>mkdir -p patches/binutils/2.31.1 <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    cp /home/develop/129_multiarch_libpath.patch patches/binutils/2.31.1</code>
<code><span class="k">RUN</span><span class="w"> </span>ls -lah</code>
<code></code>
<code><span class="c"># https://www.raspberrypi.org/forums/viewtopic.php?f=91&amp;t=280707&amp;p=1700861#p1700861</span></code>
<code><span class="k">RUN</span><span class="w"> </span>. ./.env<span class="p">;</span> <span class="nb">export</span> <span class="nv">DEB_TARGET_MULTIARCH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOST_TRIPLE_LIB_DIR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span> <span class="se">\</span></code>
<code>    <span class="nv">V</span><span class="o">=</span><span class="m">1</span> ct-ng build <span class="o">||</span> <span class="o">{</span> cat build.log <span class="o">&amp;&amp;</span> false<span class="p">;</span> <span class="o">}</span> <span class="o">&amp;&amp;</span> rm -rf .build</code>
<code></code>
<code><span class="k">ENV</span><span class="w"> </span><span class="nv">TOOLCHAIN_PATH</span><span class="o">=</span>/home/develop/x-tools/<span class="si">${</span><span class="nv">HOST_TRIPLE</span><span class="si">}</span></code>
<code><span class="k">ENV</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="si">${</span><span class="nv">TOOLCHAIN_PATH</span><span class="si">}</span>/bin:<span class="nv">$PATH</span></code>
<code><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/home/develop</span></code></pre></div>
</div>

<p>
    Different variants of the Raspberry Pi use different configuration files. These files have names that contain the
    full <a
        href="https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.69/html_node/Specifying-Target-Triplets.html">target
        triplet</a>. They can be found on GitHub in <a
        href="https://github.com/tttapa/docker-arm-cross-toolchain/tree/master/">same
        folder</a> as the Dockerfile.
</p>

<h3><a name="building-the-crosstool-ng-base-image" href="#building-the-crosstool-ng-base-image">Building the crosstool-NG base image</a></h3>

<p>
    This step is optional. It can be useful to build it yourself if you
    want the very latest version of crosstool-NG.
</p>

<pre class="console">
<code>cd docker-crosstool-ng-multiarch</code>
<code>docker build . -t ghcr.io/tttapa/docker-crosstool-ng-multiarch:master</code>
</pre>

<p>
    If you skip this step, pull the image from <a
        href="https://github.com/tttapa/docker-crosstool-ng-multiarch/pkgs/container/docker-crosstool-ng-multiarch">GitHub</a>:
</p>
<pre class="console">
<code>docker pull ghcr.io/tttapa/docker-crosstool-ng-multiarch:master</code>
</pre>

<h3><a name="upgrading-and-customizing-the-configurations" href="#upgrading-and-customizing-the-configurations">Upgrading and customizing the configurations</a></h3>

<p>
    Next, we'll use crosstool-NG to update the configuration files and
    interactively customize the configuration. Here you can choose versions
    of the compiler and other tools, Linux and libc versions, and so on.
</p>
<p>
    First, start a shell in the crosstool-NG container you built or pulled in
    the previous step. Mount the <code>docker-arm-cross-toolchain</code> folder
    containing the config files, so you can access them inside of the container.
</p>
<pre class="console">
<code>cd ../docker-arm-cross-toolchain</code>
<code>docker run -it -v"$PWD:/mnt" ghcr.io/tttapa/docker-crosstool-ng-multiarch:master</code>
</pre>
<p>
    Now copy the configuration you need to a file named <code>.config</code>,
    update the configuration, make your changes, save the changes, and
    then overwrite the previous configuration with the new one. Here I'll
    use the <code>aarch64-rpi3-linux-gnu</code> configuration, but you should
    use the correct one for your specific setup.
</p>
<pre class="console-docker">
<code># Rename the old configuration</code>
<code>cp /mnt/aarch64-rpi3-linux-gnu.config .config</code>
<code># Upgrade the configuration</code>
<code>ct-ng upgradeconfig</code>
<code># Customize the configuration</code>
<code>ct-ng menuconfig</code>
<code># Overwrite the old configuration</code>
<code>cp .config /mnt/aarch64-rpi3-linux-gnu.config</code>
<code>exit</code>
</pre>

<h3><a name="building-the-toolchain" href="#building-the-toolchain">Building the toolchain</a></h3>

<p>
    Finally, build the toolchain with the new config.
    Use the host triple that matches the configuration file name.
</p>
<pre class="console">
<code>docker build . --build-arg=HOST_TRIPLE=aarch64-rpi3-linux-gnu -t ghcr.io/tttapa/docker-arm-cross-toolchain:aarch64-rpi3-linux-gnu</code>
</pre>

<h3><a name="packaging-and-extracting-the-toolchain" href="#packaging-and-extracting-the-toolchain">Packaging and extracting the toolchain</a></h3>

<p>
    Finally, create a tar archive of the toolchain, and copy it out of the Docker container so you can use it.
</p>
<pre class="console">
<code>container=$(docker run -d ghcr.io/tttapa/docker-arm-cross-toolchain:aarch64-rpi3-linux-gnu bash -c "tar cJf x-tools.tar.bz2 x-tools")</code>
<code>docker wait $container</code>
<code>docker cp $container:/home/develop/x-tools.tar.bz2 x-tools-aarch64-rpi3-linux-gnu.tar.bz2</code>
<code>docker rm $container</code>
</pre>

<h3><a name="installing-the-toolchain" href="#installing-the-toolchain">Installing the toolchain</a></h3>

<p>
    You can now simply extract the toolchain and install it somewhere on your system, e.g. in <code>~/opt</code>:
</p>
<pre class="console">
<code>mkdir -p ~/opt</code>
<code>tar xJf x-tools-aarch64-rpi3-linux-gnu.tar.bz2 -C ~/opt</code>
</pre>
<p>
    For more details on how to select the correct one, and instructions for adding
    it to your PATH, see <a
        href="https://github.com/tttapa/docker-arm-cross-toolchain">tttapa/docker-arm-cross-toolchain</a>.
</p>

</div>
        <hr id="end-of-article">
        <div class="nextupprev"><div class="prevpage"><a href="Installation.html" title="Installation and setup"><i class="material-icons" style="vertical-align: middle; text-decoration: none">chevron_left </i>Previous Page</a></div><div class="uppage"><a href="index.html" title="C++ Development using Docker">Index</a></div><div class="nextpage"><a href="Dependencies.html" title="Cross-Compiling the Dependencies">Next Page<i class="material-icons" style="vertical-align: middle; text-decoration: none"> chevron_right</i></a></div></div>
    </article>
    <footer>Last edited: Sunday, 01 May 2022 02:12 UTC</footer>
</body>

</html>