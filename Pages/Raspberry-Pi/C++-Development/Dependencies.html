<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="author" content="Pieter P"/>
    <link rel="stylesheet" type="text/css" href="/CSS/Pages.css"/>
    <link href='/CSS/roboto.css' rel='stylesheet' type='text/css'/>
    <link href='/CSS/icon.css' rel='stylesheet' type='text/css'/>
    <!-- No MathJax -->
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport'/>
    <meta name="theme-color" content="#ccc"/>
    <meta name="keywords" content="cross-compile,raspberry,raspberry pi,build,compile,from source, source,Zlib,OpenSSL,FFI,Bzip2,GNU ncurses,GNU readline,GNU dbm, SQLite,UUID,Python 3.7.4,ZBar,Raspberry Pi Userland,VideoCore, FFmpeg,OpenCV,NumPy"/>
    <meta name="description" content="Using the cross-compilation toolchain to build the libraries you need for your project, as well as their dependencies."/>
    <title>Cross-Compiling the Dependencies</title>
</head>
<body>
    <nav>
        <div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 48 48" style="position:absolute;top:4px;right: 4px;">
                <path d="M0 0h48v48h-48z" fill="none"/>
                <path d="M6 36h36v-4h-36v4zm0-10h36v-4h-36v4zm0-14v4h36v-4h-36z"/>
            </svg>
            <h2><a href="/Pages">Pages</a></h2>
<ul>
    <li class="expanded"><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../index.html">Raspberry Pi</a>
    <ul>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../Installation+Setup/index.html">Installation and Setup</a>
        <ul>
            <li><span class="ftriangle"></span><a href="../Installation+Setup/Setting-up-Ubuntu.html">Installing and Setting up Ubuntu</a></li>
            <li><span class="ftriangle"></span><a href="../Installation+Setup/WiFi-Setup.html">Setting up the WiFi Connection</a></li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../Python-Development/index.html">Python Development</a>
        <ul>
        </ul>
        </li>
        <li class="expanded"><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="index.html">C++ Development</a>
        <ul>
            <li><span class="ftriangle"></span><a href="Installation.html">Installation and setup</a></li>
            <li><span class="ftriangle"></span><a href="Building-The-Toolchain.html">Building the Cross-Compilation Toolchain</a></li>
            <li><span class="ftriangle"></span><a class="openEntry" href="Dependencies.html">Cross-Compiling the Dependencies</a></li>
            <li><span class="ftriangle"></span><a href="Installing-Dependencies.html">Installing the dependencies on the Pi</a></li>
            <li><span class="ftriangle"></span><a href="Editor-Setup.html">Setting up Visual Studio Code for C++ Development</a></li>
            <li><span class="ftriangle"></span><a href="Cpp-Program.html">Cross-Compiling the C++ Example Project</a></li>
            <li><span class="ftriangle"></span><a href="Speedrun.html">Speedrun</a></li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../NEON/index.html">NEON</a>
        <ul>
            <li><span class="ftriangle"></span><a href="../NEON/Division.html">Division</a></li>
        </ul>
        </li>
    </ul>
    </li>
    <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Arduino/index.html">Arduino</a>
    <ul>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Arduino/Audio-and-Signal-Processing/index.html">Audio and Signal Processing</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Arduino/Audio-and-Signal-Processing/VU-Meters/index.html">VU Meters</a>
            <ul>
                <li><span class="ftriangle"></span><a href="../../Arduino/Audio-and-Signal-Processing/VU-Meters/Model.html">Model of a moving-coil galvanometer</a></li>
            </ul>
            </li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Arduino/Control-Surface/index.html">Control Surface</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Arduino/Control-Surface/Developers/index.html">Developers</a>
            <ul>
                <li><span class="ftriangle"></span><a href="../../Arduino/Control-Surface/Developers/Installation.html">Installation</a></li>
                <li><span class="ftriangle"></span><a href="../../Arduino/Control-Surface/Developers/Style.html">Style</a></li>
                <li><span class="ftriangle"></span><a href="../../Arduino/Control-Surface/Developers/Tests.html">Tests</a></li>
                <li><span class="ftriangle"></span><a href="../../Arduino/Control-Surface/Developers/Generating-Documentation.html">Generating Documentation</a></li>
            </ul>
            </li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Arduino/Bootloaders/index.html">Bootloaders</a>
        <ul>
            <li><span class="ftriangle"></span><a href="../../Arduino/Bootloaders/ATmega328P-custom-frequency.html">Compiling Optiboot - ATmega328P at custom frequency</a></li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Arduino/ESP8266/index.html">ESP8266</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Arduino/ESP8266/Flashing/index.html">Flashing</a>
            <ul>
                <li><span class="ftriangle"></span><a href="../../Arduino/ESP8266/Flashing/Flashing-With-an-Arduino.html">Flashing the ESP8266 with an Arduino UNO</a></li>
            </ul>
            </li>
        </ul>
        </li>
    </ul>
    </li>
    <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Mathematics/index.html">Mathematics &amp; Engineering</a>
    <ul>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Mathematics/Systems-and-Control-Theory/index.html">Systems and Control Theory</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Mathematics/Systems-and-Control-Theory/Analog-Filters/index.html">Analog Filters &amp; Systems</a>
            <ul>
                <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Analog-Filters/Butterworth-Filters.html">Butterworth Filters</a></li>
            </ul>
            </li>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/index.html">Digital Filters &amp; Systems</a>
            <ul>
                <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/index.html">DTLTI Systems, Transfer Functions, and the Z-transform</a>
                <ul>
                    <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/DTLTI-Systems.html">DTLTI Systems</a></li>
                    <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/Impulse-and-Step-Response.html">Impulse and Step Response</a></li>
                    <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/The-Z-transform.html">The Z-transform</a></li>
                </ul>
                </li>
                <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/index.html">Exponential Moving Average</a>
                <ul>
                    <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/Exponential-Moving-Average.html">Exponential Moving Average</a></li>
                    <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/Filtering-in-MATLAB.html">Filtering in MATLAB</a></li>
                    <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/C++Implementation.html">C++ Implementation</a></li>
                </ul>
                </li>
                <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Simple Moving Average/index.html">Simple Moving Average</a>
                <ul>
                    <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Simple Moving Average/Simple-Moving-Average.html">Simple Moving Average</a></li>
                    <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Simple Moving Average/C++Implementation.html">C++ Implementation</a></li>
                </ul>
                </li>
                <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Discretization/index.html">Discretization</a>
                <ul>
                    <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Discretization/Bilinear-transform.html">Bilinear Transform</a></li>
                    <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/Discretization/Discretization-of-a-fourth-order-Butterworth-filter.html">Discretization of a Fourth-Order Butterworth Filter</a></li>
                </ul>
                </li>
                <li><span class="ftriangle"></span><a href="../../Mathematics/Systems-and-Control-Theory/Digital-filters/FIR-Notch.html">Simple Finite Impulse Response Notch Filter</a></li>
            </ul>
            </li>
        </ul>
        </li>
    </ul>
    </li>
    <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Ubuntu/index.html">Ubuntu</a>
    <ul>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Ubuntu/Software-Installation/index.html">Software Installation</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Ubuntu/Software-Installation/Arduino/index.html">Arduino</a>
            <ul>
                <li><span class="ftriangle"></span><a href="../../Ubuntu/Software-Installation/Arduino/Arduino-IDE.html">Arduino IDE</a></li>
                <li><span class="ftriangle"></span><a href="../../Ubuntu/Software-Installation/Arduino/Hairless-MIDI.html">The Hairless MIDI to Serial Bridge</a></li>
            </ul>
            </li>
            <li><span class="ftriangle"></span><a href="../../Ubuntu/Software-Installation/Installing-Locally.html">Installing Locally</a></li>
            <li><span class="ftriangle"></span><a href="../../Ubuntu/Software-Installation/BlueZ.html">BlueZ with MIDI over BLE Support</a></li>
            <li><span class="ftriangle"></span><a href="../../Ubuntu/Software-Installation/Doxygen.html">Doxygen</a></li>
            <li><span class="ftriangle"></span><a href="../../Ubuntu/Software-Installation/Eclipse.html">Eclipse</a></li>
            <li><span class="ftriangle"></span><a href="../../Ubuntu/Software-Installation/Eigen3.html">Eigen</a></li>
            <li><span class="ftriangle"></span><a href="../../Ubuntu/Software-Installation/GoogleTest.html">GoogleTest</a></li>
            <li><span class="ftriangle"></span><a href="../../Ubuntu/Software-Installation/Java.html">Java</a></li>
            <li><span class="ftriangle"></span><a href="../../Ubuntu/Software-Installation/Python.html">Python</a></li>
            <li><span class="ftriangle"></span><a href="../../Ubuntu/Software-Installation/VirtualBox.html">VirtualBox</a></li>
        </ul>
        </li>
    </ul>
    </li>
</ul>

            <i class="material-icons">
                <a href="/" title="Home">home</a>
            </i>
            <i class="material-icons">
                <a href="Dependencies.pdf" title="Download as PDF">get_app</a>
            </i>
            <i class="material-icons">
                <a href="javascript:window.print()" title="Print this article">print</a>
            </i>
            <i class="material-icons">
                <a href="https://github.com/tttapa/tttapa.github.io/issues/new" target="_blank" title="Comment or open an issue">feedback</a>
            </i>
        </div>
    </nav>
    <article>
        <h1 class="title">Cross-Compiling the Dependencies</h1>
        <i class="author">Pieter P</i>
        <div>
<div class="toc" id="toc">
  <script>
  function updateTocSize() {
    let toc = document.getElementById("toc");
    toc.style.maxHeight = toc.scrollHeight + 'px';
  }
  </script>  <h4 class="toc" onclick="if (this.parentElement.classList.toggle('expanded')) {updateTocSize();window.addEventListener('resize', updateTocSize);} else {this.parentElement.style = undefined;window.removeEventListener('resize', updateTocSize);}">Table of Contents <i class="material-icons">list</i></h4>
  <ul>
          <ul>
            <li><a href="#sysroot-and-staging-area">Sysroot and Staging Area</a></li>
            <li><a href="#cross-compiling-the-dependencies-using-the-provided-shell-scripts">Cross-Compiling the dependencies using the provided shell scripts</a></li>
            <li><a href="#pulling-the-cross-compiled-dependencies-from-docker-hub">Pulling the cross-compiled dependencies from Docker Hub</a></li>
          </ul>
        <li><a href="#detailed-information-about-cross-compilation-of-libraries">Detailed information about cross-compilation of libraries</a></li>
          <ul>
            <li><a href="#base-image">Base Image</a></li>
            <li><a href="#cross-compiling-the-dependencies">Cross-Compiling the dependencies</a></li>
              <ul>
                <li><a href="#board-specific-configuration">Board-specific configuration</a></li>
                <li><a href="#compiling-a-library-for-the-docker-container">Compiling a library for the Docker container</a></li>
                <li><a href="#cross-compiling-a-library-for-the-raspberry-pi">Cross-Compiling a library for the Raspberry Pi</a></li>
                  <ul>
                    <li><a href="#downloading-and-extracting">Downloading and extracting</a></li>
                    <li><a href="#pkg-config">pkg-config</a></li>
                    <li><a href="#autoconf">Autoconf</a></li>
                    <li><a href="#configure">Configure</a></li>
                    <li><a href="#compilation">Compilation</a></li>
                    <li><a href="#installation">Installation</a></li>
                    <li><a href="#cleanup">Cleanup</a></li>
                    </ul>
                </ul>
            </ul>
  </ul></div>


<h3><a name="sysroot-and-staging-area" href="#sysroot-and-staging-area">Sysroot and Staging Area</a></h3>

<p>
    Because we don't have access to the actual root directory of the Raspberry Pi, with all of its system files and
    libraries, the toolchain uses a so-called <b>sysroot</b> folder. It contains the necessary system libraries, such as
    glibc and the C++ standard library. It's also the folder where the configure scripts of other libraries will
    look for the necessary libraries and headers. The sysroot is generated by Crosstool-NG, and it is
    part of the cross-compilation toolchain. It is not used for deploying your software to the Pi.
</p>
<p>
    The sysroot of the toolchain is read-only, to keep it clean for future projects, so we'll make a copy of the sysroot
    for this build, and make it writable.<br>
    This copy will be used as the sysroot for all compilations, and all cross-compiled libraries will be installed to
    this folder. We have to do this, because the configure scripts (Autoconf's configure script, CMake, etc.) of other
    libraries or programs will search for their dependencies in the sysroot. If these dependencies are not found,
    configuration or compilation will fail, or parts of the program/library may be implicitly disabled.
</p>
<p>
    Apart from the sysroot, we also need a folder containing the files we want to install to the Pi. It should contain
    the binaries we cross-compiled (such as <code>/usr/local/bin/python3.8</code>) and the necessary libraries (such as
    <code>/usr/local/lib/libpython3.8.so</code>).
    It doesn't contain the system libraries, because the Pi already has these installed. This folder is called the
    <b>staging area</b>.
</p>
<p>
    Having both a sysroot and a staging area means we have to install every library twice, once in
    each of the two folders.<br>
    The sysroot is later used when compiling our program, the staging area will be copied to the Pi for running our
    program.
</p>

<h3><a name="cross-compiling-the-dependencies-using-the-provided-shell-scripts" href="#cross-compiling-the-dependencies-using-the-provided-shell-scripts">Cross-Compiling the dependencies using the provided shell scripts</a></h3>

<p>
    To build all dependencies, you can use the shell script provided in the
    <code>toolchain</code> folder:
</p>
<pre class="console">
<code>./toolchain/toolchain.sh &lt;board&gt; --export</code>
</pre>

<p>
    Where <code>&lt;board&gt;</code> is one of the following:
<ul>
    <li><code>rpi</code>: Raspberry Pi 1 or Zero, dependencies only</li>
    <li><code>rpi-dev</code>: Raspberry Pi 1 or Zero, dependencies and development tools</li>
    <li><code>rpi3-armv8</code>: Raspberry Pi 3, 32-bit, dependencies only</li>
    <li><code>rpi3-armv8-dev</code>: Raspberry Pi 3, 32-bit, dependencies and development tools</li>
    <li><code>rpi3-aarch64</code>: Raspberry Pi 3, 64-bit, dependencies only</li>
    <li><code>rpi3-aarch64-dev</code>: Raspberry Pi 3, 64-bit, dependencies and development tools</li>
</ul>
</p>
<p>
    The dependencies that are cross-compiled are:
<ul>
    <li><strong>Zlib</strong>: compression library (OpenSSL and Python dependency)</li>
    <li><strong>OpenSSL</strong>: cryptography library (Python dependency)</li>
    <li><strong>FFI</strong>: foreign function interface (Python dependency, used to call C functions using ctypes)
    </li>
    <li><strong>Bzip2</strong>: compression library (Python dependency)</li>
    <li><strong>GNU ncurses</strong>: library for text-based user interfaces (Python dependency, used for the
        console)</li>
    <li><strong>GNU readline</strong>: library for line-editing and history (Python dependency, used for the
        console)</li>
    <li><strong>GNU dbm</strong>: library for key-value data (Python dependency)</li>
    <li><strong>SQLite</strong>: library for embedded databases (Python dependency)</li>
    <li><strong>UUID</strong>: library for unique identifiers (Python dependency)</li>
    <li><strong>libX11</strong>: X11 protocol client library (Tk dependency)</li>
    <li><strong>Tcl/Tk</strong>: graphical user interface toolkit (Python/Tkinter dependency)</li>
    <li><strong>Python 3.8.3</strong>: Python interpreter and libraries</li>
    <li><strong>ZBar</strong>: Bar and QR code decoding library</li>
    <li><strong>Raspberry Pi Userland</strong>: VideoCore GPU drivers</li>
    <li><strong>VPX</strong>: VP8/VP9 codec SDK</li>
    <li><strong>x264</strong>: H.264/MPEG-4 AVC encoder</li>
    <li><strong>Xvid</strong>: MPEG-4 video codec</li>
    <li><strong>FFmpeg</strong>: library to record, convert and stream audio and video</li>
    <li><strong>OpenBLAS</strong>: linear algebra library (NumPy dependency)</li>
    <li><strong>NumPy</strong>: multi-dimensional array container for Python (OpenCV dependency)</li>
    <li><strong>SciPy</strong>: Python module for mathematics, science, and engineering</li>
    <li><strong>OpenCV 4.3.0</strong>: computer vision library and Python module</li>
</ul>
</p>
<p>
    The development tools that are cross-compiled are:
<ul>
    <li><strong>GCC 9.2.0</strong>: C, C++ and Fortran compilers (see native toolchain on the previous page)</li>
    <li><strong>GNU Make</strong>: build automation tool</li>
    <li><strong>Ninja</strong>: faster, more light-weight build tool</li>
    <li><strong>CMake</strong>: build system</li>
    <li><strong>Distcc</strong>: distributed compiler wrapper (uses your computer to speed up compilation on the
        RPi)</li>
    <li><strong>CCache</strong>: compiler cache</li>
    <li><strong>cURL</strong>: tool and library for transferring data over the network (Git dependency)</li>
    <li><strong>Git</strong>: version control system</li>
</ul>
</p>

<h3><a name="pulling-the-cross-compiled-dependencies-from-docker-hub" href="#pulling-the-cross-compiled-dependencies-from-docker-hub">Pulling the cross-compiled dependencies from Docker Hub</a></h3>

<p>
    If you don't want to change anything to the build process, or if you have a
    slow computer, you can just pull the Docker images that I compiled from
    Docker Hub:
</p>

<pre class="console">
<code>./toolchain/toolchain.sh &lt;board&gt; --pull --export</code>
</pre>

<h2><a name="detailed-information-about-cross-compilation-of-libraries" href="#detailed-information-about-cross-compilation-of-libraries">Detailed information about cross-compilation of libraries</a></h2>

<p>
    You don't need to read or understand the sections below if you just want to use the provided libraries.<br>
    On the other hand, if you're interested in how cross-compilation works, or if you want to cross-compile additional
    libraries, you'll find the necessary details below.
</p>

<h3><a name="base-image" href="#base-image">Base Image</a></h3>

<p>
    Before building the dependencies, I created a base image with Ubuntu and the
    necessary tools installed. I also created a non-root user.
</p>

<h4 class="snippet-name"><a name="dockerfile" href="#dockerfile">Dockerfile</a></h4>
<div class="codesnippet"><style>.pygments140 .hll { background-color: #ffffcc }
.pygments140  { background: #f8f8f8; }
.pygments140 .c { color: #408080; font-style: italic } /* Comment */
.pygments140 .err { border: 1px solid #FF0000 } /* Error */
.pygments140 .k { color: #008000; font-weight: bold } /* Keyword */
.pygments140 .o { color: #666666 } /* Operator */
.pygments140 .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.pygments140 .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.pygments140 .cp { color: #BC7A00 } /* Comment.Preproc */
.pygments140 .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.pygments140 .c1 { color: #408080; font-style: italic } /* Comment.Single */
.pygments140 .cs { color: #408080; font-style: italic } /* Comment.Special */
.pygments140 .gd { color: #A00000 } /* Generic.Deleted */
.pygments140 .ge { font-style: italic } /* Generic.Emph */
.pygments140 .gr { color: #FF0000 } /* Generic.Error */
.pygments140 .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.pygments140 .gi { color: #00A000 } /* Generic.Inserted */
.pygments140 .go { color: #888888 } /* Generic.Output */
.pygments140 .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.pygments140 .gs { font-weight: bold } /* Generic.Strong */
.pygments140 .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.pygments140 .gt { color: #0044DD } /* Generic.Traceback */
.pygments140 .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.pygments140 .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.pygments140 .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.pygments140 .kp { color: #008000 } /* Keyword.Pseudo */
.pygments140 .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.pygments140 .kt { color: #B00040 } /* Keyword.Type */
.pygments140 .m { color: #666666 } /* Literal.Number */
.pygments140 .s { color: #BA2121 } /* Literal.String */
.pygments140 .na { color: #7D9029 } /* Name.Attribute */
.pygments140 .nb { color: #008000 } /* Name.Builtin */
.pygments140 .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.pygments140 .no { color: #880000 } /* Name.Constant */
.pygments140 .nd { color: #AA22FF } /* Name.Decorator */
.pygments140 .ni { color: #999999; font-weight: bold } /* Name.Entity */
.pygments140 .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.pygments140 .nf { color: #0000FF } /* Name.Function */
.pygments140 .nl { color: #A0A000 } /* Name.Label */
.pygments140 .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.pygments140 .nt { color: #008000; font-weight: bold } /* Name.Tag */
.pygments140 .nv { color: #19177C } /* Name.Variable */
.pygments140 .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.pygments140 .w { color: #bbbbbb } /* Text.Whitespace */
.pygments140 .mb { color: #666666 } /* Literal.Number.Bin */
.pygments140 .mf { color: #666666 } /* Literal.Number.Float */
.pygments140 .mh { color: #666666 } /* Literal.Number.Hex */
.pygments140 .mi { color: #666666 } /* Literal.Number.Integer */
.pygments140 .mo { color: #666666 } /* Literal.Number.Oct */
.pygments140 .sa { color: #BA2121 } /* Literal.String.Affix */
.pygments140 .sb { color: #BA2121 } /* Literal.String.Backtick */
.pygments140 .sc { color: #BA2121 } /* Literal.String.Char */
.pygments140 .dl { color: #BA2121 } /* Literal.String.Delimiter */
.pygments140 .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.pygments140 .s2 { color: #BA2121 } /* Literal.String.Double */
.pygments140 .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.pygments140 .sh { color: #BA2121 } /* Literal.String.Heredoc */
.pygments140 .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.pygments140 .sx { color: #008000 } /* Literal.String.Other */
.pygments140 .sr { color: #BB6688 } /* Literal.String.Regex */
.pygments140 .s1 { color: #BA2121 } /* Literal.String.Single */
.pygments140 .ss { color: #19177C } /* Literal.String.Symbol */
.pygments140 .bp { color: #008000 } /* Name.Builtin.Pseudo */
.pygments140 .fm { color: #0000FF } /* Name.Function.Magic */
.pygments140 .vc { color: #19177C } /* Name.Variable.Class */
.pygments140 .vg { color: #19177C } /* Name.Variable.Global */
.pygments140 .vi { color: #19177C } /* Name.Variable.Instance */
.pygments140 .vm { color: #19177C } /* Name.Variable.Magic */
.pygments140 .il { color: #666666 } /* Literal.Number.Integer.Long */
.pygments140 pre.snippet140 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/RPi-Cpp-Toolchain/blob/d90ed701e38ece5e44cc038e0f7f0c6dd8a2c849/toolchain/docker/base-ubuntu/Dockerfile" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"/></a>
<div class="pygments140"><pre class="lineNumbers snippet140"><code><span></span><span class="k">FROM</span> <span class="s">ubuntu:latest</span> <span class="k">as</span> <span class="s">rpi-cpp-toolchain-base-ubuntu</span></code>
<code></code>
<code><span class="c"># Install some tools and compilers + clean up</span></code>
<code><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    apt-get install -y sudo git wget <span class="se">\</span></code>
<code>                       gcc g++ cmake make autoconf automake <span class="se">\</span></code>
<code>                       gperf diffutils bzip2 libbz2-dev xz-utils <span class="se">\</span></code>
<code>                       flex gawk help2man libncurses-dev patch bison <span class="se">\</span></code>
<code>                       python-dev gnupg2 texinfo unzip libtool-bin <span class="se">\</span></code>
<code>                       autogen libtool m4 gettext pkg-config <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    apt-get clean autoclean <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    apt-get autoremove -y <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    rm -rf /var/lib/apt/lists/*</code>
<code></code>
<code><span class="c"># Add a user called `develop`, and add him to the sudo group</span></code>
<code><span class="k">RUN</span> useradd -m develop <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    <span class="nb">echo</span> <span class="s2">&quot;develop:develop&quot;</span> <span class="p">|</span> chpasswd <span class="o">&amp;&amp;</span> <span class="se">\</span></code>
<code>    adduser develop sudo</code>
<code></code>
<code><span class="k">USER</span><span class="s"> develop</span></code>
<code><span class="k">WORKDIR</span><span class="s"> /home/develop</span></code></pre></div>
</div>

<h3><a name="cross-compiling-the-dependencies" href="#cross-compiling-the-dependencies">Cross-Compiling the dependencies</a></h3>

<p>
    If you want to write a program that uses the OpenCV library, you have to cross-compile OpenCV and install it to
    the Raspberry Pi. But in order to cross-compile OpenCV itself, you need to cross-compile all of its dependencies as
    well. This can keep going for a while, and you may end up with a pretty large hierarchy of dependencies.
</p>
<p>
    The main Dockerfile discussed below sets up the build environment, and then runs the installation scripts in the
    <a
        href="https://github.com/tttapa/RPi-Cpp-Toolchain/tree/master/toolchain/docker/merged/cross-build/install-scripts"><code>toolchain/docker/merged/cross-build/install-scripts</code></a>
    folder. If you want to omit some of the libraries, you can comment them out in the Dockerfile, but keep in mind that
    it might break other libraries that depend on it.<br>
    Some libraries such as SciPy need to be patched to get them to cross-compile correctly. These patches can be found
    in the <a
        href="https://github.com/tttapa/RPi-Cpp-Toolchain/tree/master/toolchain/docker/merged/cross-build/patches"><code>patches</code></a>
    folder.
</p>
<p>
    For most packages, the build procedure is very simple:
<ol>
    <li>Download</li>
    <li>Extract</li>
    <li>Run the <code>configure</code> script with the right options</li>
    <li><code>make</code></li>
    <li><code>make install</code></li>
</ol>
An example is given below.
</p>

<h4><a name="board-specific-configuration" href="#board-specific-configuration">Board-specific configuration</a></h4>

<p>
    The configuration for the different Raspberry Pi models is passed to the
    build scripts using environment variables. For example:
</p>

<h4 class="snippet-name"><a name="aarch64-rpi3-linux-gnu-env" href="#aarch64-rpi3-linux-gnu-env">aarch64-rpi3-linux-gnu.env</a></h4>
<div class="codesnippet"><style>.pygments182 .hll { background-color: #ffffcc }
.pygments182  { background: #f8f8f8; }
.pygments182 .c { color: #408080; font-style: italic } /* Comment */
.pygments182 .err { border: 1px solid #FF0000 } /* Error */
.pygments182 .k { color: #008000; font-weight: bold } /* Keyword */
.pygments182 .o { color: #666666 } /* Operator */
.pygments182 .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.pygments182 .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.pygments182 .cp { color: #BC7A00 } /* Comment.Preproc */
.pygments182 .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.pygments182 .c1 { color: #408080; font-style: italic } /* Comment.Single */
.pygments182 .cs { color: #408080; font-style: italic } /* Comment.Special */
.pygments182 .gd { color: #A00000 } /* Generic.Deleted */
.pygments182 .ge { font-style: italic } /* Generic.Emph */
.pygments182 .gr { color: #FF0000 } /* Generic.Error */
.pygments182 .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.pygments182 .gi { color: #00A000 } /* Generic.Inserted */
.pygments182 .go { color: #888888 } /* Generic.Output */
.pygments182 .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.pygments182 .gs { font-weight: bold } /* Generic.Strong */
.pygments182 .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.pygments182 .gt { color: #0044DD } /* Generic.Traceback */
.pygments182 .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.pygments182 .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.pygments182 .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.pygments182 .kp { color: #008000 } /* Keyword.Pseudo */
.pygments182 .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.pygments182 .kt { color: #B00040 } /* Keyword.Type */
.pygments182 .m { color: #666666 } /* Literal.Number */
.pygments182 .s { color: #BA2121 } /* Literal.String */
.pygments182 .na { color: #7D9029 } /* Name.Attribute */
.pygments182 .nb { color: #008000 } /* Name.Builtin */
.pygments182 .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.pygments182 .no { color: #880000 } /* Name.Constant */
.pygments182 .nd { color: #AA22FF } /* Name.Decorator */
.pygments182 .ni { color: #999999; font-weight: bold } /* Name.Entity */
.pygments182 .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.pygments182 .nf { color: #0000FF } /* Name.Function */
.pygments182 .nl { color: #A0A000 } /* Name.Label */
.pygments182 .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.pygments182 .nt { color: #008000; font-weight: bold } /* Name.Tag */
.pygments182 .nv { color: #19177C } /* Name.Variable */
.pygments182 .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.pygments182 .w { color: #bbbbbb } /* Text.Whitespace */
.pygments182 .mb { color: #666666 } /* Literal.Number.Bin */
.pygments182 .mf { color: #666666 } /* Literal.Number.Float */
.pygments182 .mh { color: #666666 } /* Literal.Number.Hex */
.pygments182 .mi { color: #666666 } /* Literal.Number.Integer */
.pygments182 .mo { color: #666666 } /* Literal.Number.Oct */
.pygments182 .sa { color: #BA2121 } /* Literal.String.Affix */
.pygments182 .sb { color: #BA2121 } /* Literal.String.Backtick */
.pygments182 .sc { color: #BA2121 } /* Literal.String.Char */
.pygments182 .dl { color: #BA2121 } /* Literal.String.Delimiter */
.pygments182 .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.pygments182 .s2 { color: #BA2121 } /* Literal.String.Double */
.pygments182 .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.pygments182 .sh { color: #BA2121 } /* Literal.String.Heredoc */
.pygments182 .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.pygments182 .sx { color: #008000 } /* Literal.String.Other */
.pygments182 .sr { color: #BB6688 } /* Literal.String.Regex */
.pygments182 .s1 { color: #BA2121 } /* Literal.String.Single */
.pygments182 .ss { color: #19177C } /* Literal.String.Symbol */
.pygments182 .bp { color: #008000 } /* Name.Builtin.Pseudo */
.pygments182 .fm { color: #0000FF } /* Name.Function.Magic */
.pygments182 .vc { color: #19177C } /* Name.Variable.Class */
.pygments182 .vg { color: #19177C } /* Name.Variable.Global */
.pygments182 .vi { color: #19177C } /* Name.Variable.Instance */
.pygments182 .vm { color: #19177C } /* Name.Variable.Magic */
.pygments182 .il { color: #666666 } /* Literal.Number.Integer.Long */
.pygments182 pre.snippet182 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/RPi-Cpp-Toolchain/blob/5442982a2e2af374066e43f1b2d04c839369d447/toolchain/docker/merged/env/aarch64-rpi3-linux-gnu.env" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"/></a>
<div class="pygments182"><pre class="lineNumbers snippet182"><code><span></span><span class="nb">export</span> <span class="nv">CROSS_TOOLCHAIN_IMAGE</span><span class="o">=</span><span class="s2">&quot;aarch64-rpi3-linux-gnu&quot;</span></code>
<code><span class="nb">export</span> <span class="nv">HOST_ARCH</span><span class="o">=</span><span class="s2">&quot;aarch64&quot;</span></code>
<code><span class="nb">export</span> <span class="nv">HOST_TRIPLE</span><span class="o">=</span><span class="s2">&quot;aarch64-rpi3-linux-gnu&quot;</span></code>
<code><span class="nb">export</span> <span class="nv">HOST_TRIPLE_NO_VENDOR</span><span class="o">=</span><span class="s2">&quot;aarch64-linux-gnu&quot;</span></code>
<code><span class="nb">export</span> <span class="nv">HOST_TRIPLE_LIB_DIR</span><span class="o">=</span><span class="s2">&quot;aarch64-linux-gnu&quot;</span></code>
<code><span class="nb">export</span> <span class="nv">HOST_BITNESS</span><span class="o">=</span><span class="m">64</span></code></pre></div>
</div>

<h4><a name="compiling-a-library-for-the-docker-container" href="#compiling-a-library-for-the-docker-container">Compiling a library for the Docker container</a></h4>

<p>
    In the first section of the main Dockerfile, some packages are built for both the build machine (the Docker
    container) and for the host machine (the Raspberry Pi), because we need to build Python for both machines in order
    to cross-compile the OpenCV and NumPy modules later on.
</p>
<p>
    Since these are just basic native installations, you can simply follow the documentation for the library in
    question.
    All of the necessary tools should be installed in the <a href="#base-image">base image</a>.
</p>

<h4><a name="cross-compiling-a-library-for-the-raspberry-pi" href="#cross-compiling-a-library-for-the-raspberry-pi">Cross-Compiling a library for the Raspberry Pi</a></h4>

<p>
    Cross-compiling is a bit harder, because most libraries don't provide good documentation about the cross-compilation
    process. However, once you understand the concepts, you'll be able to apply them to almost any library, and with
    the necessary tweaks, you should be able to get it working.
</p>
<p>
    We'll have a look at a typical example, compiling <code>libffi</code>, a foreign function interface library
    that is used by Python's <code>ctypes</code> module.
</p>

<h4 class="snippet-name"><a name="libffi-sh" href="#libffi-sh">libffi.sh</a></h4>
<div class="codesnippet"><style>.pygments213 .hll { background-color: #ffffcc }
.pygments213  { background: #f8f8f8; }
.pygments213 .c { color: #408080; font-style: italic } /* Comment */
.pygments213 .err { border: 1px solid #FF0000 } /* Error */
.pygments213 .k { color: #008000; font-weight: bold } /* Keyword */
.pygments213 .o { color: #666666 } /* Operator */
.pygments213 .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.pygments213 .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.pygments213 .cp { color: #BC7A00 } /* Comment.Preproc */
.pygments213 .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.pygments213 .c1 { color: #408080; font-style: italic } /* Comment.Single */
.pygments213 .cs { color: #408080; font-style: italic } /* Comment.Special */
.pygments213 .gd { color: #A00000 } /* Generic.Deleted */
.pygments213 .ge { font-style: italic } /* Generic.Emph */
.pygments213 .gr { color: #FF0000 } /* Generic.Error */
.pygments213 .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.pygments213 .gi { color: #00A000 } /* Generic.Inserted */
.pygments213 .go { color: #888888 } /* Generic.Output */
.pygments213 .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.pygments213 .gs { font-weight: bold } /* Generic.Strong */
.pygments213 .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.pygments213 .gt { color: #0044DD } /* Generic.Traceback */
.pygments213 .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.pygments213 .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.pygments213 .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.pygments213 .kp { color: #008000 } /* Keyword.Pseudo */
.pygments213 .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.pygments213 .kt { color: #B00040 } /* Keyword.Type */
.pygments213 .m { color: #666666 } /* Literal.Number */
.pygments213 .s { color: #BA2121 } /* Literal.String */
.pygments213 .na { color: #7D9029 } /* Name.Attribute */
.pygments213 .nb { color: #008000 } /* Name.Builtin */
.pygments213 .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.pygments213 .no { color: #880000 } /* Name.Constant */
.pygments213 .nd { color: #AA22FF } /* Name.Decorator */
.pygments213 .ni { color: #999999; font-weight: bold } /* Name.Entity */
.pygments213 .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.pygments213 .nf { color: #0000FF } /* Name.Function */
.pygments213 .nl { color: #A0A000 } /* Name.Label */
.pygments213 .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.pygments213 .nt { color: #008000; font-weight: bold } /* Name.Tag */
.pygments213 .nv { color: #19177C } /* Name.Variable */
.pygments213 .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.pygments213 .w { color: #bbbbbb } /* Text.Whitespace */
.pygments213 .mb { color: #666666 } /* Literal.Number.Bin */
.pygments213 .mf { color: #666666 } /* Literal.Number.Float */
.pygments213 .mh { color: #666666 } /* Literal.Number.Hex */
.pygments213 .mi { color: #666666 } /* Literal.Number.Integer */
.pygments213 .mo { color: #666666 } /* Literal.Number.Oct */
.pygments213 .sa { color: #BA2121 } /* Literal.String.Affix */
.pygments213 .sb { color: #BA2121 } /* Literal.String.Backtick */
.pygments213 .sc { color: #BA2121 } /* Literal.String.Char */
.pygments213 .dl { color: #BA2121 } /* Literal.String.Delimiter */
.pygments213 .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.pygments213 .s2 { color: #BA2121 } /* Literal.String.Double */
.pygments213 .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.pygments213 .sh { color: #BA2121 } /* Literal.String.Heredoc */
.pygments213 .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.pygments213 .sx { color: #008000 } /* Literal.String.Other */
.pygments213 .sr { color: #BB6688 } /* Literal.String.Regex */
.pygments213 .s1 { color: #BA2121 } /* Literal.String.Single */
.pygments213 .ss { color: #19177C } /* Literal.String.Symbol */
.pygments213 .bp { color: #008000 } /* Name.Builtin.Pseudo */
.pygments213 .fm { color: #0000FF } /* Name.Function.Magic */
.pygments213 .vc { color: #19177C } /* Name.Variable.Class */
.pygments213 .vg { color: #19177C } /* Name.Variable.Global */
.pygments213 .vi { color: #19177C } /* Name.Variable.Instance */
.pygments213 .vm { color: #19177C } /* Name.Variable.Magic */
.pygments213 .il { color: #666666 } /* Literal.Number.Integer.Long */
.pygments213 pre.snippet213 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/RPi-Cpp-Toolchain/blob/5442982a2e2af374066e43f1b2d04c839369d447/toolchain/docker/merged/cross-build/install-scripts/libffi.sh" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"/></a>
<div class="pygments213"><pre class="lineNumbers snippet213"><code><span></span><span class="ch">#!/usr/bin/env bash</span></code>
<code></code>
<code><span class="nb">set</span> -ex</code>
<code></code>
<code><span class="c1"># Download</span></code>
<code><span class="nv">version</span><span class="o">=</span><span class="m">3</span>.3</code>
<code><span class="nv">URL</span><span class="o">=</span><span class="s2">&quot;https://codeload.github.com/libffi/libffi/tar.gz/v</span><span class="nv">$version</span><span class="s2">&quot;</span></code>
<code><span class="nb">pushd</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">DOWNLOADS</span><span class="si">}</span><span class="s2">&quot;</span></code>
<code>wget -N <span class="s2">&quot;</span><span class="nv">$URL</span><span class="s2">&quot;</span> -O libffi-<span class="nv">$version</span>.tar.gz</code>
<code><span class="nb">popd</span></code>
<code></code>
<code><span class="c1"># Extract</span></code>
<code>tar xzf <span class="s2">&quot;</span><span class="si">${</span><span class="nv">DOWNLOADS</span><span class="si">}</span><span class="s2">/libffi-</span><span class="nv">$version</span><span class="s2">.tar.gz&quot;</span></code>
<code><span class="nb">pushd</span> libffi-<span class="nv">$version</span></code>
<code></code>
<code><span class="c1"># Configure</span></code>
<code>. cross-pkg-config</code>
<code>./autogen.sh</code>
<code>./configure <span class="se">\</span></code>
<code>    --host<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOST_TRIPLE</span><span class="si">}</span><span class="s2">&quot;</span> <span class="se">\</span></code>
<code>    --prefix<span class="o">=</span><span class="s2">&quot;/usr/local&quot;</span> <span class="se">\</span></code>
<code>    <span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">&quot;-O3&quot;</span> <span class="se">\</span></code>
<code>    <span class="nv">CXXFLAGS</span><span class="o">=</span><span class="s2">&quot;-O3&quot;</span> <span class="se">\</span></code>
<code>    --with-sysroot<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RPI_SYSROOT</span><span class="si">}</span><span class="s2">&quot;</span></code>
<code></code>
<code><span class="c1"># Build</span></code>
<code>make -j<span class="k">$(($(</span>nproc<span class="k">)</span> <span class="o">*</span> <span class="m">2</span><span class="k">))</span></code>
<code></code>
<code><span class="c1"># Install</span></code>
<code>make install <span class="nv">DESTDIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RPI_SYSROOT</span><span class="si">}</span><span class="s2">&quot;</span></code>
<code>make install <span class="nv">DESTDIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RPI_STAGING</span><span class="si">}</span><span class="s2">&quot;</span></code>
<code></code>
<code><span class="c1"># Cleanup</span></code>
<code><span class="nb">popd</span></code>
<code>rm -rf libffi-<span class="nv">$version</span></code></pre></div>
</div>

<h5><a name="downloading-and-extracting" href="#downloading-and-extracting">Downloading and extracting</a></h5>
<p>
    The first couple of lines are really straightforward, they simply download the library from GitHub, extract it, and
    enter the library's directory.
</p>
<h5><a name="pkg-config" href="#pkg-config">pkg-config</a></h5>
<p>
    Most configure scripts use <code>pkg-config</code>, a simple tool to find libraries that are installed on the
    system, and to determine what flags are necessary to use them. We want <code>pkg-config</code> to find the libraries
    in the Raspberry Pi sysroot, not in the root folder of the Docker container, because these libraries are for the
    wrong architecture.<br>
    The <code>cross-pkg-config</code> script that is sourced on line 16 sets some environment variables in order to tell
    <code>pkg-config</code> to only search for libraries in the Raspberry Pi sysroot.
</p>
<h5><a name="autoconf" href="#autoconf">Autoconf</a></h5>
<p>
    Many older libraries use GNU Autoconf to configure the project before building. Autoconf generates the
    <code>configure</code> script, and then the <code>configure</code> script generates the makefiles that are used to
    actually compile and install the software. When downloading a library directly from GitHub (or some other source
    control host), it usually doesn't include the <code>configure</code>. In that case, you have to run Autoconf before
    configuring. If you download a released tarball from the
    project's website, this isn't usually required.
</p>
<h5><a name="configure" href="#configure">Configure</a></h5>
<p>
    The <code>configure</code> script checks the system configuration, looks for libraries, and generates the
    makefiles.<br>
    We have to specify that we are cross-compiling by providing the <code>--host</code> flag. As mentioned before, the
    <code>--prefix</code> option specifies the directory where the library will be installed on the Raspberry Pi.
    Software that isn't managed by the system's package manager should be installed to <code>/usr/local</code>.<br>
    You can add your own compiler flags if you want, using the <code>CFLAGS</code>, <code>CXXFLAGS</code> and
    <code>LDFLAGS</code> variables. Finally, we tell the configure script to use our custom sysroot, instead of the
    toolchain's default. Some configure scripts don't support the <code>--with-sysroot</code> flag. In that case, you
    can add the <code>--sysroot="..."</code> option to the <code>CFLAGS</code>, <code>CXXFLAGS</code> and
    <code>LDFLAGS</code> environment variables.
</p>
<p>
    To find out what options you can pass to the <code>configure</code> script, you can run
    <code>./configure --help</code>.
    Usually, a library also comes with some documentation about these options, for example in the <code>README</code> or
    <code>INSTALL</code> documents.
</p>
<h5><a name="compilation" href="#compilation">Compilation</a></h5>
<p>
    This is probably the easiest step, you can simply type <code>make</code> to compile everyting. To speed up the
    build, <code>make</code>'s <code>-j</code> (<code>--jobs</code>) option is used to compile multiple source files in
    parallel. <code>nproc</code> returns the number of available processing units (cores/threads) in your computer.
    It's multiplied by two, and then passed to <code>make</code>.
</p>
<h5><a name="installation" href="#installation">Installation</a></h5>
<p>
    Once everything has been compiled, we'll install everything in the sysroot and in the staging area. When running
    <code>make install DESTDIR="..."</code>, the files will be installed <code>DESTDIR/PREFIX</code>, that is, the
    <code>DESTDIR</code> variable passed to <code>make</code> and the <code>--prefix</code> specified during
    configuration will be concatenated. The prefix matters both during compilation/installation and at runtime,
    the <code>DESTDIR</code> just determines where they are installed, and is not used at runtime.<br>
    The <code>DESTDIR</code> variable also makes it very easy to install the package at two locations, the sysroot
    and the staging area without building the package twice.
</p>
<h5><a name="cleanup" href="#cleanup">Cleanup</a></h5>
<p>
    Finally, we just delete the entire build directory to keep the size of the Docker image low. When debugging, you
    might want to keep the build directory, so you can start a docker container and try out some things in an
    interactive shell.
</p>

</div>
        <hr id="end-of-article">
        <div class="nextupprev"><div class="prevpage"><a href="Building-The-Toolchain.html" title="Building the Cross-Compilation Toolchain"><i class="material-icons" style="vertical-align: middle; text-decoration: none">chevron_left </i>Previous Page</a></div><div class="uppage"><a href="index.html" title="C++ Development">Index</a></div><div class="nextpage"><a href="Installing-Dependencies.html" title="Installing the dependencies on the Pi">Next Page<i class="material-icons" style="vertical-align: middle; text-decoration: none"> chevron_right</i></a></div></div>
    </article>
    <footer>Last edited: Tuesday, 14 July 2020 11:53 UTC</footer>
</body>

</html>