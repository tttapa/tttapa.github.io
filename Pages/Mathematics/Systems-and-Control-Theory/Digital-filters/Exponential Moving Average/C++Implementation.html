<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="author" content="Pieter P">
    <link rel="stylesheet" type="text/css" href="/CSS/Pages.css">
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- No MathJax -->
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta name="theme-color" content="#ccc">
    <meta name="keywords" content="EMA, Exponential Moving Average, IIR filter, filters, DSP, C++, implementation, algorithm">
    <meta name="description" content="A very fast and efficient Exponential Moving Average implementation in C++.">
    <title>C++ Implementation</title>
<style id="MJX-CHTML-styles">
mjx-container[jax="CHTML"] {
  line-height: 0;
}

mjx-container [space="1"] {
  margin-left: .111em;
}

mjx-container [space="2"] {
  margin-left: .167em;
}

mjx-container [space="3"] {
  margin-left: .222em;
}

mjx-container [space="4"] {
  margin-left: .278em;
}

mjx-container [space="5"] {
  margin-left: .333em;
}

mjx-container [rspace="1"] {
  margin-right: .111em;
}

mjx-container [rspace="2"] {
  margin-right: .167em;
}

mjx-container [rspace="3"] {
  margin-right: .222em;
}

mjx-container [rspace="4"] {
  margin-right: .278em;
}

mjx-container [rspace="5"] {
  margin-right: .333em;
}

mjx-container [size="s"] {
  font-size: 70.7%;
}

mjx-container [size="ss"] {
  font-size: 50%;
}

mjx-container [size="Tn"] {
  font-size: 60%;
}

mjx-container [size="sm"] {
  font-size: 85%;
}

mjx-container [size="lg"] {
  font-size: 120%;
}

mjx-container [size="Lg"] {
  font-size: 144%;
}

mjx-container [size="LG"] {
  font-size: 173%;
}

mjx-container [size="hg"] {
  font-size: 207%;
}

mjx-container [size="HG"] {
  font-size: 249%;
}

mjx-container [width="full"] {
  width: 100%;
}

mjx-box {
  display: inline-block;
}

mjx-block {
  display: block;
}

mjx-itable {
  display: inline-table;
}

mjx-row {
  display: table-row;
}

mjx-row > * {
  display: table-cell;
}

mjx-mtext {
  display: inline-block;
  text-align: left;
}

mjx-mstyle {
  display: inline-block;
}

mjx-merror {
  display: inline-block;
  color: red;
  background-color: yellow;
}

mjx-mphantom {
  visibility: hidden;
}

_::-webkit-full-page-media, _:future, :root mjx-container {
  will-change: opacity;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-math {
  display: inline-block;
  text-align: left;
  line-height: 0;
  text-indent: 0;
  font-style: normal;
  font-weight: normal;
  font-size: 100%;
  font-size-adjust: none;
  letter-spacing: normal;
  word-wrap: normal;
  word-spacing: normal;
  white-space: nowrap;
  direction: ltr;
  padding: 1px 0;
}

mjx-container[jax="CHTML"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="CHTML"][display="true"][width="full"] {
  display: flex;
}

mjx-container[jax="CHTML"][display="true"] mjx-math {
  padding: 0;
}

mjx-container[jax="CHTML"][justify="left"] {
  text-align: left;
}

mjx-container[jax="CHTML"][justify="right"] {
  text-align: right;
}

mjx-mi {
  display: inline-block;
  text-align: left;
}

mjx-c {
  display: inline-block;
}

mjx-utext {
  display: inline-block;
  padding: .75em 0 .2em 0;
}

mjx-mn {
  display: inline-block;
  text-align: left;
}

mjx-TeXAtom {
  display: inline-block;
  text-align: left;
}

mjx-mo {
  display: inline-block;
  text-align: left;
}

mjx-stretchy-h {
  display: inline-table;
  width: 100%;
}

mjx-stretchy-h > * {
  display: table-cell;
  width: 0;
}

mjx-stretchy-h > * > mjx-c {
  display: inline-block;
  transform: scalex(1.0000001);
}

mjx-stretchy-h > * > mjx-c::before {
  display: inline-block;
  width: initial;
}

mjx-stretchy-h > mjx-ext {
  /* IE */ overflow: hidden;
  /* others */ overflow: clip visible;
  width: 100%;
}

mjx-stretchy-h > mjx-ext > mjx-c::before {
  transform: scalex(500);
}

mjx-stretchy-h > mjx-ext > mjx-c {
  width: 0;
}

mjx-stretchy-h > mjx-beg > mjx-c {
  margin-right: -.1em;
}

mjx-stretchy-h > mjx-end > mjx-c {
  margin-left: -.1em;
}

mjx-stretchy-v {
  display: inline-block;
}

mjx-stretchy-v > * {
  display: block;
}

mjx-stretchy-v > mjx-beg {
  height: 0;
}

mjx-stretchy-v > mjx-end > mjx-c {
  display: block;
}

mjx-stretchy-v > * > mjx-c {
  transform: scaley(1.0000001);
  transform-origin: left center;
  overflow: hidden;
}

mjx-stretchy-v > mjx-ext {
  display: block;
  height: 100%;
  box-sizing: border-box;
  border: 0px solid transparent;
  /* IE */ overflow: hidden;
  /* others */ overflow: visible clip;
}

mjx-stretchy-v > mjx-ext > mjx-c::before {
  width: initial;
  box-sizing: border-box;
}

mjx-stretchy-v > mjx-ext > mjx-c {
  transform: scaleY(500) translateY(.075em);
  overflow: visible;
}

mjx-mark {
  display: inline-block;
  height: 0px;
}

mjx-msup {
  display: inline-block;
  text-align: left;
}

mjx-mfrac {
  display: inline-block;
  text-align: left;
}

mjx-frac {
  display: inline-block;
  vertical-align: 0.17em;
  padding: 0 .22em;
}

mjx-frac[type="d"] {
  vertical-align: .04em;
}

mjx-frac[delims] {
  padding: 0 .1em;
}

mjx-frac[atop] {
  padding: 0 .12em;
}

mjx-frac[atop][delims] {
  padding: 0;
}

mjx-dtable {
  display: inline-table;
  width: 100%;
}

mjx-dtable > * {
  font-size: 2000%;
}

mjx-dbox {
  display: block;
  font-size: 5%;
}

mjx-num {
  display: block;
  text-align: center;
}

mjx-den {
  display: block;
  text-align: center;
}

mjx-mfrac[bevelled] > mjx-num {
  display: inline-block;
}

mjx-mfrac[bevelled] > mjx-den {
  display: inline-block;
}

mjx-den[align="right"], mjx-num[align="right"] {
  text-align: right;
}

mjx-den[align="left"], mjx-num[align="left"] {
  text-align: left;
}

mjx-nstrut {
  display: inline-block;
  height: .054em;
  width: 0;
  vertical-align: -.054em;
}

mjx-nstrut[type="d"] {
  height: .217em;
  vertical-align: -.217em;
}

mjx-dstrut {
  display: inline-block;
  height: .505em;
  width: 0;
}

mjx-dstrut[type="d"] {
  height: .726em;
}

mjx-line {
  display: block;
  box-sizing: border-box;
  min-height: 1px;
  height: .06em;
  border-top: .06em solid;
  margin: .06em -.1em;
  overflow: hidden;
}

mjx-line[type="d"] {
  margin: .18em -.1em;
}

mjx-mtable {
  display: inline-block;
  text-align: center;
  vertical-align: .25em;
  position: relative;
  box-sizing: border-box;
  border-spacing: 0;
  border-collapse: collapse;
}

mjx-mstyle[size="s"] mjx-mtable {
  vertical-align: .354em;
}

mjx-labels {
  position: absolute;
  left: 0;
  top: 0;
}

mjx-table {
  display: inline-block;
  vertical-align: -.5ex;
  box-sizing: border-box;
}

mjx-table > mjx-itable {
  vertical-align: middle;
  text-align: left;
  box-sizing: border-box;
}

mjx-labels > mjx-itable {
  position: absolute;
  top: 0;
}

mjx-mtable[justify="left"] {
  text-align: left;
}

mjx-mtable[justify="right"] {
  text-align: right;
}

mjx-mtable[justify="left"][side="left"] {
  padding-right: 0 ! important;
}

mjx-mtable[justify="left"][side="right"] {
  padding-left: 0 ! important;
}

mjx-mtable[justify="right"][side="left"] {
  padding-right: 0 ! important;
}

mjx-mtable[justify="right"][side="right"] {
  padding-left: 0 ! important;
}

mjx-mtable[align] {
  vertical-align: baseline;
}

mjx-mtable[align="top"] > mjx-table {
  vertical-align: top;
}

mjx-mtable[align="bottom"] > mjx-table {
  vertical-align: bottom;
}

mjx-mtable[side="right"] mjx-labels {
  min-width: 100%;
}

mjx-mtr {
  display: table-row;
  text-align: left;
}

mjx-mtr[rowalign="top"] > mjx-mtd {
  vertical-align: top;
}

mjx-mtr[rowalign="center"] > mjx-mtd {
  vertical-align: middle;
}

mjx-mtr[rowalign="bottom"] > mjx-mtd {
  vertical-align: bottom;
}

mjx-mtr[rowalign="baseline"] > mjx-mtd {
  vertical-align: baseline;
}

mjx-mtr[rowalign="axis"] > mjx-mtd {
  vertical-align: .25em;
}

mjx-mtd {
  display: table-cell;
  text-align: center;
  padding: .215em .4em;
}

mjx-mtd:first-child {
  padding-left: 0;
}

mjx-mtd:last-child {
  padding-right: 0;
}

mjx-mtable > * > mjx-itable > *:first-child > mjx-mtd {
  padding-top: 0;
}

mjx-mtable > * > mjx-itable > *:last-child > mjx-mtd {
  padding-bottom: 0;
}

mjx-tstrut {
  display: inline-block;
  height: 1em;
  vertical-align: -.25em;
}

mjx-labels[align="left"] > mjx-mtr > mjx-mtd {
  text-align: left;
}

mjx-labels[align="right"] > mjx-mtr > mjx-mtd {
  text-align: right;
}

mjx-mtd[extra] {
  padding: 0;
}

mjx-mtd[rowalign="top"] {
  vertical-align: top;
}

mjx-mtd[rowalign="center"] {
  vertical-align: middle;
}

mjx-mtd[rowalign="bottom"] {
  vertical-align: bottom;
}

mjx-mtd[rowalign="baseline"] {
  vertical-align: baseline;
}

mjx-mtd[rowalign="axis"] {
  vertical-align: .25em;
}

mjx-mrow {
  display: inline-block;
  text-align: left;
}

mjx-mspace {
  display: inline-block;
  text-align: left;
}

mjx-c::before {
  display: block;
  width: 0;
}

.MJX-TEX {
  font-family: MJXZERO, MJXTEX;
}

.TEX-B {
  font-family: MJXZERO, MJXTEX-B;
}

.TEX-I {
  font-family: MJXZERO, MJXTEX-I;
}

.TEX-MI {
  font-family: MJXZERO, MJXTEX-MI;
}

.TEX-BI {
  font-family: MJXZERO, MJXTEX-BI;
}

.TEX-S1 {
  font-family: MJXZERO, MJXTEX-S1;
}

.TEX-S2 {
  font-family: MJXZERO, MJXTEX-S2;
}

.TEX-S3 {
  font-family: MJXZERO, MJXTEX-S3;
}

.TEX-S4 {
  font-family: MJXZERO, MJXTEX-S4;
}

.TEX-A {
  font-family: MJXZERO, MJXTEX-A;
}

.TEX-C {
  font-family: MJXZERO, MJXTEX-C;
}

.TEX-CB {
  font-family: MJXZERO, MJXTEX-CB;
}

.TEX-FR {
  font-family: MJXZERO, MJXTEX-FR;
}

.TEX-FRB {
  font-family: MJXZERO, MJXTEX-FRB;
}

.TEX-SS {
  font-family: MJXZERO, MJXTEX-SS;
}

.TEX-SSB {
  font-family: MJXZERO, MJXTEX-SSB;
}

.TEX-SSI {
  font-family: MJXZERO, MJXTEX-SSI;
}

.TEX-SC {
  font-family: MJXZERO, MJXTEX-SC;
}

.TEX-T {
  font-family: MJXZERO, MJXTEX-T;
}

.TEX-V {
  font-family: MJXZERO, MJXTEX-V;
}

.TEX-VB {
  font-family: MJXZERO, MJXTEX-VB;
}

mjx-stretchy-v mjx-c, mjx-stretchy-h mjx-c {
  font-family: MJXZERO, MJXTEX-S1, MJXTEX-S4, MJXTEX, MJXTEX-A ! important;
}

@font-face /* 0 */ {
  font-family: MJXZERO;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Zero.woff") format("woff");
}

@font-face /* 1 */ {
  font-family: MJXTEX;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Regular.woff") format("woff");
}

@font-face /* 2 */ {
  font-family: MJXTEX-B;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Bold.woff") format("woff");
}

@font-face /* 3 */ {
  font-family: MJXTEX-I;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Math-Italic.woff") format("woff");
}

@font-face /* 4 */ {
  font-family: MJXTEX-MI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Italic.woff") format("woff");
}

@font-face /* 5 */ {
  font-family: MJXTEX-BI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Math-BoldItalic.woff") format("woff");
}

@font-face /* 6 */ {
  font-family: MJXTEX-S1;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size1-Regular.woff") format("woff");
}

@font-face /* 7 */ {
  font-family: MJXTEX-S2;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size2-Regular.woff") format("woff");
}

@font-face /* 8 */ {
  font-family: MJXTEX-S3;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size3-Regular.woff") format("woff");
}

@font-face /* 9 */ {
  font-family: MJXTEX-S4;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size4-Regular.woff") format("woff");
}

@font-face /* 10 */ {
  font-family: MJXTEX-A;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_AMS-Regular.woff") format("woff");
}

@font-face /* 11 */ {
  font-family: MJXTEX-C;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Regular.woff") format("woff");
}

@font-face /* 12 */ {
  font-family: MJXTEX-CB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Bold.woff") format("woff");
}

@font-face /* 13 */ {
  font-family: MJXTEX-FR;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Fraktur-Regular.woff") format("woff");
}

@font-face /* 14 */ {
  font-family: MJXTEX-FRB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Fraktur-Bold.woff") format("woff");
}

@font-face /* 15 */ {
  font-family: MJXTEX-SS;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Regular.woff") format("woff");
}

@font-face /* 16 */ {
  font-family: MJXTEX-SSB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Bold.woff") format("woff");
}

@font-face /* 17 */ {
  font-family: MJXTEX-SSI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Italic.woff") format("woff");
}

@font-face /* 18 */ {
  font-family: MJXTEX-SC;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Script-Regular.woff") format("woff");
}

@font-face /* 19 */ {
  font-family: MJXTEX-T;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Typewriter-Regular.woff") format("woff");
}

@font-face /* 20 */ {
  font-family: MJXTEX-V;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Vector-Regular.woff") format("woff");
}

@font-face /* 21 */ {
  font-family: MJXTEX-VB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Vector-Bold.woff") format("woff");
}

mjx-c.mjx-c1D6FC.TEX-I::before {
  padding: 0.442em 0.64em 0.011em 0;
  content: "\3B1";
}

mjx-c.mjx-c31::before {
  padding: 0.666em 0.5em 0 0;
  content: "1";
}

mjx-c.mjx-c2F::before {
  padding: 0.75em 0.5em 0.25em 0;
  content: "/";
}

mjx-c.mjx-c3E::before {
  padding: 0.54em 0.778em 0.04em 0;
  content: ">";
}

mjx-c.mjx-c3D::before {
  padding: 0.583em 0.778em 0.082em 0;
  content: "=";
}

mjx-c.mjx-c32::before {
  padding: 0.666em 0.5em 0 0;
  content: "2";
}

mjx-c.mjx-c1D458.TEX-I::before {
  padding: 0.694em 0.521em 0.011em 0;
  content: "k";
}

mjx-c.mjx-c2C::before {
  padding: 0.121em 0.278em 0.194em 0;
  content: ",";
}

mjx-c.mjx-c2208::before {
  padding: 0.54em 0.667em 0.04em 0;
  content: "\2208";
}

mjx-c.mjx-c2115.TEX-A::before {
  padding: 0.683em 0.722em 0.02em 0;
  content: "N";
}

mjx-c.mjx-c22C5::before {
  padding: 0.31em 0.278em 0 0;
  content: "\22C5";
}

mjx-c.mjx-c1D465.TEX-I::before {
  padding: 0.442em 0.572em 0.011em 0;
  content: "x";
}

mjx-c.mjx-c226B::before {
  padding: 0.567em 1em 0.067em 0;
  content: "\226B";
}

mjx-c.mjx-c1D466.TEX-I::before {
  padding: 0.442em 0.49em 0.205em 0;
  content: "y";
}

mjx-c.mjx-c5B::before {
  padding: 0.75em 0.278em 0.25em 0;
  content: "[";
}

mjx-c.mjx-c1D45B.TEX-I::before {
  padding: 0.442em 0.6em 0.011em 0;
  content: "n";
}

mjx-c.mjx-c5D::before {
  padding: 0.75em 0.278em 0.25em 0;
  content: "]";
}

mjx-c.mjx-c2B::before {
  padding: 0.583em 0.778em 0.082em 0;
  content: "+";
}

mjx-c.mjx-c28::before {
  padding: 0.75em 0.389em 0.25em 0;
  content: "(";
}

mjx-c.mjx-c2212::before {
  padding: 0.583em 0.778em 0.082em 0;
  content: "\2212";
}

mjx-c.mjx-c29::before {
  padding: 0.75em 0.389em 0.25em 0;
  content: ")";
}

mjx-c.mjx-c35::before {
  padding: 0.666em 0.5em 0.022em 0;
  content: "5";
}

mjx-c.mjx-c34::before {
  padding: 0.677em 0.5em 0 0;
  content: "4";
}

mjx-c.mjx-c30::before {
  padding: 0.666em 0.5em 0.022em 0;
  content: "0";
}

mjx-c.mjx-c1D44F.TEX-I::before {
  padding: 0.694em 0.429em 0.011em 0;
  content: "b";
}

mjx-c.mjx-c33::before {
  padding: 0.665em 0.5em 0.022em 0;
  content: "3";
}

mjx-c.mjx-cA0::before {
  padding: 0 0.25em 0 0;
  content: "\A0";
}

mjx-c.mjx-c1D467.TEX-I::before {
  padding: 0.442em 0.465em 0.011em 0;
  content: "z";
}

mjx-c.mjx-c225C.TEX-A::before {
  padding: 0.859em 0.778em 0 0;
  content: "\225C";
}

mjx-c.mjx-c21D4::before {
  padding: 0.526em 1em 0.025em 0;
  content: "\21D4";
}

mjx-c.mjx-c2265::before {
  padding: 0.636em 0.778em 0.138em 0;
  content: "\2265";
}

mjx-c.mjx-c21D2::before {
  padding: 0.525em 1em 0.024em 0;
  content: "\21D2";
}

mjx-c.mjx-c3C::before {
  padding: 0.54em 0.778em 0.04em 0;
  content: "<";
}

mjx-c.mjx-c25FB.TEX-A::before {
  padding: 0.689em 0.778em 0 0;
  content: "\25A1";
}

mjx-c.mjx-c1D44E.TEX-I::before {
  padding: 0.441em 0.529em 0.01em 0;
  content: "a";
}

mjx-c.mjx-c230A.TEX-S2::before {
  padding: 1.15em 0.528em 0.649em 0;
  content: "\230A";
}

mjx-c.mjx-c2309.TEX-S2::before {
  padding: 1.15em 0.528em 0.649em 0;
  content: "\2309";
}

mjx-c.mjx-c230A.TEX-S3::before {
  padding: 1.45em 0.583em 0.949em 0;
  content: "\230A";
}

mjx-c.mjx-c230B.TEX-S3::before {
  padding: 1.45em 0.583em 0.949em 0;
  content: "\230B";
}

mjx-c.mjx-c230A.TEX-S4::before {
  padding: 1.75em 0.639em 1.249em 0;
  content: "\230A";
}

mjx-c.mjx-c230B.TEX-S4::before {
  padding: 1.75em 0.639em 1.249em 0;
  content: "\230B";
}

mjx-c.mjx-c226A::before {
  padding: 0.568em 1em 0.067em 0;
  content: "\226A";
}

mjx-c.mjx-c1D435.TEX-I::before {
  padding: 0.683em 0.759em 0 0;
  content: "B";
}
</style></head>
<body>
    <nav>
        <div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 48 48" style="position:absolute;top:4px;right: 4px;">
                <path d="M0 0h48v48h-48z" fill="none"></path>
                <path d="M6 36h36v-4h-36v4zm0-10h36v-4h-36v4zm0-14v4h36v-4h-36z"></path>
            </svg>
            <h2><a href="/Pages">Pages</a></h2>
<ul>
    <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Raspberry-Pi/index.html">Raspberry Pi</a>
    <ul>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Raspberry-Pi/Installation+Setup/index.html">Installation and Setup</a>
        <ul>
            <li><span class="ftriangle"></span><a class="" href="../../../../Raspberry-Pi/Installation+Setup/Setting-up-Ubuntu.html">Installing and Setting up Ubuntu</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../../../Raspberry-Pi/Installation+Setup/WiFi-Setup.html">Setting up the WiFi Connection</a></li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Raspberry-Pi/Python-Development/index.html">Python Development</a>
        <ul>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Raspberry-Pi/C++-Development-RPiOS/index.html">Ubuntu to Raspberry Pi OS Cross C++ Development</a>
        <ul>
            <li><span class="ftriangle"></span><a class="" href="../../../../Raspberry-Pi/C++-Development-RPiOS/Installation.html">Installation and Setup</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../../../Raspberry-Pi/C++-Development-RPiOS/Development-setup.html">Development setup</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../../../Raspberry-Pi/C++-Development-RPiOS/Building-example-project.html">Building the C++ example project</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../../../Raspberry-Pi/C++-Development-RPiOS/Debugging.html">Remote debugging</a></li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Raspberry-Pi/C++-Development-Ubuntu/index.html">Ubuntu to Ubuntu Cross C++ Development</a>
        <ul>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Raspberry-Pi/C++-Development/index.html">C++ Development using Docker</a>
        <ul>
            <li><span class="ftriangle"></span><a class="" href="../../../../Raspberry-Pi/C++-Development/Installation.html">Installation and setup</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../../../Raspberry-Pi/C++-Development/Building-The-Toolchain.html">Building the Cross-Compilation Toolchain</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../../../Raspberry-Pi/C++-Development/Dependencies.html">Cross-Compiling the Dependencies</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../../../Raspberry-Pi/C++-Development/Installing-Dependencies.html">Installing the dependencies on the Pi</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../../../Raspberry-Pi/C++-Development/Cpp-Program.html">Cross-Compiling the C++ Example Project</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../../../Raspberry-Pi/C++-Development/Debugging.html">Debugging</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../../../Raspberry-Pi/C++-Development/Speedrun.html">Speedrun</a></li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Raspberry-Pi/NEON/index.html">NEON</a>
        <ul>
            <li><span class="ftriangle"></span><a class="" href="../../../../Raspberry-Pi/NEON/Division.html">Division</a></li>
        </ul>
        </li>
    </ul>
    </li>
    <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Arduino/index.html">Arduino</a>
    <ul>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Arduino/Audio-and-Signal-Processing/index.html">Audio and Signal Processing</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Arduino/Audio-and-Signal-Processing/VU-Meters/index.html">VU Meters</a>
            <ul>
                <li><span class="ftriangle"></span><a class="" href="../../../../Arduino/Audio-and-Signal-Processing/VU-Meters/Model.html">Model of a moving-coil galvanometer</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../../../Arduino/Audio-and-Signal-Processing/VU-Meters/Damped-Harmonic-Oscillator.html">The Damped Harmonic Oscillator</a></li>
            </ul>
            </li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Arduino/Control-Surface/index.html">Control Surface</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Arduino/Control-Surface/Developers/index.html">Developers</a>
            <ul>
                <li><span class="ftriangle"></span><a class="" href="../../../../Arduino/Control-Surface/Developers/Installation.html">Installation</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../../../Arduino/Control-Surface/Developers/Style.html">Style</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../../../Arduino/Control-Surface/Developers/Tests.html">Tests</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../../../Arduino/Control-Surface/Developers/Generating-Documentation.html">Generating Documentation</a></li>
            </ul>
            </li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Arduino/Control-Theory/index.html">Control Theory</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Arduino/Control-Theory/Motor-Fader/index.html">Motorized Faders</a>
            <ul>
                <li><span class="ftriangle"></span><a class="" href="../../../../Arduino/Control-Theory/Motor-Fader/PID-Controllers.html">PID Controllers</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../../../Arduino/Control-Theory/Motor-Fader/PID-Cpp-Implementation.html">C++ Implementation</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../../../Arduino/Control-Theory/Motor-Fader/PID-Tuning.html">PID Tuning</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../../../Arduino/Control-Theory/Motor-Fader/Architecture.html">Architecture and Design Decisions</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../../../Arduino/Control-Theory/Motor-Fader/Hardware.html">Hardware</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../../../Arduino/Control-Theory/Motor-Fader/Configuration.html">Configuration options and common use cases</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../../../Arduino/Control-Theory/Motor-Fader/ATmega328P-Code.html">ATmega328P Code</a></li>
            </ul>
            </li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Arduino/Bootloaders/index.html">Bootloaders</a>
        <ul>
            <li><span class="ftriangle"></span><a class="" href="../../../../Arduino/Bootloaders/ATmega328P-custom-frequency.html">Compiling Optiboot - ATmega328P at custom frequency</a></li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Arduino/ESP8266/index.html">ESP8266</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Arduino/ESP8266/Flashing/index.html">Flashing</a>
            <ul>
                <li><span class="ftriangle"></span><a class="" href="../../../../Arduino/ESP8266/Flashing/Flashing-With-an-Arduino.html">Flashing the ESP8266 with an Arduino UNO</a></li>
            </ul>
            </li>
        </ul>
        </li>
    </ul>
    </li>
    <li class="expanded"><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../index.html">Mathematics &amp; Engineering</a>
    <ul>
        <li class="expanded"><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../index.html">Systems and Control Theory</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../Analog-Filters/index.html">Analog Filters &amp; Systems</a>
            <ul>
                <li><span class="ftriangle"></span><a class="" href="../../Analog-Filters/Butterworth-Filters.html">Butterworth Filters</a></li>
            </ul>
            </li>
            <li class="expanded"><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../index.html">Digital Filters &amp; Systems</a>
            <ul>
                <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/index.html">DTLTI Systems, Transfer Functions, and the Z-transform</a>
                <ul>
                    <li><span class="ftriangle"></span><a class="" href="../DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/DTLTI-Systems.html">DTLTI Systems</a></li>
                    <li><span class="ftriangle"></span><a class="" href="../DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/Impulse-and-Step-Response.html">Impulse and Step Response</a></li>
                    <li><span class="ftriangle"></span><a class="" href="../DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/Convolutions.html">Convolutions</a></li>
                    <li><span class="ftriangle"></span><a class="" href="../DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/The-Z-transform.html">The Z-transform</a></li>
                </ul>
                </li>
                <li class="expanded"><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="index.html">Exponential Moving Average</a>
                <ul>
                    <li><span class="ftriangle"></span><a class="" href="Exponential-Moving-Average.html">Exponential Moving Average</a></li>
                    <li><span class="ftriangle"></span><a class="" href="Filtering-in-MATLAB.html">Filtering in MATLAB</a></li>
                    <li><span class="ftriangle"></span><a class="openEntry " href="C++Implementation.html">C++ Implementation</a></li>
                </ul>
                </li>
                <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../Simple Moving Average/index.html">Simple Moving Average</a>
                <ul>
                    <li><span class="ftriangle"></span><a class="" href="../Simple Moving Average/Simple-Moving-Average.html">Simple Moving Average</a></li>
                    <li><span class="ftriangle"></span><a class="" href="../Simple Moving Average/C++Implementation.html">C++ Implementation</a></li>
                </ul>
                </li>
                <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../Discretization/index.html">Discretization</a>
                <ul>
                    <li><span class="ftriangle"></span><a class="" href="../Discretization/Bilinear-transform.html">Bilinear Transform</a></li>
                    <li><span class="ftriangle"></span><a class="" href="../Discretization/Discretization-of-a-fourth-order-Butterworth-filter.html">Discretization of a Fourth-Order Butterworth Filter</a></li>
                </ul>
                </li>
                <li><span class="ftriangle"></span><a class="" href="../FIR-Notch.html">Simple Finite Impulse Response Notch Filter</a></li>
            </ul>
            </li>
        </ul>
        </li>
    </ul>
    </li>
    <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Programming/index.html">Programming</a>
    <ul>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Programming/Snippets/index.html">Snippets</a>
        <ul>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Programming/Cpp/index.html">C++</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Programming/Cpp/Practices/index.html">Best Practices</a>
            <ul>
                <li><span class="ftriangle"></span><a class="" href="../../../../Programming/Cpp/Practices/type-punning.html">Don't use unions or pointer casts for type punning</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../../../Programming/Cpp/Practices/c-style-casts.html">Don't use C-style casts</a></li>
            </ul>
            </li>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Programming/Cpp/Algorithms/index.html">Algorithms</a>
            <ul>
                <li><span class="ftriangle"></span><a class="" href="../../../../Programming/Cpp/Algorithms/Max_n_elements.html">Maximum N elements</a></li>
            </ul>
            </li>
        </ul>
        </li>
    </ul>
    </li>
    <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Ubuntu/index.html">Ubuntu</a>
    <ul>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Ubuntu/Software-Installation/index.html">Software Installation</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a class="" href="../../../../Ubuntu/Software-Installation/Arduino/index.html">Arduino</a>
            <ul>
                <li><span class="ftriangle"></span><a class="" href="../../../../Ubuntu/Software-Installation/Arduino/Arduino-IDE.html">Arduino IDE</a></li>
                <li><span class="ftriangle"></span><a class="" href="../../../../Ubuntu/Software-Installation/Arduino/Hairless-MIDI.html">The Hairless MIDI to Serial Bridge</a></li>
            </ul>
            </li>
            <li><span class="ftriangle"></span><a class="" href="../../../../Ubuntu/Software-Installation/Installing-Locally.html">Installing Locally</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../../../Ubuntu/Software-Installation/BlueZ.html">BlueZ with MIDI over BLE Support</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../../../Ubuntu/Software-Installation/Doxygen.html">Doxygen</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../../../Ubuntu/Software-Installation/Eclipse.html">Eclipse</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../../../Ubuntu/Software-Installation/Eigen3.html">Eigen</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../../../Ubuntu/Software-Installation/GoogleTest.html">GoogleTest</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../../../Ubuntu/Software-Installation/Java.html">Java</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../../../Ubuntu/Software-Installation/Python.html">Python</a></li>
            <li><span class="ftriangle"></span><a class="" href="../../../../Ubuntu/Software-Installation/VirtualBox.html">VirtualBox</a></li>
        </ul>
        </li>
    </ul>
    </li>
</ul>

            <i class="material-icons">
                <a href="/" title="Home">home</a>
            </i>
            <i class="material-icons">
                <a href="C++Implementation.pdf" title="Download as PDF">get_app</a>
            </i>
            <!-- <i class="material-icons">
                <a href="javascript:window.print()" title="Print this article" onclick="window.print(); return false;">print</a>
            </i> -->
            <i class="material-icons">
                <a href="https://github.com/tttapa/tttapa.github.io/issues/new" target="_blank" title="Comment or open an issue">feedback</a>
            </i>
        </div>
    </nav>
    <article>
        <h1 class="title">C++ Implementation</h1>
        <i class="author">Pieter P</i>
        <div class="main-content">
<div class="toc" id="toc">
  <script>
  function updateTocSize() {
    let toc = document.getElementById("toc");
    toc.style.maxHeight = toc.scrollHeight + 'px';
  }
  </script>  <h4 class="toc" onclick="if (this.parentElement.classList.toggle('expanded')) {updateTocSize();window.addEventListener('resize', updateTocSize);} else {this.parentElement.style = undefined;window.removeEventListener('resize', updateTocSize);}">Table of Contents <i class="material-icons">list</i></h4>
  <ul>
            <li><a href="#dividing-by-powers-of-2">Dividing by Powers of 2</a></li>
              <ul>
                <li><a href="#negative-numbers">Negative Numbers</a></li>
                <li><a href="#rounding">Rounding</a></li>
              </ul>
            <li><a href="#implementation-in-c">Implementation in C++</a></li>
            <li><a href="#signed-rounding-division">Signed Rounding Division</a></li>
              <ul>
                <li><a href="#implementation-of-signed-and-unsigned-division-by-a-multiple-of-two">Implementation of Signed and Unsigned Division by a Multiple of Two</a></li>
                <li><a href="#a-better-alternative-for-signed-division">A better alternative for signed division</a></li>
              </ul>
            <li><a href="#improved-c-implementation">Improved C++ implementation</a></li>
            <li><a href="#arduino-example">Arduino Example</a></li>
            <li><a href="#additional-resources">Additional resources</a></li>
  </ul></div>


<h3><a name="dividing-by-powers-of-2" href="#dividing-by-powers-of-2">Dividing by Powers of 2</a></h3>
<p>
    The factor <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D6FC TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi></math></mjx-assistive-mml></mjx-container> in the difference equation of the Exponential Moving
    Average filter is a number between zero and one. There are two main ways to
    implement this multiplication by <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D6FC TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi></math></mjx-assistive-mml></mjx-container>: Either we use floating point
    numbers and calculate the multiplication directly, or we use integers, and
    express the multiplication as a division by <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-TeXAtom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-TeXAtom><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D6FC TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3E"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mi>α</mi><mo>&gt;</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container>.<br>
    Both floating point multiplication and integer division are relatively
    expensive operations, especially on embedded devices or microcontrollers.
</p>
<p>
    We can, however, choose the value for <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D6FC TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi></math></mjx-assistive-mml></mjx-container> in such a way that
    <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-TeXAtom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-TeXAtom><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D6FC TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-msup space="4"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msup><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2208"></mjx-c></mjx-mo><mjx-TeXAtom space="4" texclass="ORD"><mjx-mi class="mjx-ds mjx-b"><mjx-c class="mjx-c2115 TEX-A"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mi>α</mi><mo>=</mo><msup><mn>2</mn><mi>k</mi></msup><mo>,</mo><mi>k</mi><mo>∈</mo><mrow data-mjx-texclass="ORD"><mi mathvariant="double-struck">N</mi></mrow></math></mjx-assistive-mml></mjx-container>.<br>
    This is useful, because a division by a power of two can be replaced by a
    very fast right bitshift:
    <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative" display="true"><mjx-math display="true" style="margin-left: 0; margin-right: 0" class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D6FC TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c22C5"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mfrac space="4"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.289em"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msup></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c226B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>α</mi><mo>⋅</mo><mi>x</mi><mo>=</mo><mfrac><mi>x</mi><msup><mn>2</mn><mi>k</mi></msup></mfrac><mo>=</mo><mi>x</mi><mo>≫</mo><mi>k</mi></math></mjx-assistive-mml></mjx-container>
</p>
<p>
    We can now rewrite the difference equation of the EMA with this optimization
    in mind:
    <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative" display="true"><mjx-math display="true" style="margin-left: 0; margin-right: 0" class=" MJX-TEX" aria-hidden="true"><mjx-mtable style="min-width: 16.744em"><mjx-table><mjx-itable><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0; padding-bottom: 0.15em"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0; padding-bottom: 0.15em"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D6FC TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D6FC TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0; padding-top: 0.15em; padding-bottom: 0.15em"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0; padding-top: 0.15em; padding-bottom: 0.15em"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D6FC TEX-I"></mjx-c></mjx-mi><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0; padding-top: 0.15em; padding-bottom: 0.15em"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0; padding-top: 0.15em; padding-bottom: 0.15em"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mfrac space="3"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.289em"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msup></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0; padding-top: 0.15em"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0; padding-top: 0.15em"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mrow space="3"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c226B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr></mjx-itable></mjx-table></mjx-mtable></mjx-math><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true" columnalign="right left" columnspacing="0em" rowspacing="3pt"><mtr><mtd><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo></mtd><mtd><mi></mi><mo>=</mo><mi>α</mi><mi>x</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy="false">)</mo><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>+</mo><mi>α</mi><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mi>x</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo><mo>−</mo><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo data-mjx-texclass="CLOSE">)</mo></mrow></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>+</mo><mfrac><mrow><mi>x</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo><mo>−</mo><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><msup><mn>2</mn><mi>k</mi></msup></mfrac></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>+</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mi>x</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo><mo>−</mo><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo data-mjx-texclass="CLOSE">)</mo></mrow><mo>≫</mo><mi>k</mi></mtd></mtr></mtable></math></mjx-assistive-mml></mjx-container>
</p>
<h4><a name="negative-numbers" href="#negative-numbers">Negative Numbers</a></h4>
<p>
    There's one caveat though: this doesn't work for negative numbers.
    For example, if we try to calculate the integer division <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn><mjx-TeXAtom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-TeXAtom><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mn>15</mn><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mn>4</mn></math></mjx-assistive-mml></mjx-container> using
    this method, we get the following answer:
    <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative" display="true"><mjx-math display="true" style="margin-left: 0; margin-right: 0" class=" MJX-TEX" aria-hidden="true"><mjx-mtable style="min-width: 12.152em"><mjx-table><mjx-itable><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0; padding-bottom: 0.15em"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn><mjx-TeXAtom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-TeXAtom><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0; padding-bottom: 0.15em"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c22C5"></mjx-c></mjx-mo><mjx-msup space="3"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.413em"><mjx-TeXAtom size="s" texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-TeXAtom></mjx-script></mjx-msup><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0; padding-top: 0.15em; padding-bottom: 0.15em"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c226B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0; padding-top: 0.15em; padding-bottom: 0.15em"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c226B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0; padding-top: 0.15em; padding-bottom: 0.15em"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0; padding-top: 0.15em; padding-bottom: 0.15em"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0; padding-top: 0.15em"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0; padding-top: 0.15em"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr></mjx-itable></mjx-table></mjx-mtable></mjx-math><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true" columnalign="right left" columnspacing="0em" rowspacing="3pt"><mtr><mtd><mo>−</mo><mn>15</mn><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mn>4</mn></mtd><mtd><mi></mi><mo>=</mo><mo>−</mo><mn>15</mn><mo>⋅</mo><msup><mn>2</mn><mrow data-mjx-texclass="ORD"><mo>−</mo><mn>2</mn></mrow></msup></mtd></mtr><mtr><mtd><mo>−</mo><mn>15</mn><mo>≫</mo><mn>2</mn></mtd><mtd><mi></mi><mo>=</mo><mn>0</mn><mi>b</mi><mn>11110001</mn><mo>≫</mo><mn>2</mn></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo><mn>0</mn><mi>b</mi><mn>11111100</mn></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo><mo>−</mo><mn>4</mn></mtd></mtr></mtable></math></mjx-assistive-mml></mjx-container>
    This is not what we expected! Integer division in programming languages such
    as C++ returns the quotient truncated towards zero, so we would expect a
    value of <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mn>3</mn></math></mjx-assistive-mml></mjx-container>. The result is close, but incorrect nonetheless.
</p>
<p>
    This means we'll have to be careful not to use this trick on any negative
    numbers. In our difference equation, both the input <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo></math></mjx-assistive-mml></mjx-container> and the output
    <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo></math></mjx-assistive-mml></mjx-container> will generally be positive numbers, so no problem there, but their
    difference can be negative.
    This is a problem. We'll have to come up with a different representation of
    the difference equation that doesn't require us to divide any negative
    numbers:
    <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative" display="true"><mjx-math display="true" style="margin-left: 0; margin-right: 0" class=" MJX-TEX" aria-hidden="true"><mjx-mtable style="min-width: 16.425em"><mjx-table><mjx-itable><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0; padding-bottom: 0.15em"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0; padding-bottom: 0.15em"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D6FC TEX-I"></mjx-c></mjx-mi><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0; padding-top: 0.15em; padding-bottom: 0.15em"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0; padding-top: 0.15em; padding-bottom: 0.15em"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mfrac space="3"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.289em"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msup></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0; padding-top: 0.15em; padding-bottom: 0.55em"><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.413em"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0; padding-top: 0.15em; padding-bottom: 0.55em"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-msup space="4"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.413em"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0; padding-top: 0.55em; padding-bottom: 0.55em"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0; padding-top: 0.55em; padding-bottom: 0.55em"><mjx-mtext class="mjx-n"><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c225C TEX-A"></mjx-c></mjx-mo><mjx-msup space="4"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.413em"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c21D4"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-msup space="4"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.413em"><mjx-TeXAtom size="s" texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0; padding-top: 0.55em"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0; padding-top: 0.55em"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-msup space="3"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.413em"><mjx-TeXAtom size="s" texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr></mjx-itable></mjx-table></mjx-mtable></mjx-math><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true" columnalign="right left" columnspacing="0em" rowspacing="3pt 0.3em 1.1em 1.1em 0.3em"><mtr><mtd><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo></mtd><mtd><mi></mi><mo>=</mo><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>+</mo><mi>α</mi><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mi>x</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo><mo>−</mo><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo data-mjx-texclass="CLOSE">)</mo></mrow></mtd></mtr><mtr><mtd><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo></mtd><mtd><mi></mi><mo>=</mo><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>+</mo><mfrac><mrow><mi>x</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo><mo>−</mo><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><msup><mn>2</mn><mi>k</mi></msup></mfrac></mtd></mtr><mtr><mtd><msup><mn>2</mn><mi>k</mi></msup><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo></mtd><mtd><mi></mi><mo>=</mo><msup><mn>2</mn><mi>k</mi></msup><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>+</mo><mi>x</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo><mo>−</mo><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mtd></mtr><mtr><mtd></mtd><mtd><mtext> </mtext><mi>z</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo><mo>≜</mo><msup><mn>2</mn><mi>k</mi></msup><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo><mo stretchy="false">⇔</mo><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo><mo>=</mo><msup><mn>2</mn><mrow data-mjx-texclass="ORD"><mo>−</mo><mi>k</mi></mrow></msup><mi>z</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo></mtd></mtr><mtr><mtd><mi>z</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo></mtd><mtd><mi></mi><mo>=</mo><mi>z</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>+</mo><mi>x</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo><mo>−</mo><msup><mn>2</mn><mrow data-mjx-texclass="ORD"><mo>−</mo><mi>k</mi></mrow></msup><mi>z</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mtd></mtr></mtable></math></mjx-assistive-mml></mjx-container>
    We now have to prove that <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></math></mjx-assistive-mml></mjx-container> is greater than or equal to zero.
    We'll prove this using induction:
<div style="padding-left: 2em">
    <u>Base case</u>: <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mstyle><mjx-mspace style="width: 1em"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mstyle scriptlevel="0"><mspace width="1em"></mspace></mstyle><mi>n</mi><mo>−</mo><mn>1</mn><mo>=</mo><mo>−</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container>
    <div style="padding: 0.75em">
        The value of <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo stretchy="false">[</mo><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></math></mjx-assistive-mml></mjx-container> is the initial state of the system. We can
        just choose any value, so we'll pick a value that's greater than or
        equal to zero: <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2265"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo stretchy="false">[</mo><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>≥</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container>.
    </div>
    <u>Induction step</u>: <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mstyle><mjx-mspace style="width: 1em"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mstyle scriptlevel="0"><mspace width="1em"></mspace></mstyle><mi>n</mi></math></mjx-assistive-mml></mjx-container>
    <div style="padding: 0.75em">
        Given that <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2265"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>≥</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container>, we can now use the difference equation
        to prove that <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo></math></mjx-assistive-mml></mjx-container> is also greater than zero:<br>
        <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative" display="true"><mjx-math display="true" style="margin-left: 0; margin-right: 0" class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-msup space="3"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.413em"><mjx-TeXAtom size="s" texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>z</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo><mo>=</mo><mi>z</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>+</mo><mi>x</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo><mo>−</mo><msup><mn>2</mn><mrow data-mjx-texclass="ORD"><mo>−</mo><mi>k</mi></mrow></msup><mi>z</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></math></mjx-assistive-mml></mjx-container>
        We know that the input <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo></math></mjx-assistive-mml></mjx-container> is always zero or positive. <br>
        Since <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3E"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c21D2"></mjx-c></mjx-mo><mjx-msup space="4"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em"><mjx-TeXAtom size="s" texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3C"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi><mo>&gt;</mo><mn>1</mn><mo stretchy="false">⇒</mo><msup><mn>2</mn><mrow data-mjx-texclass="ORD"><mo>−</mo><mi>k</mi></mrow></msup><mo>&lt;</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container>, and since <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></math></mjx-assistive-mml></mjx-container> is
        zero or positive as well, we know that <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2265"></mjx-c></mjx-mo><mjx-msup space="4"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em"><mjx-TeXAtom size="s" texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c21D2"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-msup space="3"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em"><mjx-TeXAtom size="s" texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2265"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>≥</mo><msup><mn>2</mn><mrow data-mjx-texclass="ORD"><mo>−</mo><mi>k</mi></mrow></msup><mi>z</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">⇒</mo><mi>z</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>−</mo><msup><mn>2</mn><mrow data-mjx-texclass="ORD"><mo>−</mo><mi>k</mi></mrow></msup><mi>z</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>≥</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container>.<br>
        Therefore, the entire right-hand side is always positive or zero,
        because it is a sum of two numbers that are themselves greater than
        or equal to zero. <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mstyle><mjx-mspace style="width: 1em"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-i"><mjx-c class="mjx-c25FB TEX-A"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mstyle scriptlevel="0"><mspace width="1em"></mspace></mstyle><mi>◻</mi></math></mjx-assistive-mml></mjx-container>
    </div>
</div>
</p>
<h4><a name="rounding" href="#rounding">Rounding</a></h4>
<p>
    A final improvement we can make to our division algorithm is to round the
    result to the nearest integer, instead of truncating it towards zero.<br>
    Consider the rounded result of the division <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-TeXAtom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-TeXAtom><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mi>b</mi></math></mjx-assistive-mml></mjx-container>. We can then express it
    as a flooring of the result plus one half:
    <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative" display="true"><mjx-math display="true" style="margin-left: 0; margin-right: 0" class=" MJX-TEX" aria-hidden="true"><mjx-mtable style="min-width: 7.656em"><mjx-table><mjx-itable><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0; padding-bottom: 0.15em"><mjx-mrow><mjx-mo class="mjx-lop"><mjx-c class="mjx-c230A TEX-S2"></mjx-c></mjx-mo><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-lop"><mjx-c class="mjx-c2309 TEX-S2"></mjx-c></mjx-mo></mjx-mrow><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0; padding-bottom: 0.15em"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230A TEX-S3"></mjx-c></mjx-mo><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mfrac space="3"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230B TEX-S3"></mjx-c></mjx-mo></mjx-mrow><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0; padding-top: 0.15em"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0; padding-top: 0.15em"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-s4"><mjx-c class="mjx-c230A TEX-S4"></mjx-c></mjx-mo><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mfrac space="3"><mjx-frac><mjx-num><mjx-nstrut></mjx-nstrut><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line></mjx-line><mjx-row><mjx-den><mjx-dstrut></mjx-dstrut><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-s4"><mjx-c class="mjx-c230B TEX-S4"></mjx-c></mjx-mo></mjx-mrow><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr></mjx-itable></mjx-table></mjx-mtable></mjx-math><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true" columnalign="right left" columnspacing="0em" rowspacing="3pt"><mtr><mtd><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">⌊</mo><mfrac><mi>a</mi><mi>b</mi></mfrac><mo data-mjx-texclass="CLOSE">⌉</mo></mrow></mtd><mtd><mi></mi><mo>=</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">⌊</mo><mfrac><mi>a</mi><mi>b</mi></mfrac><mo>+</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo data-mjx-texclass="CLOSE">⌋</mo></mrow></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">⌊</mo><mfrac><mrow><mi>a</mi><mo>+</mo><mfrac><mi>b</mi><mn>2</mn></mfrac></mrow><mi>b</mi></mfrac><mo data-mjx-texclass="CLOSE">⌋</mo></mrow></mtd></mtr></mtable></math></mjx-assistive-mml></mjx-container>
    When <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>b</mi></math></mjx-assistive-mml></mjx-container> is a power of two, this is equivalent to:
    <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative" display="true"><mjx-math display="true" style="margin-left: 0; margin-right: 0" class=" MJX-TEX" aria-hidden="true"><mjx-mtable style="min-width: 13.464em"><mjx-table><mjx-itable><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0; padding-bottom: 0.15em"><mjx-mrow><mjx-mo class="mjx-lop"><mjx-c class="mjx-c230A TEX-S2"></mjx-c></mjx-mo><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.289em"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msup></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-lop"><mjx-c class="mjx-c2309 TEX-S2"></mjx-c></mjx-mo></mjx-mrow><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0; padding-bottom: 0.15em"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230A TEX-S3"></mjx-c></mjx-mo><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.289em"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msup></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mfrac space="3"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230B TEX-S3"></mjx-c></mjx-mo></mjx-mrow><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0; padding-top: 0.15em; padding-bottom: 0.15em"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0; padding-top: 0.15em; padding-bottom: 0.15em"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-s4"><mjx-c class="mjx-c230A TEX-S4"></mjx-c></mjx-mo><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mfrac space="3"><mjx-frac><mjx-num><mjx-nstrut></mjx-nstrut><mjx-msup size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msup></mjx-num><mjx-dbox><mjx-dtable><mjx-line></mjx-line><mjx-row><mjx-den><mjx-dstrut></mjx-dstrut><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.289em"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msup></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-s4"><mjx-c class="mjx-c230B TEX-S4"></mjx-c></mjx-mo></mjx-mrow><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0; padding-top: 0.15em; padding-bottom: 0.15em"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0; padding-top: 0.15em; padding-bottom: 0.15em"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230A TEX-S3"></mjx-c></mjx-mo><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-msup space="3"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em"><mjx-TeXAtom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-TeXAtom></mjx-script></mjx-msup></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.289em"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msup></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230B TEX-S3"></mjx-c></mjx-mo></mjx-mrow><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0; padding-top: 0.15em"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0; padding-top: 0.15em"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c226A"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c226B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr></mjx-itable></mjx-table></mjx-mtable></mjx-math><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true" columnalign="right left" columnspacing="0em" rowspacing="3pt"><mtr><mtd><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">⌊</mo><mfrac><mi>a</mi><msup><mn>2</mn><mi>k</mi></msup></mfrac><mo data-mjx-texclass="CLOSE">⌉</mo></mrow></mtd><mtd><mi></mi><mo>=</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">⌊</mo><mfrac><mi>a</mi><msup><mn>2</mn><mi>k</mi></msup></mfrac><mo>+</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo data-mjx-texclass="CLOSE">⌋</mo></mrow></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">⌊</mo><mfrac><mrow><mi>a</mi><mo>+</mo><mfrac><msup><mn>2</mn><mi>k</mi></msup><mn>2</mn></mfrac></mrow><msup><mn>2</mn><mi>k</mi></msup></mfrac><mo data-mjx-texclass="CLOSE">⌋</mo></mrow></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">⌊</mo><mfrac><mrow><mi>a</mi><mo>+</mo><msup><mn>2</mn><mrow data-mjx-texclass="ORD"><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><msup><mn>2</mn><mi>k</mi></msup></mfrac><mo data-mjx-texclass="CLOSE">⌋</mo></mrow></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mi>a</mi><mo>+</mo><mn>1</mn><mo>≪</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mi>k</mi><mo>−</mo><mn>1</mn><mo data-mjx-texclass="CLOSE">)</mo></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow><mo>≫</mo><mi>k</mi></mtd></mtr></mtable></math></mjx-assistive-mml></mjx-container>
</p>

<h3><a name="implementation-in-c" href="#implementation-in-c">Implementation in C++</a></h3>

<p>
    We now have everything in place to write a basic implementation of the EMA in C++:
</p>

<div class="codesnippet"><style>pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.pygments122 .hll { background-color: #ffffcc }
.pygments122 { background: #ffffff; }
.pygments122 .c { color: #008000 } /* Comment */
.pygments122 .err { border: 1px solid #FF0000 } /* Error */
.pygments122 .k { color: #0000ff } /* Keyword */
.pygments122 .l { color: #0000FF } /* Literal */
.pygments122 .ch { color: #008000 } /* Comment.Hashbang */
.pygments122 .cm { color: #008000 } /* Comment.Multiline */
.pygments122 .cp { color: #af00db } /* Comment.Preproc */
.pygments122 .cpf { color: #a31515 } /* Comment.PreprocFile */
.pygments122 .c1 { color: #008000 } /* Comment.Single */
.pygments122 .cs { color: #008000 } /* Comment.Special */
.pygments122 .ge { font-style: italic } /* Generic.Emph */
.pygments122 .gh { font-weight: bold } /* Generic.Heading */
.pygments122 .gp { font-weight: bold } /* Generic.Prompt */
.pygments122 .gs { font-weight: bold } /* Generic.Strong */
.pygments122 .gu { font-weight: bold } /* Generic.Subheading */
.pygments122 .kc { color: #4e8ae9 } /* Keyword.Constant */
.pygments122 .kd { color: #0000ff } /* Keyword.Declaration */
.pygments122 .kn { color: #af00db } /* Keyword.Namespace */
.pygments122 .kp { color: #0000ff } /* Keyword.Pseudo */
.pygments122 .kr { color: #0000ff } /* Keyword.Reserved */
.pygments122 .kt { color: #2b91af } /* Keyword.Type */
.pygments122 .ld { color: #0000FF } /* Literal.Date */
.pygments122 .m { color: #0000FF } /* Literal.Number */
.pygments122 .s { color: #a31515 } /* Literal.String */
.pygments122 .na { color: #001080 } /* Name.Attribute */
.pygments122 .nb { color: #795e26 } /* Name.Builtin */
.pygments122 .nc { color: #2b91af } /* Name.Class */
.pygments122 .no { color: #0000FF } /* Name.Constant */
.pygments122 .nf { color: #795e26 } /* Name.Function */
.pygments122 .nl { color: #AF00DB } /* Name.Label */
.pygments122 .nn { color: #000000 } /* Name.Namespace */
.pygments122 .nt { color: #800000 } /* Name.Tag */
.pygments122 .nv { color: #0F1E87 } /* Name.Variable */
.pygments122 .ow { color: #0000ff } /* Operator.Word */
.pygments122 .mb { color: #09885a } /* Literal.Number.Bin */
.pygments122 .mf { color: #09885a } /* Literal.Number.Float */
.pygments122 .mh { color: #09885a } /* Literal.Number.Hex */
.pygments122 .mi { color: #09885a } /* Literal.Number.Integer */
.pygments122 .mo { color: #09885a } /* Literal.Number.Oct */
.pygments122 .sa { color: #a31515 } /* Literal.String.Affix */
.pygments122 .sb { color: #a31515 } /* Literal.String.Backtick */
.pygments122 .sc { color: #a31515 } /* Literal.String.Char */
.pygments122 .dl { color: #a31515 } /* Literal.String.Delimiter */
.pygments122 .sd { color: #a31515 } /* Literal.String.Doc */
.pygments122 .s2 { color: #a31515 } /* Literal.String.Double */
.pygments122 .se { color: #a31515 } /* Literal.String.Escape */
.pygments122 .sh { color: #a31515 } /* Literal.String.Heredoc */
.pygments122 .si { color: #a31515 } /* Literal.String.Interpol */
.pygments122 .sx { color: #a31515 } /* Literal.String.Other */
.pygments122 .sr { color: #a31515 } /* Literal.String.Regex */
.pygments122 .s1 { color: #a31515 } /* Literal.String.Single */
.pygments122 .ss { color: #a31515 } /* Literal.String.Symbol */
.pygments122 .bp { color: #795e26 } /* Name.Builtin.Pseudo */
.pygments122 .fm { color: #795e26 } /* Name.Function.Magic */
.pygments122 .vc { color: #0F1E87 } /* Name.Variable.Class */
.pygments122 .vg { color: #0F1E87 } /* Name.Variable.Global */
.pygments122 .vi { color: #0F1E87 } /* Name.Variable.Instance */
.pygments122 .vm { color: #0F1E87 } /* Name.Variable.Magic */
.pygments122 .il { color: #09885a } /* Literal.Number.Integer.Long */
.pygments122 pre.snippet122 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/tttapa.github.io/blob/master/Pages-src/Raw-HTML/Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/resources/EMA-basic.hpp" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"></a>
<div class="pygments122"><pre class="lineNumbers snippet122"><code><span></span><span class="cp">#pragma once</span></code>
<code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstdint&gt;</span><span class="c1">     // uint8_t, uint16_t</span></code>
<code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;type_traits&gt;</span><span class="c1"> // std::is_unsigned</span></code>
<code></code>
<code><span class="c1">/// The first Exponential Moving Average implementation for unsigned integers.</span></code>
<code><span class="c1">///</span></code>
<code><span class="c1">/// @note   An improved implementation is presented further down the page.</span></code>
<code><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">uint_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">uint16_t</span><span class="o">&gt;</span></code>
<code><span class="k">class</span><span class="w"> </span><span class="nc">EMA</span><span class="w"> </span><span class="p">{</span></code>
<code><span class="w">  </span><span class="k">public</span><span class="o">:</span></code>
<code><span class="w">    </span><span class="c1">/// Update the filter with the given input and return the filtered output.</span></code>
<code><span class="w">    </span><span class="n">uint_t</span><span class="w"> </span><span class="k">operator</span><span class="p">()(</span><span class="n">uint_t</span><span class="w"> </span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span></code>
<code><span class="w">        </span><span class="n">state</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">input</span><span class="p">;</span></code>
<code><span class="w">        </span><span class="n">uint_t</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">half</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">K</span><span class="p">;</span></code>
<code><span class="w">        </span><span class="n">state</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">output</span><span class="p">;</span></code>
<code><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">output</span><span class="p">;</span></code>
<code><span class="w">    </span><span class="p">}</span></code>
<code></code>
<code><span class="w">    </span><span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_unsigned</span><span class="o">&lt;</span><span class="n">uint_t</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span></code>
<code><span class="w">                  </span><span class="s">"The `uint_t` type should be an unsigned integer, "</span></code>
<code><span class="w">                  </span><span class="s">"otherwise, the division using bit shifts is invalid."</span><span class="p">);</span></code>
<code></code>
<code><span class="w">    </span><span class="c1">/// Fixed point representation of one half, used for rounding.</span></code>
<code><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">uint_t</span><span class="w"> </span><span class="n">half</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">K</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span></code>
<code></code>
<code><span class="w">  </span><span class="k">private</span><span class="o">:</span></code>
<code><span class="w">    </span><span class="n">uint_t</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span></code>
<code><span class="p">};</span></code></pre></div>
</div>

<p>
    Note how we save <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-msup space="3"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em"><mjx-TeXAtom size="s" texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo><mo>−</mo><msup><mn>2</mn><mrow data-mjx-texclass="ORD"><mo>−</mo><mi>k</mi></mrow></msup><mi>z</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo></math></mjx-assistive-mml></mjx-container> as the state, instead of just
    <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo></math></mjx-assistive-mml></mjx-container>.
    Otherwise, we would have to calculate <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em"><mjx-TeXAtom size="s" texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mrow data-mjx-texclass="ORD"><mo>−</mo><mi>k</mi></mrow></msup><mi>z</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo></math></mjx-assistive-mml></mjx-container> twice (once to
    calculate <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo></math></mjx-assistive-mml></mjx-container>, and once on the next iteration to calculate
    <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em"><mjx-TeXAtom size="s" texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mrow data-mjx-texclass="ORD"><mo>−</mo><mi>k</mi></mrow></msup><mi>z</mi><mo stretchy="false">[</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></math></mjx-assistive-mml></mjx-container>), and that would be unnecessary.
</p>

<h3><a name="signed-rounding-division" href="#signed-rounding-division">Signed Rounding Division</a></h3>

<p>
    It's possible to implement a signed division using bit shifts as well. The
    only difference is that we have to subtract 1 from the dividend if it's
    negative.
</p>
<p>
    On ARM and x86 platforms, the absolute performance difference between the
    signed and unsigned version is not too big, it requires just a few more
    instructions.
    However, on some other architectures, like the AVR architecture used by some
    Arduino microcontrollers, the division is by far the most expensive step of
    the EMA algorithm, so a slower signed division might have a significant
    impact on the overall performance. In theory, it should only take a couple
    instructions to conditionally subtract 1, based on the sign of the dividend,
    but this sometimes causes the compiler to refactor the entire division,
    resulting in a much slower algorithm.
</p>
<p>
    I provided two implementations of the signed division. Notice how on x86 and
    ARM the second one is faster, while on AVR, the first one is faster.
    The unsigned division is included for reference.
</p>
<p>
    The code was compiled using the <code>-O2</code> optimization level.
</p>

<h4><a name="implementation-of-signed-and-unsigned-division-by-a-multiple-of-two" href="#implementation-of-signed-and-unsigned-division-by-a-multiple-of-two">Implementation of Signed and Unsigned Division by a Multiple of Two</a></h4>
<div class="codesnippet"><style>pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.pygments163 .hll { background-color: #ffffcc }
.pygments163 { background: #ffffff; }
.pygments163 .c { color: #008000 } /* Comment */
.pygments163 .err { border: 1px solid #FF0000 } /* Error */
.pygments163 .k { color: #0000ff } /* Keyword */
.pygments163 .l { color: #0000FF } /* Literal */
.pygments163 .ch { color: #008000 } /* Comment.Hashbang */
.pygments163 .cm { color: #008000 } /* Comment.Multiline */
.pygments163 .cp { color: #af00db } /* Comment.Preproc */
.pygments163 .cpf { color: #a31515 } /* Comment.PreprocFile */
.pygments163 .c1 { color: #008000 } /* Comment.Single */
.pygments163 .cs { color: #008000 } /* Comment.Special */
.pygments163 .ge { font-style: italic } /* Generic.Emph */
.pygments163 .gh { font-weight: bold } /* Generic.Heading */
.pygments163 .gp { font-weight: bold } /* Generic.Prompt */
.pygments163 .gs { font-weight: bold } /* Generic.Strong */
.pygments163 .gu { font-weight: bold } /* Generic.Subheading */
.pygments163 .kc { color: #4e8ae9 } /* Keyword.Constant */
.pygments163 .kd { color: #0000ff } /* Keyword.Declaration */
.pygments163 .kn { color: #af00db } /* Keyword.Namespace */
.pygments163 .kp { color: #0000ff } /* Keyword.Pseudo */
.pygments163 .kr { color: #0000ff } /* Keyword.Reserved */
.pygments163 .kt { color: #2b91af } /* Keyword.Type */
.pygments163 .ld { color: #0000FF } /* Literal.Date */
.pygments163 .m { color: #0000FF } /* Literal.Number */
.pygments163 .s { color: #a31515 } /* Literal.String */
.pygments163 .na { color: #001080 } /* Name.Attribute */
.pygments163 .nb { color: #795e26 } /* Name.Builtin */
.pygments163 .nc { color: #2b91af } /* Name.Class */
.pygments163 .no { color: #0000FF } /* Name.Constant */
.pygments163 .nf { color: #795e26 } /* Name.Function */
.pygments163 .nl { color: #AF00DB } /* Name.Label */
.pygments163 .nn { color: #000000 } /* Name.Namespace */
.pygments163 .nt { color: #800000 } /* Name.Tag */
.pygments163 .nv { color: #0F1E87 } /* Name.Variable */
.pygments163 .ow { color: #0000ff } /* Operator.Word */
.pygments163 .mb { color: #09885a } /* Literal.Number.Bin */
.pygments163 .mf { color: #09885a } /* Literal.Number.Float */
.pygments163 .mh { color: #09885a } /* Literal.Number.Hex */
.pygments163 .mi { color: #09885a } /* Literal.Number.Integer */
.pygments163 .mo { color: #09885a } /* Literal.Number.Oct */
.pygments163 .sa { color: #a31515 } /* Literal.String.Affix */
.pygments163 .sb { color: #a31515 } /* Literal.String.Backtick */
.pygments163 .sc { color: #a31515 } /* Literal.String.Char */
.pygments163 .dl { color: #a31515 } /* Literal.String.Delimiter */
.pygments163 .sd { color: #a31515 } /* Literal.String.Doc */
.pygments163 .s2 { color: #a31515 } /* Literal.String.Double */
.pygments163 .se { color: #a31515 } /* Literal.String.Escape */
.pygments163 .sh { color: #a31515 } /* Literal.String.Heredoc */
.pygments163 .si { color: #a31515 } /* Literal.String.Interpol */
.pygments163 .sx { color: #a31515 } /* Literal.String.Other */
.pygments163 .sr { color: #a31515 } /* Literal.String.Regex */
.pygments163 .s1 { color: #a31515 } /* Literal.String.Single */
.pygments163 .ss { color: #a31515 } /* Literal.String.Symbol */
.pygments163 .bp { color: #795e26 } /* Name.Builtin.Pseudo */
.pygments163 .fm { color: #795e26 } /* Name.Function.Magic */
.pygments163 .vc { color: #0F1E87 } /* Name.Variable.Class */
.pygments163 .vg { color: #0F1E87 } /* Name.Variable.Global */
.pygments163 .vi { color: #0F1E87 } /* Name.Variable.Instance */
.pygments163 .vm { color: #0F1E87 } /* Name.Variable.Magic */
.pygments163 .il { color: #09885a } /* Literal.Number.Integer.Long */
.pygments163 pre.snippet163 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/tttapa.github.io/blob/master/Pages-src/Raw-HTML/Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/resources/Rounding-Division.cpp" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"></a>
<div class="pygments163"><pre class="lineNumbers snippet163"><code><span></span><span class="k">constexpr</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">K</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span></code>
<code></code>
<code><span class="kt">signed</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">div_s1</span><span class="p">(</span><span class="kt">signed</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span></code>
<code><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">round</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">K</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span></code>
<code><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span></code>
<code><span class="w">        </span><span class="n">round</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span></code>
<code><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">round</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">K</span><span class="p">;</span></code>
<code><span class="p">}</span></code>
<code></code>
<code><span class="kt">signed</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">div_s2</span><span class="p">(</span><span class="kt">signed</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span></code>
<code><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">neg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span></code>
<code><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">K</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">neg</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">K</span><span class="p">;</span></code>
<code><span class="p">}</span></code>
<code></code>
<code><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">div_u</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span></code>
<code><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">K</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)))</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">K</span><span class="p">;</span></code>
<code><span class="p">}</span></code></pre></div>
</div>
<h4 class="snippet-name"><a name="assembly-generated-on-x86-64-gcc-9-2" href="#assembly-generated-on-x86-64-gcc-9-2">Assembly Generated on x86_64 (GCC 9.2)</a></h4>
<div class="codesnippet"><style>pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.pygments166 .hll { background-color: #ffffcc }
.pygments166 { background: #ffffff; }
.pygments166 .c { color: #008000 } /* Comment */
.pygments166 .err { border: 1px solid #FF0000 } /* Error */
.pygments166 .k { color: #0000ff } /* Keyword */
.pygments166 .l { color: #0000FF } /* Literal */
.pygments166 .ch { color: #008000 } /* Comment.Hashbang */
.pygments166 .cm { color: #008000 } /* Comment.Multiline */
.pygments166 .cp { color: #af00db } /* Comment.Preproc */
.pygments166 .cpf { color: #a31515 } /* Comment.PreprocFile */
.pygments166 .c1 { color: #008000 } /* Comment.Single */
.pygments166 .cs { color: #008000 } /* Comment.Special */
.pygments166 .ge { font-style: italic } /* Generic.Emph */
.pygments166 .gh { font-weight: bold } /* Generic.Heading */
.pygments166 .gp { font-weight: bold } /* Generic.Prompt */
.pygments166 .gs { font-weight: bold } /* Generic.Strong */
.pygments166 .gu { font-weight: bold } /* Generic.Subheading */
.pygments166 .kc { color: #4e8ae9 } /* Keyword.Constant */
.pygments166 .kd { color: #0000ff } /* Keyword.Declaration */
.pygments166 .kn { color: #af00db } /* Keyword.Namespace */
.pygments166 .kp { color: #0000ff } /* Keyword.Pseudo */
.pygments166 .kr { color: #0000ff } /* Keyword.Reserved */
.pygments166 .kt { color: #2b91af } /* Keyword.Type */
.pygments166 .ld { color: #0000FF } /* Literal.Date */
.pygments166 .m { color: #0000FF } /* Literal.Number */
.pygments166 .s { color: #a31515 } /* Literal.String */
.pygments166 .na { color: #001080 } /* Name.Attribute */
.pygments166 .nb { color: #795e26 } /* Name.Builtin */
.pygments166 .nc { color: #2b91af } /* Name.Class */
.pygments166 .no { color: #0000FF } /* Name.Constant */
.pygments166 .nf { color: #795e26 } /* Name.Function */
.pygments166 .nl { color: #AF00DB } /* Name.Label */
.pygments166 .nn { color: #000000 } /* Name.Namespace */
.pygments166 .nt { color: #800000 } /* Name.Tag */
.pygments166 .nv { color: #0F1E87 } /* Name.Variable */
.pygments166 .ow { color: #0000ff } /* Operator.Word */
.pygments166 .mb { color: #09885a } /* Literal.Number.Bin */
.pygments166 .mf { color: #09885a } /* Literal.Number.Float */
.pygments166 .mh { color: #09885a } /* Literal.Number.Hex */
.pygments166 .mi { color: #09885a } /* Literal.Number.Integer */
.pygments166 .mo { color: #09885a } /* Literal.Number.Oct */
.pygments166 .sa { color: #a31515 } /* Literal.String.Affix */
.pygments166 .sb { color: #a31515 } /* Literal.String.Backtick */
.pygments166 .sc { color: #a31515 } /* Literal.String.Char */
.pygments166 .dl { color: #a31515 } /* Literal.String.Delimiter */
.pygments166 .sd { color: #a31515 } /* Literal.String.Doc */
.pygments166 .s2 { color: #a31515 } /* Literal.String.Double */
.pygments166 .se { color: #a31515 } /* Literal.String.Escape */
.pygments166 .sh { color: #a31515 } /* Literal.String.Heredoc */
.pygments166 .si { color: #a31515 } /* Literal.String.Interpol */
.pygments166 .sx { color: #a31515 } /* Literal.String.Other */
.pygments166 .sr { color: #a31515 } /* Literal.String.Regex */
.pygments166 .s1 { color: #a31515 } /* Literal.String.Single */
.pygments166 .ss { color: #a31515 } /* Literal.String.Symbol */
.pygments166 .bp { color: #795e26 } /* Name.Builtin.Pseudo */
.pygments166 .fm { color: #795e26 } /* Name.Function.Magic */
.pygments166 .vc { color: #0F1E87 } /* Name.Variable.Class */
.pygments166 .vg { color: #0F1E87 } /* Name.Variable.Global */
.pygments166 .vi { color: #0F1E87 } /* Name.Variable.Instance */
.pygments166 .vm { color: #0F1E87 } /* Name.Variable.Magic */
.pygments166 .il { color: #09885a } /* Literal.Number.Integer.Long */
.pygments166 pre.snippet166 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/tttapa.github.io/blob/master/Pages-src/Raw-HTML/Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/resources/Rounding-Division-x86_64.S" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"></a>
<div class="pygments166"><pre class="lineNumbers snippet166"><code><span></span><span class="nf">div_s1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="o">:</span></code>
<code><span class="w">        </span><span class="n">mov</span><span class="w">     </span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="n">edi</span></code>
<code><span class="w">        </span><span class="n">not</span><span class="w">     </span><span class="n">eax</span></code>
<code><span class="w">        </span><span class="n">shr</span><span class="w">     </span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="m">31</span></code>
<code><span class="w">        </span><span class="n">lea</span><span class="w">     </span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">rax</span><span class="m">+3</span><span class="o">+</span><span class="n">rdi</span><span class="p">]</span></code>
<code><span class="w">        </span><span class="n">sar</span><span class="w">     </span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="m">3</span></code>
<code><span class="w">        </span><span class="n">ret</span></code>
<code></code>
<code><span class="nf">div_s2</span><span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="o">:</span></code>
<code><span class="w">        </span><span class="n">lea</span><span class="w">     </span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">rdi</span><span class="m">+4</span><span class="p">]</span></code>
<code><span class="w">        </span><span class="n">shr</span><span class="w">     </span><span class="n">edi</span><span class="p">,</span><span class="w"> </span><span class="m">31</span></code>
<code><span class="w">        </span><span class="n">sub</span><span class="w">     </span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="n">edi</span></code>
<code><span class="w">        </span><span class="n">sar</span><span class="w">     </span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="m">3</span></code>
<code><span class="w">        </span><span class="n">ret</span></code>
<code></code>
<code><span class="nf">div_u</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="n">int</span><span class="p">)</span><span class="o">:</span></code>
<code><span class="w">        </span><span class="n">lea</span><span class="w">     </span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">rdi</span><span class="m">+4</span><span class="p">]</span></code>
<code><span class="w">        </span><span class="n">shr</span><span class="w">     </span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="m">3</span></code>
<code><span class="w">        </span><span class="n">ret</span></code></pre></div>
</div>
<h4 class="snippet-name"><a name="assembly-generated-on-arm-64-gcc-8-2" href="#assembly-generated-on-arm-64-gcc-8-2">Assembly Generated on ARM 64 (GCC 8.2)</a></h4>
<div class="codesnippet"><style>pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.pygments170 .hll { background-color: #ffffcc }
.pygments170 { background: #ffffff; }
.pygments170 .c { color: #008000 } /* Comment */
.pygments170 .err { border: 1px solid #FF0000 } /* Error */
.pygments170 .k { color: #0000ff } /* Keyword */
.pygments170 .l { color: #0000FF } /* Literal */
.pygments170 .ch { color: #008000 } /* Comment.Hashbang */
.pygments170 .cm { color: #008000 } /* Comment.Multiline */
.pygments170 .cp { color: #af00db } /* Comment.Preproc */
.pygments170 .cpf { color: #a31515 } /* Comment.PreprocFile */
.pygments170 .c1 { color: #008000 } /* Comment.Single */
.pygments170 .cs { color: #008000 } /* Comment.Special */
.pygments170 .ge { font-style: italic } /* Generic.Emph */
.pygments170 .gh { font-weight: bold } /* Generic.Heading */
.pygments170 .gp { font-weight: bold } /* Generic.Prompt */
.pygments170 .gs { font-weight: bold } /* Generic.Strong */
.pygments170 .gu { font-weight: bold } /* Generic.Subheading */
.pygments170 .kc { color: #4e8ae9 } /* Keyword.Constant */
.pygments170 .kd { color: #0000ff } /* Keyword.Declaration */
.pygments170 .kn { color: #af00db } /* Keyword.Namespace */
.pygments170 .kp { color: #0000ff } /* Keyword.Pseudo */
.pygments170 .kr { color: #0000ff } /* Keyword.Reserved */
.pygments170 .kt { color: #2b91af } /* Keyword.Type */
.pygments170 .ld { color: #0000FF } /* Literal.Date */
.pygments170 .m { color: #0000FF } /* Literal.Number */
.pygments170 .s { color: #a31515 } /* Literal.String */
.pygments170 .na { color: #001080 } /* Name.Attribute */
.pygments170 .nb { color: #795e26 } /* Name.Builtin */
.pygments170 .nc { color: #2b91af } /* Name.Class */
.pygments170 .no { color: #0000FF } /* Name.Constant */
.pygments170 .nf { color: #795e26 } /* Name.Function */
.pygments170 .nl { color: #AF00DB } /* Name.Label */
.pygments170 .nn { color: #000000 } /* Name.Namespace */
.pygments170 .nt { color: #800000 } /* Name.Tag */
.pygments170 .nv { color: #0F1E87 } /* Name.Variable */
.pygments170 .ow { color: #0000ff } /* Operator.Word */
.pygments170 .mb { color: #09885a } /* Literal.Number.Bin */
.pygments170 .mf { color: #09885a } /* Literal.Number.Float */
.pygments170 .mh { color: #09885a } /* Literal.Number.Hex */
.pygments170 .mi { color: #09885a } /* Literal.Number.Integer */
.pygments170 .mo { color: #09885a } /* Literal.Number.Oct */
.pygments170 .sa { color: #a31515 } /* Literal.String.Affix */
.pygments170 .sb { color: #a31515 } /* Literal.String.Backtick */
.pygments170 .sc { color: #a31515 } /* Literal.String.Char */
.pygments170 .dl { color: #a31515 } /* Literal.String.Delimiter */
.pygments170 .sd { color: #a31515 } /* Literal.String.Doc */
.pygments170 .s2 { color: #a31515 } /* Literal.String.Double */
.pygments170 .se { color: #a31515 } /* Literal.String.Escape */
.pygments170 .sh { color: #a31515 } /* Literal.String.Heredoc */
.pygments170 .si { color: #a31515 } /* Literal.String.Interpol */
.pygments170 .sx { color: #a31515 } /* Literal.String.Other */
.pygments170 .sr { color: #a31515 } /* Literal.String.Regex */
.pygments170 .s1 { color: #a31515 } /* Literal.String.Single */
.pygments170 .ss { color: #a31515 } /* Literal.String.Symbol */
.pygments170 .bp { color: #795e26 } /* Name.Builtin.Pseudo */
.pygments170 .fm { color: #795e26 } /* Name.Function.Magic */
.pygments170 .vc { color: #0F1E87 } /* Name.Variable.Class */
.pygments170 .vg { color: #0F1E87 } /* Name.Variable.Global */
.pygments170 .vi { color: #0F1E87 } /* Name.Variable.Instance */
.pygments170 .vm { color: #0F1E87 } /* Name.Variable.Magic */
.pygments170 .il { color: #09885a } /* Literal.Number.Integer.Long */
.pygments170 pre.snippet170 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/tttapa.github.io/blob/master/Pages-src/Raw-HTML/Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/resources/Rounding-Division-ARM.S" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"></a>
<div class="pygments170"><pre class="lineNumbers snippet170"><code><span></span><span class="nf">div_s1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="o">:</span></code>
<code><span class="w">        </span><span class="n">mvn</span><span class="w">     </span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">w0</span></code>
<code><span class="w">        </span><span class="n">add</span><span class="w">     </span><span class="n">w0</span><span class="p">,</span><span class="w"> </span><span class="n">w0</span><span class="p">,</span><span class="w"> </span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">lsr</span><span class="w"> </span><span class="m">31</span></code>
<code><span class="w">        </span><span class="n">add</span><span class="w">     </span><span class="n">w0</span><span class="p">,</span><span class="w"> </span><span class="n">w0</span><span class="p">,</span><span class="w"> </span><span class="m">3</span></code>
<code><span class="w">        </span><span class="n">asr</span><span class="w">     </span><span class="n">w0</span><span class="p">,</span><span class="w"> </span><span class="n">w0</span><span class="p">,</span><span class="w"> </span><span class="m">3</span></code>
<code><span class="w">        </span><span class="n">ret</span></code>
<code></code>
<code><span class="nf">div_s2</span><span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="o">:</span></code>
<code><span class="w">        </span><span class="n">add</span><span class="w">     </span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">w0</span><span class="p">,</span><span class="w"> </span><span class="m">4</span></code>
<code><span class="w">        </span><span class="n">sub</span><span class="w">     </span><span class="n">w0</span><span class="p">,</span><span class="w"> </span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">w0</span><span class="p">,</span><span class="w"> </span><span class="n">lsr</span><span class="w"> </span><span class="m">31</span></code>
<code><span class="w">        </span><span class="n">asr</span><span class="w">     </span><span class="n">w0</span><span class="p">,</span><span class="w"> </span><span class="n">w0</span><span class="p">,</span><span class="w"> </span><span class="m">3</span></code>
<code><span class="w">        </span><span class="n">ret</span></code>
<code></code>
<code><span class="nf">div_u</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="n">int</span><span class="p">)</span><span class="o">:</span></code>
<code><span class="w">        </span><span class="n">add</span><span class="w">     </span><span class="n">w0</span><span class="p">,</span><span class="w"> </span><span class="n">w0</span><span class="p">,</span><span class="w"> </span><span class="m">4</span></code>
<code><span class="w">        </span><span class="n">lsr</span><span class="w">     </span><span class="n">w0</span><span class="p">,</span><span class="w"> </span><span class="n">w0</span><span class="p">,</span><span class="w"> </span><span class="m">3</span></code>
<code><span class="w">        </span><span class="n">ret</span></code></pre></div>
</div>
<h4 class="snippet-name"><a name="assembly-generated-on-avr-gcc-5-3" href="#assembly-generated-on-avr-gcc-5-3">Assembly Generated on AVR (GCC 5.3)</a></h4>
<div class="codesnippet"><style>pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.pygments174 .hll { background-color: #ffffcc }
.pygments174 { background: #ffffff; }
.pygments174 .c { color: #008000 } /* Comment */
.pygments174 .err { border: 1px solid #FF0000 } /* Error */
.pygments174 .k { color: #0000ff } /* Keyword */
.pygments174 .l { color: #0000FF } /* Literal */
.pygments174 .ch { color: #008000 } /* Comment.Hashbang */
.pygments174 .cm { color: #008000 } /* Comment.Multiline */
.pygments174 .cp { color: #af00db } /* Comment.Preproc */
.pygments174 .cpf { color: #a31515 } /* Comment.PreprocFile */
.pygments174 .c1 { color: #008000 } /* Comment.Single */
.pygments174 .cs { color: #008000 } /* Comment.Special */
.pygments174 .ge { font-style: italic } /* Generic.Emph */
.pygments174 .gh { font-weight: bold } /* Generic.Heading */
.pygments174 .gp { font-weight: bold } /* Generic.Prompt */
.pygments174 .gs { font-weight: bold } /* Generic.Strong */
.pygments174 .gu { font-weight: bold } /* Generic.Subheading */
.pygments174 .kc { color: #4e8ae9 } /* Keyword.Constant */
.pygments174 .kd { color: #0000ff } /* Keyword.Declaration */
.pygments174 .kn { color: #af00db } /* Keyword.Namespace */
.pygments174 .kp { color: #0000ff } /* Keyword.Pseudo */
.pygments174 .kr { color: #0000ff } /* Keyword.Reserved */
.pygments174 .kt { color: #2b91af } /* Keyword.Type */
.pygments174 .ld { color: #0000FF } /* Literal.Date */
.pygments174 .m { color: #0000FF } /* Literal.Number */
.pygments174 .s { color: #a31515 } /* Literal.String */
.pygments174 .na { color: #001080 } /* Name.Attribute */
.pygments174 .nb { color: #795e26 } /* Name.Builtin */
.pygments174 .nc { color: #2b91af } /* Name.Class */
.pygments174 .no { color: #0000FF } /* Name.Constant */
.pygments174 .nf { color: #795e26 } /* Name.Function */
.pygments174 .nl { color: #AF00DB } /* Name.Label */
.pygments174 .nn { color: #000000 } /* Name.Namespace */
.pygments174 .nt { color: #800000 } /* Name.Tag */
.pygments174 .nv { color: #0F1E87 } /* Name.Variable */
.pygments174 .ow { color: #0000ff } /* Operator.Word */
.pygments174 .mb { color: #09885a } /* Literal.Number.Bin */
.pygments174 .mf { color: #09885a } /* Literal.Number.Float */
.pygments174 .mh { color: #09885a } /* Literal.Number.Hex */
.pygments174 .mi { color: #09885a } /* Literal.Number.Integer */
.pygments174 .mo { color: #09885a } /* Literal.Number.Oct */
.pygments174 .sa { color: #a31515 } /* Literal.String.Affix */
.pygments174 .sb { color: #a31515 } /* Literal.String.Backtick */
.pygments174 .sc { color: #a31515 } /* Literal.String.Char */
.pygments174 .dl { color: #a31515 } /* Literal.String.Delimiter */
.pygments174 .sd { color: #a31515 } /* Literal.String.Doc */
.pygments174 .s2 { color: #a31515 } /* Literal.String.Double */
.pygments174 .se { color: #a31515 } /* Literal.String.Escape */
.pygments174 .sh { color: #a31515 } /* Literal.String.Heredoc */
.pygments174 .si { color: #a31515 } /* Literal.String.Interpol */
.pygments174 .sx { color: #a31515 } /* Literal.String.Other */
.pygments174 .sr { color: #a31515 } /* Literal.String.Regex */
.pygments174 .s1 { color: #a31515 } /* Literal.String.Single */
.pygments174 .ss { color: #a31515 } /* Literal.String.Symbol */
.pygments174 .bp { color: #795e26 } /* Name.Builtin.Pseudo */
.pygments174 .fm { color: #795e26 } /* Name.Function.Magic */
.pygments174 .vc { color: #0F1E87 } /* Name.Variable.Class */
.pygments174 .vg { color: #0F1E87 } /* Name.Variable.Global */
.pygments174 .vi { color: #0F1E87 } /* Name.Variable.Instance */
.pygments174 .vm { color: #0F1E87 } /* Name.Variable.Magic */
.pygments174 .il { color: #09885a } /* Literal.Number.Integer.Long */
.pygments174 pre.snippet174 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/tttapa.github.io/blob/master/Pages-src/Raw-HTML/Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/resources/Rounding-Division-AVR.S" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"></a>
<div class="pygments174"><pre class="lineNumbers snippet174"><code><span></span><span class="nf">div_s1</span><span class="p">(</span><span class="no">int</span><span class="p">):</span></code>
<code><span class="w">        </span><span class="nf">sbrc</span><span class="w"> </span><span class="no">r25</span><span class="p">,</span><span class="mi">7</span><span class="w">  </span><span class="c1"># Skip if Bit in Register is Cleared: val &gt;= 0</span></code>
<code><span class="w">        </span><span class="nf">rjmp</span><span class="w"> </span><span class="no">.L2</span></code>
<code><span class="w">                    </span><span class="c1"># val &gt;= 0</span></code>
<code><span class="w">        </span><span class="nf">adiw</span><span class="w"> </span><span class="no">r24</span><span class="p">,</span><span class="mi">4</span><span class="w">  </span><span class="c1"># Add Immediate to Word: val + (1 &lt;&lt; (K - 1)) = val + 4</span></code>
<code><span class="w">        </span><span class="nf">asr</span><span class="w"> </span><span class="no">r25</span><span class="w">     </span><span class="c1"># Arithmetic Shift Right: shift high byte (preserve sign)</span></code>
<code><span class="w">        </span><span class="nf">ror</span><span class="w"> </span><span class="no">r24</span><span class="w">     </span><span class="c1"># Rotate Right through Carry: shift low byte</span></code>
<code><span class="w">        </span><span class="nf">asr</span><span class="w"> </span><span class="no">r25</span><span class="w">     </span><span class="c1"># Two more times</span></code>
<code><span class="w">        </span><span class="nf">ror</span><span class="w"> </span><span class="no">r24</span></code>
<code><span class="w">        </span><span class="nf">asr</span><span class="w"> </span><span class="no">r25</span></code>
<code><span class="w">        </span><span class="nf">ror</span><span class="w"> </span><span class="no">r24</span></code>
<code><span class="w">        </span><span class="nf">ret</span></code>
<code><span class="nl">.L2:</span><span class="w">                </span></code>
<code><span class="w">                    </span><span class="c1"># val &lt; 0</span></code>
<code><span class="w">        </span><span class="nf">adiw</span><span class="w"> </span><span class="no">r24</span><span class="p">,</span><span class="mi">3</span><span class="w">  </span><span class="c1"># Add Immediate to Word: val + (1 &lt;&lt; (K - 1)) - 1 = val + 3</span></code>
<code><span class="w">        </span><span class="nf">asr</span><span class="w"> </span><span class="no">r25</span><span class="w">     </span><span class="c1"># Arithmetic Shift Right: shift high byte (preserve sign)</span></code>
<code><span class="w">        </span><span class="nf">ror</span><span class="w"> </span><span class="no">r24</span><span class="w">     </span><span class="c1"># Rotate Right through Carry: shift low byte</span></code>
<code><span class="w">        </span><span class="nf">asr</span><span class="w"> </span><span class="no">r25</span><span class="w">     </span><span class="c1"># Two more times</span></code>
<code><span class="w">        </span><span class="nf">ror</span><span class="w"> </span><span class="no">r24</span></code>
<code><span class="w">        </span><span class="nf">asr</span><span class="w"> </span><span class="no">r25</span></code>
<code><span class="w">        </span><span class="nf">ror</span><span class="w"> </span><span class="no">r24</span></code>
<code><span class="w">        </span><span class="nf">ret</span></code>
<code></code>
<code><span class="nf">div_s2</span><span class="p">(</span><span class="no">int</span><span class="p">):</span></code>
<code><span class="w">        </span><span class="nf">movw</span><span class="w"> </span><span class="no">r18</span><span class="p">,</span><span class="no">r24</span></code>
<code><span class="w">        </span><span class="nf">subi</span><span class="w"> </span><span class="no">r18</span><span class="p">,-</span><span class="mi">4</span><span class="w">   </span><span class="c1"># Subtract immediate: val + (1 &lt;&lt; (K - 1)) = val + 4</span></code>
<code><span class="w">        </span><span class="nf">sbci</span><span class="w"> </span><span class="no">r19</span><span class="p">,-</span><span class="mi">1</span><span class="w">   </span><span class="c1"># Subtract Immediate with Carry: (low byte)</span></code>
<code><span class="w">        </span><span class="nf">mov</span><span class="w"> </span><span class="no">r24</span><span class="p">,</span><span class="no">r25</span></code>
<code><span class="w">        </span><span class="nf">rol</span><span class="w"> </span><span class="no">r24</span><span class="w">       </span><span class="c1"># Rotate Left through Carry: C flag is now sign bit</span></code>
<code><span class="w">        </span><span class="nf">clr</span><span class="w"> </span><span class="no">r24</span><span class="w">       </span><span class="c1"># Clear Register</span></code>
<code><span class="w">        </span><span class="nf">rol</span><span class="w"> </span><span class="no">r24</span><span class="w">       </span><span class="c1"># Rotate Left through Carry: original sign bit is now lsb</span></code>
<code><span class="w">        </span><span class="nf">movw</span><span class="w"> </span><span class="no">r20</span><span class="p">,</span><span class="no">r18</span></code>
<code><span class="w">        </span><span class="nf">sub</span><span class="w"> </span><span class="no">r20</span><span class="p">,</span><span class="no">r24</span><span class="w">   </span><span class="c1"># Subtract without Carry: val + 4 - neg</span></code>
<code><span class="w">        </span><span class="nf">sbc</span><span class="w"> </span><span class="no">r21</span><span class="p">,</span><span class="no">__zero_reg__</span><span class="w">  </span><span class="c1"># Subtract with Carry: (low byte)</span></code>
<code><span class="w">        </span><span class="nf">movw</span><span class="w"> </span><span class="no">r24</span><span class="p">,</span><span class="no">r20</span></code>
<code><span class="w">        </span><span class="nf">asr</span><span class="w"> </span><span class="no">r25</span><span class="w">       </span><span class="c1"># Arithmetic Shift Right: shift high byte (preserve sign)</span></code>
<code><span class="w">        </span><span class="nf">ror</span><span class="w"> </span><span class="no">r24</span><span class="w">       </span><span class="c1"># Rotate Right through Carry: shift low byte</span></code>
<code><span class="w">        </span><span class="nf">asr</span><span class="w"> </span><span class="no">r25</span><span class="w">       </span><span class="c1"># Two more times</span></code>
<code><span class="w">        </span><span class="nf">ror</span><span class="w"> </span><span class="no">r24</span></code>
<code><span class="w">        </span><span class="nf">asr</span><span class="w"> </span><span class="no">r25</span></code>
<code><span class="w">        </span><span class="nf">ror</span><span class="w"> </span><span class="no">r24</span></code>
<code><span class="w">        </span><span class="nf">ret</span></code>
<code></code>
<code><span class="nf">div_u</span><span class="p">(</span><span class="no">unsigned</span><span class="w"> </span><span class="no">int</span><span class="p">):</span></code>
<code><span class="w">        </span><span class="nf">adiw</span><span class="w"> </span><span class="no">r24</span><span class="p">,</span><span class="mi">4</span><span class="w">  </span><span class="c1"># Add Immediate to Word: val + (1 &lt;&lt; (K - 1)) = val + 4</span></code>
<code><span class="w">        </span><span class="nf">lsr</span><span class="w"> </span><span class="no">r25</span><span class="w">     </span><span class="c1"># Logical Shift Right: shift high byte (no sign extension)</span></code>
<code><span class="w">        </span><span class="nf">ror</span><span class="w"> </span><span class="no">r24</span><span class="w">     </span><span class="c1"># Rotate Right through Carry: shift low byte</span></code>
<code><span class="w">        </span><span class="nf">lsr</span><span class="w"> </span><span class="no">r25</span><span class="w">     </span><span class="c1"># Two more times</span></code>
<code><span class="w">        </span><span class="nf">ror</span><span class="w"> </span><span class="no">r24</span></code>
<code><span class="w">        </span><span class="nf">lsr</span><span class="w"> </span><span class="no">r25</span></code>
<code><span class="w">        </span><span class="nf">ror</span><span class="w"> </span><span class="no">r24</span></code>
<code><span class="w">        </span><span class="nf">ret</span></code></pre></div>
</div>
<p>
    Keep in mind that an <code>int</code> on AVR is only 16 bits wide, whereas
    an <code>int</code> on ARM or x86 is 32 bits wide.<br>
    If you use 32-bit integers on AVR, the result is even more atrocious.
</p>
<p>
    You can experiment with the different implementations yourself on the
    <a href="https://godbolt.org/z/cmQJ7W">Compiler Explorer</a>.
</p>
<p>
    The main takeaway from this section is that signed (rounding) division is more expensive than unsigned division.
</p>

<h4><a name="a-better-alternative-for-signed-division" href="#a-better-alternative-for-signed-division">A better alternative for signed division</a></h4>

<p>
    Since the EMA is a linear filter, adding a constant offset to the input results in the same output, but with the
    same offset added to it. This means that we don't have to worry about negative numbers, we can just add a constant
    offset to the negative inputs, resulting in only positive numbers. At the output of the filter, the offset is simply
    removed again.
</p>
<p>
    This approach turns out to be significantly more efficient than the signed divisions discussed above. It allows us
    to use only unsigned rounding divisions, which are very cheap, and just a single extra subtraction to handle signed
    types. (Yes, just one, it turns out that adding the offset to the input and subtracting it again from the output
    can be combined.)
</p>

<p>
    <small>
        The assumption that the EMA is a linear filter is not really valid anymore, because of the rounding and
        truncation errors introduced by the use of integers in the algorithm. Luckily, the output of the filter
        turns out to be exactly the same, it doesn't matter if you use true signed rounding division or an
        unsigned rounding division with offset.
    </small>
</p>

<h3><a name="improved-c-implementation" href="#improved-c-implementation">Improved C++ implementation</a></h3>

<p>
    The following snippet is an improved version of the previous implementation: it supports both signed and unsigned
    inputs, allows initialization to a specific value, and has a check to prevent overflow.
</p>

<div class="codesnippet"><style>pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.pygments222 .hll { background-color: #ffffcc }
.pygments222 { background: #ffffff; }
.pygments222 .c { color: #008000 } /* Comment */
.pygments222 .err { border: 1px solid #FF0000 } /* Error */
.pygments222 .k { color: #0000ff } /* Keyword */
.pygments222 .l { color: #0000FF } /* Literal */
.pygments222 .ch { color: #008000 } /* Comment.Hashbang */
.pygments222 .cm { color: #008000 } /* Comment.Multiline */
.pygments222 .cp { color: #af00db } /* Comment.Preproc */
.pygments222 .cpf { color: #a31515 } /* Comment.PreprocFile */
.pygments222 .c1 { color: #008000 } /* Comment.Single */
.pygments222 .cs { color: #008000 } /* Comment.Special */
.pygments222 .ge { font-style: italic } /* Generic.Emph */
.pygments222 .gh { font-weight: bold } /* Generic.Heading */
.pygments222 .gp { font-weight: bold } /* Generic.Prompt */
.pygments222 .gs { font-weight: bold } /* Generic.Strong */
.pygments222 .gu { font-weight: bold } /* Generic.Subheading */
.pygments222 .kc { color: #4e8ae9 } /* Keyword.Constant */
.pygments222 .kd { color: #0000ff } /* Keyword.Declaration */
.pygments222 .kn { color: #af00db } /* Keyword.Namespace */
.pygments222 .kp { color: #0000ff } /* Keyword.Pseudo */
.pygments222 .kr { color: #0000ff } /* Keyword.Reserved */
.pygments222 .kt { color: #2b91af } /* Keyword.Type */
.pygments222 .ld { color: #0000FF } /* Literal.Date */
.pygments222 .m { color: #0000FF } /* Literal.Number */
.pygments222 .s { color: #a31515 } /* Literal.String */
.pygments222 .na { color: #001080 } /* Name.Attribute */
.pygments222 .nb { color: #795e26 } /* Name.Builtin */
.pygments222 .nc { color: #2b91af } /* Name.Class */
.pygments222 .no { color: #0000FF } /* Name.Constant */
.pygments222 .nf { color: #795e26 } /* Name.Function */
.pygments222 .nl { color: #AF00DB } /* Name.Label */
.pygments222 .nn { color: #000000 } /* Name.Namespace */
.pygments222 .nt { color: #800000 } /* Name.Tag */
.pygments222 .nv { color: #0F1E87 } /* Name.Variable */
.pygments222 .ow { color: #0000ff } /* Operator.Word */
.pygments222 .mb { color: #09885a } /* Literal.Number.Bin */
.pygments222 .mf { color: #09885a } /* Literal.Number.Float */
.pygments222 .mh { color: #09885a } /* Literal.Number.Hex */
.pygments222 .mi { color: #09885a } /* Literal.Number.Integer */
.pygments222 .mo { color: #09885a } /* Literal.Number.Oct */
.pygments222 .sa { color: #a31515 } /* Literal.String.Affix */
.pygments222 .sb { color: #a31515 } /* Literal.String.Backtick */
.pygments222 .sc { color: #a31515 } /* Literal.String.Char */
.pygments222 .dl { color: #a31515 } /* Literal.String.Delimiter */
.pygments222 .sd { color: #a31515 } /* Literal.String.Doc */
.pygments222 .s2 { color: #a31515 } /* Literal.String.Double */
.pygments222 .se { color: #a31515 } /* Literal.String.Escape */
.pygments222 .sh { color: #a31515 } /* Literal.String.Heredoc */
.pygments222 .si { color: #a31515 } /* Literal.String.Interpol */
.pygments222 .sx { color: #a31515 } /* Literal.String.Other */
.pygments222 .sr { color: #a31515 } /* Literal.String.Regex */
.pygments222 .s1 { color: #a31515 } /* Literal.String.Single */
.pygments222 .ss { color: #a31515 } /* Literal.String.Symbol */
.pygments222 .bp { color: #795e26 } /* Name.Builtin.Pseudo */
.pygments222 .fm { color: #795e26 } /* Name.Function.Magic */
.pygments222 .vc { color: #0F1E87 } /* Name.Variable.Class */
.pygments222 .vg { color: #0F1E87 } /* Name.Variable.Global */
.pygments222 .vi { color: #0F1E87 } /* Name.Variable.Instance */
.pygments222 .vm { color: #0F1E87 } /* Name.Variable.Magic */
.pygments222 .il { color: #09885a } /* Literal.Number.Integer.Long */
.pygments222 pre.snippet222 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/tttapa.github.io/blob/master/Pages-src/Raw-HTML/Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/resources/EMA.hpp" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"></a>
<div class="pygments222"><pre class="lineNumbers snippet222"><code><span></span><span class="cp">#pragma once</span></code>
<code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;type_traits&gt;</span><span class="c1"> // std::make_unsigned_t, make_signed_t, is_unsigned</span></code>
<code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;limits&gt;</span><span class="c1">      // std::numeric_limits</span></code>
<code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstdint&gt;</span><span class="c1">     // uint_fast16_t</span></code>
<code></code>
<code><span class="cm">/**</span></code>
<code><span class="cm"> * @brief   Exponential moving average filter.</span></code>
<code><span class="cm"> * </span></code>
<code><span class="cm"> * Fast integer EMA implementation where the weight factor is a power of two.</span></code>
<code><span class="cm"> * </span></code>
<code><span class="cm"> * Difference equation: @f$ y[n] = \alpha·x[n]+(1-\alpha)·y[n-1] @f$</span></code>
<code><span class="cm"> * where @f$ \alpha = \left(\frac{1}{2}\right)^{K} @f$, @f$ x @f$ is the</span></code>
<code><span class="cm"> * input sequence, and @f$ y @f$ is the output sequence.</span></code>
<code><span class="cm"> *</span></code>
<code><span class="cm"> * [An in-depth explanation of the EMA filter](https://tttapa.github.io/Pages/Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential%20Moving%20Average/)</span></code>
<code><span class="cm"> *</span></code>
<code><span class="cm"> * @tparam  K</span></code>
<code><span class="cm"> *          The amount of bits to shift by. This determines the location</span></code>
<code><span class="cm"> *          of the pole in the EMA transfer function, and therefore the</span></code>
<code><span class="cm"> *          cut-off frequency.  </span></code>
<code><span class="cm"> *          The higher this number, the more filtering takes place.  </span></code>
<code><span class="cm"> *          The pole location is @f$ 1 - 2^{-K} @f$.</span></code>
<code><span class="cm"> * @tparam  input_t</span></code>
<code><span class="cm"> *          The integer type to use for the input and output of the filter. </span></code>
<code><span class="cm"> *          Can be signed or unsigned.</span></code>
<code><span class="cm"> * @tparam  state_t</span></code>
<code><span class="cm"> *          The unsigned integer type to use for the internal state of the</span></code>
<code><span class="cm"> *          filter. A fixed-point representation with @f$ K @f$ fractional</span></code>
<code><span class="cm"> *          bits is used, so this type should be at least @f$ M + K @f$ bits</span></code>
<code><span class="cm"> *          wide, where @f$ M @f$ is the maximum number of bits of the input.</span></code>
<code><span class="cm"> *</span></code>
<code><span class="cm"> * Some examples of different combinations of template parameters:</span></code>
<code><span class="cm"> * </span></code>
<code><span class="cm"> * 1. Filtering the result of `analogRead`: analogRead returns an integer</span></code>
<code><span class="cm"> *    between 0 and 1023, which can be represented using 10 bits, so </span></code>
<code><span class="cm"> *    @f$ M = 10 @f$. If `input_t` and `output_t` are both `uint16_t`,</span></code>
<code><span class="cm"> *    the maximum shift factor `K` is @f$ 16 - M = 6 @f$. If `state_t`</span></code>
<code><span class="cm"> *    is increased to `uint32_t`, the maximum shift factor `K` is </span></code>
<code><span class="cm"> *    @f$ 32 - M = 22 @f$.</span></code>
<code><span class="cm"> * 2. Filtering a signed integer between -32768 and 32767: this can be </span></code>
<code><span class="cm"> *    represented using a 16-bit signed integer, so `input_t` is `int16_t`,</span></code>
<code><span class="cm"> *    and @f$ M = 16 @f$. (2¹⁵ = 32768)</span></code>
<code><span class="cm"> *    Let's say the shift factor `K` is 1, then the minimum width of </span></code>
<code><span class="cm"> *    `state_t` should be @f$ M + K = 17 @f$ bits, so `uint32_t` would be </span></code>
<code><span class="cm"> *    a sensible choice.</span></code>
<code><span class="cm"> */</span></code>
<code><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">K</span><span class="p">,</span></code>
<code><span class="w">          </span><span class="k">class</span><span class="w"> </span><span class="nc">input_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">uint_fast16_t</span><span class="p">,</span></code>
<code><span class="w">          </span><span class="k">class</span><span class="w"> </span><span class="nc">state_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unsigned_t</span><span class="o">&lt;</span><span class="n">input_t</span><span class="o">&gt;&gt;</span></code>
<code><span class="k">class</span><span class="w"> </span><span class="nc">EMA</span><span class="w"> </span><span class="p">{</span></code>
<code><span class="w">  </span><span class="k">public</span><span class="o">:</span></code>
<code><span class="w">    </span><span class="c1">/// Constructor: initialize filter to zero or optional given value.</span></code>
<code><span class="w">    </span><span class="n">EMA</span><span class="p">(</span><span class="n">input_t</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_t</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span></code>
<code><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="n">state</span><span class="p">(</span><span class="n">zero</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">state_t</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">K</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">initial</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span></code>
<code></code>
<code><span class="w">    </span><span class="c1">/// Update the filter with the given input and return the filtered output.</span></code>
<code><span class="w">    </span><span class="n">input_t</span><span class="w"> </span><span class="k">operator</span><span class="p">()(</span><span class="n">input_t</span><span class="w"> </span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span></code>
<code><span class="w">      </span><span class="n">state</span><span class="w">         </span><span class="o">+=</span><span class="w"> </span><span class="n">state_t</span><span class="p">(</span><span class="n">input</span><span class="p">);</span></code>
<code><span class="w">      </span><span class="n">state_t</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">half</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">K</span><span class="p">;</span></code>
<code><span class="w">      </span><span class="n">output</span><span class="w">        </span><span class="o">-=</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">K</span><span class="p">;</span></code>
<code><span class="w">      </span><span class="n">state</span><span class="w">         </span><span class="o">-=</span><span class="w"> </span><span class="n">output</span><span class="p">;</span></code>
<code><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">input_t</span><span class="p">(</span><span class="n">output</span><span class="p">);</span></code>
<code><span class="w">    </span><span class="p">}</span></code>
<code></code>
<code><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">state_t</span><span class="w"> </span></code>
<code><span class="w">      </span><span class="n">max_state</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">state_t</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">(),</span></code>
<code><span class="w">      </span><span class="n">half_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max_state</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span></code>
<code><span class="w">      </span><span class="n">zero</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">is_unsigned</span><span class="o">&lt;</span><span class="n">input_t</span><span class="o">&gt;::</span><span class="n">value</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">state_t</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">half_state</span><span class="p">,</span></code>
<code><span class="w">      </span><span class="n">half</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">K</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">state_t</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">K</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">state_t</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span></code>
<code><span class="w">  </span></code>
<code><span class="w">    </span><span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_unsigned</span><span class="o">&lt;</span><span class="n">state_t</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span><span class="w"> </span></code>
<code><span class="w">                  </span><span class="s">"state type should be unsigned"</span><span class="p">);</span></code>
<code></code>
<code><span class="w">    </span><span class="k">static_assert</span><span class="p">(</span><span class="n">max_state</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">input_t</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">(),</span></code>
<code><span class="w">                  </span><span class="s">"state type cannot be narrower than input type"</span><span class="p">);</span><span class="w">               </span></code>
<code></code>
<code><span class="w">    </span><span class="c1">/// Verify the input range to make sure it's compatible with the shift</span></code>
<code><span class="w">    </span><span class="c1">/// factor and the width of the state type.</span></code>
<code><span class="w">    </span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span></code>
<code><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">supports_range</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">min</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">max</span><span class="p">)</span><span class="w"> </span><span class="p">{</span></code>
<code><span class="w">      </span><span class="k">using</span><span class="w"> </span><span class="n">sstate_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_signed_t</span><span class="o">&lt;</span><span class="n">state_t</span><span class="o">&gt;</span><span class="p">;</span></code>
<code><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="o">&amp;&amp;</span></code>
<code><span class="w">             </span><span class="n">min</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">input_t</span><span class="o">&gt;::</span><span class="n">min</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span></code>
<code><span class="w">             </span><span class="n">max</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">input_t</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span></code>
<code><span class="w">             </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_unsigned</span><span class="o">&lt;</span><span class="n">input_t</span><span class="o">&gt;::</span><span class="n">value</span></code>
<code><span class="w">               </span><span class="o">?</span><span class="w"> </span><span class="n">state_t</span><span class="p">(</span><span class="n">max</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="n">max_state</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">K</span><span class="p">)</span></code>
<code><span class="w">               </span><span class="o">:</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="o">-</span><span class="n">sstate_t</span><span class="p">(</span><span class="n">max_state</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">K</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">  </span></code>
<code><span class="w">                 </span><span class="n">max</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">sstate_t</span><span class="p">(</span><span class="n">max_state</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">K</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)));</span></code>
<code><span class="w">    </span><span class="p">}</span></code>
<code></code>
<code><span class="w">  </span><span class="k">private</span><span class="o">:</span></code>
<code><span class="w">    </span><span class="n">state_t</span><span class="w"> </span><span class="n">state</span><span class="p">;</span></code>
<code><span class="p">};</span></code></pre></div>
</div>

<p>
    When the type is signed, an offset of <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em"><mjx-TeXAtom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D435 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-TeXAtom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mrow data-mjx-texclass="ORD"><mi>B</mi><mo>−</mo><mn>1</mn></mrow></msup></math></mjx-assistive-mml></mjx-container> is added, where <mjx-container class="MathJax" jax="CHTML" style="font-size: 113.1%; position: relative"><mjx-math class=" MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D435 TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi></math></mjx-assistive-mml></mjx-container> is the number of bits used to represent
    the state variable. This essentially shifts the value "zero" up to the middle of the range of the state.
</p>

<p>
    To check the range of the input for specific template parameters, you can use the <code>supports_range</code>
    method:
</p>

<div class="codesnippet"><style>pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.pygments236 .hll { background-color: #ffffcc }
.pygments236 { background: #ffffff; }
.pygments236 .c { color: #008000 } /* Comment */
.pygments236 .err { border: 1px solid #FF0000 } /* Error */
.pygments236 .k { color: #0000ff } /* Keyword */
.pygments236 .l { color: #0000FF } /* Literal */
.pygments236 .ch { color: #008000 } /* Comment.Hashbang */
.pygments236 .cm { color: #008000 } /* Comment.Multiline */
.pygments236 .cp { color: #af00db } /* Comment.Preproc */
.pygments236 .cpf { color: #a31515 } /* Comment.PreprocFile */
.pygments236 .c1 { color: #008000 } /* Comment.Single */
.pygments236 .cs { color: #008000 } /* Comment.Special */
.pygments236 .ge { font-style: italic } /* Generic.Emph */
.pygments236 .gh { font-weight: bold } /* Generic.Heading */
.pygments236 .gp { font-weight: bold } /* Generic.Prompt */
.pygments236 .gs { font-weight: bold } /* Generic.Strong */
.pygments236 .gu { font-weight: bold } /* Generic.Subheading */
.pygments236 .kc { color: #4e8ae9 } /* Keyword.Constant */
.pygments236 .kd { color: #0000ff } /* Keyword.Declaration */
.pygments236 .kn { color: #af00db } /* Keyword.Namespace */
.pygments236 .kp { color: #0000ff } /* Keyword.Pseudo */
.pygments236 .kr { color: #0000ff } /* Keyword.Reserved */
.pygments236 .kt { color: #2b91af } /* Keyword.Type */
.pygments236 .ld { color: #0000FF } /* Literal.Date */
.pygments236 .m { color: #0000FF } /* Literal.Number */
.pygments236 .s { color: #a31515 } /* Literal.String */
.pygments236 .na { color: #001080 } /* Name.Attribute */
.pygments236 .nb { color: #795e26 } /* Name.Builtin */
.pygments236 .nc { color: #2b91af } /* Name.Class */
.pygments236 .no { color: #0000FF } /* Name.Constant */
.pygments236 .nf { color: #795e26 } /* Name.Function */
.pygments236 .nl { color: #AF00DB } /* Name.Label */
.pygments236 .nn { color: #000000 } /* Name.Namespace */
.pygments236 .nt { color: #800000 } /* Name.Tag */
.pygments236 .nv { color: #0F1E87 } /* Name.Variable */
.pygments236 .ow { color: #0000ff } /* Operator.Word */
.pygments236 .mb { color: #09885a } /* Literal.Number.Bin */
.pygments236 .mf { color: #09885a } /* Literal.Number.Float */
.pygments236 .mh { color: #09885a } /* Literal.Number.Hex */
.pygments236 .mi { color: #09885a } /* Literal.Number.Integer */
.pygments236 .mo { color: #09885a } /* Literal.Number.Oct */
.pygments236 .sa { color: #a31515 } /* Literal.String.Affix */
.pygments236 .sb { color: #a31515 } /* Literal.String.Backtick */
.pygments236 .sc { color: #a31515 } /* Literal.String.Char */
.pygments236 .dl { color: #a31515 } /* Literal.String.Delimiter */
.pygments236 .sd { color: #a31515 } /* Literal.String.Doc */
.pygments236 .s2 { color: #a31515 } /* Literal.String.Double */
.pygments236 .se { color: #a31515 } /* Literal.String.Escape */
.pygments236 .sh { color: #a31515 } /* Literal.String.Heredoc */
.pygments236 .si { color: #a31515 } /* Literal.String.Interpol */
.pygments236 .sx { color: #a31515 } /* Literal.String.Other */
.pygments236 .sr { color: #a31515 } /* Literal.String.Regex */
.pygments236 .s1 { color: #a31515 } /* Literal.String.Single */
.pygments236 .ss { color: #a31515 } /* Literal.String.Symbol */
.pygments236 .bp { color: #795e26 } /* Name.Builtin.Pseudo */
.pygments236 .fm { color: #795e26 } /* Name.Function.Magic */
.pygments236 .vc { color: #0F1E87 } /* Name.Variable.Class */
.pygments236 .vg { color: #0F1E87 } /* Name.Variable.Global */
.pygments236 .vi { color: #0F1E87 } /* Name.Variable.Instance */
.pygments236 .vm { color: #0F1E87 } /* Name.Variable.Magic */
.pygments236 .il { color: #09885a } /* Literal.Number.Integer.Long */
.pygments236 pre.snippet236 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/tttapa.github.io/blob/master/Pages-src/Raw-HTML/Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/resources/EMA-check.cpp" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"></a>
<div class="pygments236"><pre class="lineNumbers snippet236"><code><span></span><span class="n">EMA</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="kt">int_fast16_t</span><span class="p">,</span><span class="w"> </span><span class="kt">uint_fast16_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">filter</span><span class="p">;</span></code>
<code><span class="k">static_assert</span><span class="p">(</span><span class="n">filter</span><span class="p">.</span><span class="n">supports_range</span><span class="p">(</span><span class="mi">-1024</span><span class="p">,</span><span class="w"> </span><span class="mi">1023</span><span class="p">),</span></code>
<code><span class="w">              </span><span class="s">"use a wider state or input type, or a smaller shift factor"</span><span class="p">);</span></code></pre></div>
</div>

<h3><a name="arduino-example" href="#arduino-example">Arduino Example</a></h3>

<div class="codesnippet"><style>pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.pygments242 .hll { background-color: #ffffcc }
.pygments242 { background: #ffffff; }
.pygments242 .c { color: #95a5a6 } /* Comment */
.pygments242 .err { color: #a61717 } /* Error */
.pygments242 .k { color: #728E00 } /* Keyword */
.pygments242 .n { color: #434f54 } /* Name */
.pygments242 .o { color: #728E00 } /* Operator */
.pygments242 .ch { color: #95a5a6 } /* Comment.Hashbang */
.pygments242 .cm { color: #95a5a6 } /* Comment.Multiline */
.pygments242 .cp { color: #728E00 } /* Comment.Preproc */
.pygments242 .cpf { color: #95a5a6 } /* Comment.PreprocFile */
.pygments242 .c1 { color: #95a5a6 } /* Comment.Single */
.pygments242 .cs { color: #95a5a6 } /* Comment.Special */
.pygments242 .kc { color: #00979D } /* Keyword.Constant */
.pygments242 .kd { color: #728E00 } /* Keyword.Declaration */
.pygments242 .kn { color: #728E00 } /* Keyword.Namespace */
.pygments242 .kp { color: #00979D } /* Keyword.Pseudo */
.pygments242 .kr { color: #00979D } /* Keyword.Reserved */
.pygments242 .kt { color: #00979D } /* Keyword.Type */
.pygments242 .m { color: #8A7B52 } /* Literal.Number */
.pygments242 .s { color: #7F8C8D } /* Literal.String */
.pygments242 .na { color: #434f54 } /* Name.Attribute */
.pygments242 .nb { color: #728E00 } /* Name.Builtin */
.pygments242 .nc { color: #434f54 } /* Name.Class */
.pygments242 .no { color: #434f54 } /* Name.Constant */
.pygments242 .nd { color: #434f54 } /* Name.Decorator */
.pygments242 .ni { color: #434f54 } /* Name.Entity */
.pygments242 .ne { color: #434f54 } /* Name.Exception */
.pygments242 .nf { color: #D35400 } /* Name.Function */
.pygments242 .nl { color: #434f54 } /* Name.Label */
.pygments242 .nn { color: #434f54 } /* Name.Namespace */
.pygments242 .nx { color: #728E00 } /* Name.Other */
.pygments242 .py { color: #434f54 } /* Name.Property */
.pygments242 .nt { color: #434f54 } /* Name.Tag */
.pygments242 .nv { color: #434f54 } /* Name.Variable */
.pygments242 .ow { color: #728E00 } /* Operator.Word */
.pygments242 .mb { color: #8A7B52 } /* Literal.Number.Bin */
.pygments242 .mf { color: #8A7B52 } /* Literal.Number.Float */
.pygments242 .mh { color: #8A7B52 } /* Literal.Number.Hex */
.pygments242 .mi { color: #8A7B52 } /* Literal.Number.Integer */
.pygments242 .mo { color: #8A7B52 } /* Literal.Number.Oct */
.pygments242 .sa { color: #7F8C8D } /* Literal.String.Affix */
.pygments242 .sb { color: #7F8C8D } /* Literal.String.Backtick */
.pygments242 .sc { color: #7F8C8D } /* Literal.String.Char */
.pygments242 .dl { color: #7F8C8D } /* Literal.String.Delimiter */
.pygments242 .sd { color: #7F8C8D } /* Literal.String.Doc */
.pygments242 .s2 { color: #7F8C8D } /* Literal.String.Double */
.pygments242 .se { color: #7F8C8D } /* Literal.String.Escape */
.pygments242 .sh { color: #7F8C8D } /* Literal.String.Heredoc */
.pygments242 .si { color: #7F8C8D } /* Literal.String.Interpol */
.pygments242 .sx { color: #7F8C8D } /* Literal.String.Other */
.pygments242 .sr { color: #7F8C8D } /* Literal.String.Regex */
.pygments242 .s1 { color: #7F8C8D } /* Literal.String.Single */
.pygments242 .ss { color: #7F8C8D } /* Literal.String.Symbol */
.pygments242 .bp { color: #728E00 } /* Name.Builtin.Pseudo */
.pygments242 .fm { color: #D35400 } /* Name.Function.Magic */
.pygments242 .vc { color: #434f54 } /* Name.Variable.Class */
.pygments242 .vg { color: #434f54 } /* Name.Variable.Global */
.pygments242 .vi { color: #434f54 } /* Name.Variable.Instance */
.pygments242 .vm { color: #434f54 } /* Name.Variable.Magic */
.pygments242 .il { color: #8A7B52 } /* Literal.Number.Integer.Long */
.pygments242 pre.snippet242 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/tttapa.github.io/blob/master/Pages-src/Raw-HTML/Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/resources/EMA-Arduino.ino" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"></a>
<div class="pygments242"><pre class="lineNumbers snippet242"><code><span></span><span class="n">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kr">uint8_t</span><span class="w"> </span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="kr">class</span><span class="w"> </span><span class="nc">uint_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">uint16_t</span><span class="o">&gt;</span></code>
<code><span class="kr">class</span><span class="w"> </span><span class="nc">EMA</span><span class="w"> </span><span class="p">{</span></code>
<code><span class="w">  </span><span class="kr">public</span><span class="o">:</span></code>
<code><span class="w">    </span><span class="c1">/// Update the filter with the given input and return the filtered output.</span></code>
<code><span class="w">    </span><span class="n">uint_t</span><span class="w"> </span><span class="kr">operator</span><span class="p">()(</span><span class="n">uint_t</span><span class="w"> </span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span></code>
<code><span class="w">        </span><span class="n">state</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">input</span><span class="p">;</span></code>
<code><span class="w">        </span><span class="n">uint_t</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">half</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">K</span><span class="p">;</span></code>
<code><span class="w">        </span><span class="n">state</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">output</span><span class="p">;</span></code>
<code><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">output</span><span class="p">;</span></code>
<code><span class="w">    </span><span class="p">}</span></code>
<code></code>
<code><span class="w">    </span><span class="n">static_assert</span><span class="p">(</span></code>
<code><span class="w">        </span><span class="n">uint_t</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">uint_t</span><span class="p">(</span><span class="mi">-1</span><span class="p">),</span><span class="w">  </span><span class="c1">// Check that `uint_t` is an unsigned type</span></code>
<code><span class="w">        </span><span class="s">"The `uint_t` type should be an unsigned integer, otherwise, "</span></code>
<code><span class="w">        </span><span class="s">"the division using bit shifts is invalid."</span><span class="p">);</span></code>
<code></code>
<code><span class="w">    </span><span class="c1">/// Fixed point representation of one half, used for rounding.</span></code>
<code><span class="w">    </span><span class="n">constexpr</span><span class="w"> </span><span class="kr">static</span><span class="w"> </span><span class="n">uint_t</span><span class="w"> </span><span class="n">half</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">K</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span></code>
<code></code>
<code><span class="w">  </span><span class="kr">private</span><span class="o">:</span></code>
<code><span class="w">    </span><span class="n">uint_t</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span></code>
<code><span class="p">};</span></code>
<code></code>
<code><span class="kr">void</span><span class="w"> </span><span class="nb">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span></code>
<code><span class="w">  </span><span class="nf">Serial</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span></code>
<code><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nf">Serial</span><span class="p">);</span></code>
<code><span class="p">}</span></code>
<code></code>
<code><span class="kr">const</span><span class="w"> </span><span class="kr">unsigned</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="n">interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10000</span><span class="p">;</span><span class="w"> </span><span class="c1">// 10000 µs = 100 Hz</span></code>
<code></code>
<code><span class="kr">void</span><span class="w"> </span><span class="nb">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span></code>
<code><span class="w">  </span><span class="kr">static</span><span class="w"> </span><span class="n">EMA</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">filter</span><span class="p">;</span></code>
<code><span class="w">  </span><span class="kr">static</span><span class="w"> </span><span class="kr">unsigned</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="n">prevMicros</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">micros</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">interval</span><span class="p">;</span></code>
<code><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">micros</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">prevMicros</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">interval</span><span class="p">)</span><span class="w"> </span><span class="p">{</span></code>
<code><span class="w">    </span><span class="kr">int</span><span class="w"> </span><span class="n">rawValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">analogRead</span><span class="p">(</span><span class="n">A0</span><span class="p">);</span></code>
<code><span class="w">    </span><span class="kr">int</span><span class="w"> </span><span class="n">filteredValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">rawValue</span><span class="p">);</span></code>
<code><span class="w">    </span><span class="nf">Serial</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="n">rawValue</span><span class="p">);</span></code>
<code><span class="w">    </span><span class="nf">Serial</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="sc">'\t'</span><span class="p">);</span></code>
<code><span class="w">    </span><span class="nf">Serial</span><span class="p">.</span><span class="nf">println</span><span class="p">(</span><span class="n">filteredValue</span><span class="p">);</span></code>
<code><span class="w">    </span><span class="n">prevMicros</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">interval</span><span class="p">;</span></code>
<code><span class="w">  </span><span class="p">}</span></code>
<code><span class="p">}</span></code></pre></div>
</div>

<h3><a name="additional-resources" href="#additional-resources">Additional resources</a></h3>

<p>
    The idea to use a constant offset to deal with negative inputs originated in
    <a href="https://forum.pjrc.com/threads/61941-Exponential-Moving-Average-How-does-it-work">this PJRC forum
        thread</a>. It also includes a discussion about how the filter works, simulations comparing integer EMA
    implementations with and without rounding, a pure C implementation, etc.
</p>

</div>
        <hr id="end-of-article">
        <div class="nextupprev"><div class="prevpage"><a href="Filtering-in-MATLAB.html" title="Filtering in MATLAB"><i class="material-icons" style="vertical-align: middle; text-decoration: none">chevron_left </i>Previous Page</a></div><div class="uppage"><a href="index.html" title="Exponential Moving Average">Index</a></div><div class="nextpage"></div></div>
    </article>
    <footer>Last edited: Thursday, 23 July 2020 13:54 UTC</footer>
</body>

</html>
